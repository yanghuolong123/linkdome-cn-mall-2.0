(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-97c5def8"],{"0018":function(t,e,a){},"0360":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.showData?a("div",[t.headerType?a("shopping-dashboard"):a("group-dashboard")],1):t._e()},i=[],r=(a("7514"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("real-time-data",{on:{interValChange:t.intervalClick,refresh:t.updateRealTimezone}},[a("template",{slot:"map"},[a("map-carousel",{attrs:{center:t.center,zooms:t.zooms,markers:t.markers,shopData:t.shopData,gateData:t.gateData,window:t.window,timingValue:t.timingValue,id:t.currentMenuName},on:{markClick:t.selectMenuByName}})],1),a("template",{slot:"dashboard"},[a("dashBoard",{ref:"dashBoard",attrs:{target:t.monthTargetVal,todayEnter:t.todayEnter,monthEnter:t.monthEnter,dayTotalEnter:t.dayTotalEnter}})],1),a("template",{slot:"cards"},[a("indicator-cards",{staticClass:"groupStyle",attrs:{indicatorList:t.kpiData,textName:"shop-center-current",propertyId:t.currentPropertyId},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.item;return[a("singleCard",{attrs:{isShowText:!0,item:n,innerRange:t.innerRange}})]}}])})],1)],2),[a("div",{staticClass:"overflow-hidden -mx-3 px-3 py-2"},[a("indicator-cards",{attrs:{indicatorList:t.historyIndicators,propertyId:t.currentPropertyId,indicatorType:"historyIndicator",textName:"shop-center-histrry",scaleCards:"",defaultCountsOfCards:4},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.item;return[a("singleCard",{attrs:{isShowText:!1,item:n,innerRange:t.innerRange,isLiveData:!1}})]}}])},[[a("template",{slot:"title"},[a("span",{staticClass:"text-xl text-black font-medium hidden sm:block",staticStyle:{"padding-left":"18px"}},[t._v("\n              历史数据查询\n              "),a("Tooltip",{attrs:{content:t.tootipText,placement:"right",theme:"light",transfer:"","max-width":"500"}},[a("icons",{attrs:{type:"wenhao"}})],1)],1)]),a("template",{slot:"dateSelector"},[a("i-date-picker",{staticClass:"mr-8 history-date-picker",on:{selectDate:t.selectDate}})],1)]],2)],1),a("Trend",{staticStyle:{"margin-top":"20px"},attrs:{time1:t.outRange,innerRange:t.innerRange,propertyId:t.currentPropertyId,indicatorData:t.trendIndicators,istotal:!0}}),a("Ranking",{attrs:{time1:t.outRange,propertyId:t.currentPropertyId,indicatorData:t.rankingIndicators,defaultBizIndicator:t.rankingDataShowType,defaultShopIndicator:t.rankingDataShowType}}),a("customer-analytics",{attrs:{data:t.customAnalytics},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.item;return[a("customer-charts",{attrs:{labels:n.labels,series:n.series,type:n.type,title:n.title,height:n.height},on:{tableChage:t.shopTabChange}},[a("export-menu",{attrs:{slot:"export"},on:{onchange:function(e){t.genderExportBiztop(n.title)}},slot:"export"})],1)]}}])})]],2)}),o=[],s=a("768b"),c=(a("96cf"),a("3b8d")),l=a("795b"),u=a.n(l),d=(a("5df3"),a("6b54"),a("a481"),a("28a5"),a("c5f6"),a("cebc")),h=a("75fc"),p=a("db0c"),m=a.n(p),f=(a("7f7f"),a("ac6a"),a("a4bb")),y=a.n(f),g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mapbox"},[a("div",{staticClass:"info-seting-zone"},[a("p",{staticClass:"time-box"},[a("span",{staticClass:"text-xl text-black font-medium"},[t._v("\n        今日实时数据\n        "),a("Tooltip",{attrs:{content:t.tootipText,placement:"right",theme:"light",transfer:"","max-width":"500"}},[a("icons",{attrs:{type:"wenhao"}})],1)],1),a("span",{staticClass:"font-number hidden md:inline"},[t._v(t._s(t.date))]),a("span",{staticClass:"font-number hidden md:inline"},[t._v(t._s(t.time))])]),a("p",{staticClass:"text-right user-seting"},[a("a",{attrs:{href:""},on:{click:function(e){return e.preventDefault(),t.handleRefresh(e)}}},[a("icons",{attrs:{type:"shuaxin",size:24}})],1),a("vs-dropdown",{staticClass:"hidden md:inline ml-8"},[a("span",{staticClass:"text-sm setingtext"},[t._v(t._s(t.currentInterVal)+"刷新一次")]),a("icons",{staticClass:"mx-4",attrs:{type:"arrow_down",color:"#626262"}}),a("vs-dropdown-menu",t._l(t.interVal,function(e){return a("vs-dropdown-item",{key:e,staticClass:"my-dropdown-item",attrs:{name:e},on:{click:function(a){t.clickInterVal(e)}}},[t._v(t._s(e))])}),1)],1)],1)]),a("div",{staticClass:"data-zone"},[a("div",{staticClass:"mapCarousel"},[t._t("map")],2),a("div",[t._t("dashboard")],2),a("div",{staticClass:"kpi-card-box"},[t._t("cards")],2)])])},b=[],v=a("c1df"),x=a.n(v),D={name:"realTimeData",data:function(){return{interVal:["30秒","5分钟","10分钟","20分钟","30分钟"],currentInterVal:"30秒",date:"",time:""}},computed:{tootipText:function(){return 0===this.$store.state.home.headerAction?"平均客流量：所有购物中心实时累计客流之和除以购物中心个数\n客流峰值：所有购物中心当中客流峰值的最大值\n集客量峰值：所有购物中心当中集客量峰值的最大值\n今日集客量：所有购物中心集客量之和":"今日平均客流量：累计客流量除以营业小时数\n今日客流峰值：从开始营业时间到目前时刻客流最大值\n今日集客量峰值：从开始营业时间到目前时刻购物中心中驻留人数的最大值和时间点\n今日集客量：从开始营业时间到目前时刻的进入总客流与离开总客流之差"}},mounted:function(){var t=this;setInterval(function(){t.formatTime()},1e3)},methods:{clickInterVal:function(t){this.currentInterVal=t,this.$emit("interValChange",t)},formatTime:function(){var t=x()().format("YYYY-MM-DD HH:mm:ss").split(" ");this.date=t[0],this.time=t[1]},handleRefresh:function(){this.$emit("refresh")}}},w=D,k=(a("a82d"),a("6b92"),a("2877")),A=Object(k["a"])(w,g,b,!1,null,"4f09b958",null),C=A.exports,I=(a("ab30"),a("c20c")),T=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mt-6 cards-content px-3"},t._l(t.cardsData,function(e){return a("div",{key:e.id},[a("singl-card",{attrs:{item:e,isLiveData:!1,innerRange:t.innerRange,rangeName:t.timeName}})],1)}))},O=[],R=a("4a88"),N={name:"compareType",props:{data:{type:Array},clickTimeName:{type:String},innerRange:{type:String}},components:{singlCard:R["a"]},computed:{timeName:function(){var t={t:"今日",l:"昨日",w:"上周",m:"上月",y:"今年"},e=t[this.clickTimeName];return e},cardsData:function(){return this.data}},filters:{dateformat:function(t,e){var a=t.slice(0,16);if("1h"===e){var n=t.split("-"),i=Object(s["a"])(n,6),r=i[2],o=i[5];return"".concat(r.slice(3),"-").concat(o.slice(3))}return"".concat("1day"===e?a.split(" ")[0]:a.slice(0,7))}}},S=N,L=(a("b0f6"),Object(k["a"])(S,T,O,!1,null,"5dbfe823",null)),E=(L.exports,a("d162")),j=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"bg-white dashboard-box"},[a("vs-row",{attrs:{type:"flex"}},[a("vs-col",{staticClass:"numberBox",attrs:{"vs-lg":"6","vs-xs":"12"}},[a("p",{staticClass:"fontSize font-medium"},[t._v("\n       当日累积客流（人）\n      ")]),a("p",{staticClass:"dayEnter  font-number font-semibold"},[t._v(t._s(t._f("numberFormat")(t.dayTotalEnter)))]),a("div",{staticClass:"month-data"},[a("p",{staticClass:"font-normal"},[t._v(" 当月累积客流（人）")]),a("p",{staticClass:"font-number "},[t._v(t._s(t._f("numberFormat")(t.monthEnter)))])])]),a("vs-col",{staticStyle:{position:"relative"},attrs:{"vs-lg":"6","vs-xs":"12"}},[a("vue-apex-charts",{attrs:{type:"radialBar",height:"230",options:t.chartOptions,series:t.chartData}}),a("div",{staticClass:"month-values"},[a("p",{staticClass:"text-base text-grey font-normal"},[t._v("月达标值（人）")]),a("p",{staticClass:"text-lg text-grey font-number font-normal"},[t._v(t._s(t._f("numberFormat")(t.target)))])])],1)],1)],1)},M=[],z=a("1321"),Y=a.n(z),P=a("5fe9"),B=a.n(P),F={name:"dashBoard",props:{target:{type:Number,default:0},todayEnter:{type:Number,default:0},dayTotalEnter:{type:Number,default:0},monthEnter:{type:Number,default:0}},components:{VueApexCharts:Y.a},computed:{chartData:function(){if(0===this.target)return[0];var t=B.a.times(B.a.round(this.monthEnter/this.target,2),100);return[t]},chartOptions:function(){return{plotOptions:{radialBar:{size:100,startAngle:-150,endAngle:150,hollow:{size:"65%"},track:{background:"#fff",strokeWidth:"100%"},dataLabels:{value:{offsetY:15,color:"#99a2ac",fontSize:"18px"}}}},colors:["#EA5455"],fill:{type:"gradient",gradient:{shade:"dark",type:"horizontal",shadeIntensity:.5,gradientToColors:["#7367F0"],inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,1e3]}},stroke:{dashArray:8},chart:{sparkline:{},fontFamily:"source_han_sans_cn"},labels:["本月客流达成率"],responsive:[{breakpoint:1576,options:{plotOptions:{radialBar:{size:80}}}},{breakpoint:1200,options:{plotOptions:{radialBar:{size:100}}}}]}}}},V=F,q=(a("840e"),a("c34d"),Object(k["a"])(V,j,M,!1,null,"3bcea679",null)),G=q.exports,H=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"map-carousel-box box-card"},["company"===t.id?n("div",{staticClass:"amap-box"},[n("img",{attrs:{src:a("64ea"),alt:""}}),t._l(t.markers,function(e,i){return n("div",{key:i,staticClass:"company-property",style:{left:e.position[0],top:e.position[1]}},[e.isText?n("div",{staticClass:"property-list"},[n("img",{attrs:{src:e.img?e.img:t.floorImage,alt:""}}),n("div",{staticClass:"list-right"},[n("p",[t._v(t._s(e.name))]),n("p",{staticClass:"enter"},[t._v("实时客流: "+t._s(Number(e.enter).toLocaleString()))])])]):t._e(),n("img",{staticClass:"map-icon",attrs:{src:a("8c12"),alt:""},on:{mouseover:function(e){t.showData(i,"show")},mouseout:function(e){t.showData(i,"hide")},click:function(a){t.handleclick(e.id)}}})])})],2):t._e(),"company"!==t.id?n("div",[t.mapCarousel&&t.mapCarousel.length>0?[n("Carousel",{ref:"careousel",staticClass:"carousel",attrs:{"radius-dot":"",height:548},model:{value:t.value1,callback:function(e){t.value1=e},expression:"value1"}},t._l(t.mapCarousel,function(e,a){return n("CarouselItem",{key:a},[[n("div",{staticClass:"carouselItem",style:{background:"url("+(e.map_url?e.map_url:t.floorImage)+")"}},t._l(e.gate,function(e,a){return n("div",{key:a,staticClass:"positions",staticStyle:{position:"absolute"},style:{top:100*e.position_y+"%",left:100*e.position_x+"%"}},[t._v("\n                "+t._s(e.name)+"\n                "),n("br"),t._v("\n                实时客流:"+t._s(e.enter?e.enter.toLocaleString():0)+"\n              ")])}))]],2)}),1)]:[n("p",{staticClass:"noData"},[t._v("暂无数据")])]],2):t._e()])},U=[],K=a("2ef0"),$=a.n(K),W=a("3191"),X=a("2f62"),Q={name:"mapAndCarousel",props:{shopData:{type:Object},gateData:{type:Object},markers:{type:Array},center:{type:Array},zooms:{type:Array},timingValue:{type:Number},window:{type:null},id:{type:null}},data:function(){return{mapIcon:"circle",current:0,value1:0,floorImage:a("72bd"),showEnter:!1,intervalId:"",mapCarousel:[]}},computed:{iconColor:function(){return"company"===this.id?"#fff":"#ffb22b"}},watch:{"$store.state.reduceButton":function(){var t=this;setTimeout(function(){t.$refs.careousel.handleResize()},500)},"$store.state.home.headerAction":function(){this.propertImgGate()},timingValue:function(){this.intervalClick(this.timingValue)}},mounted:function(){this.propertImgGate()},activated:function(){this.intervalClick("30秒")},deactivated:function(){this.intervalId&&clearInterval(this.intervalId)},methods:Object(d["a"])({},Object(X["c"])(["savePropertMap"]),{propertImgGate:function(){var t=this;Object(W["v"])().then(function(e){if(200==e.data.code){t.mapCarousel=[];var a=e.data.data.property;if(a)a.forEach(function(e){if(e.id&&e.id===t.$store.state.home.headerAction){var a={};a.id=e.id,a.name=e.name,a.map_url=e.map_url,a.gate=e.gate,t.mapCarousel.push(a)}});else{var n={map_url:""};t.mapCarousel.push(n)}}})},intervalClick:function(t){var e,a=this;clearInterval(this.intervalId),"30秒"==t?e=3e4:"5分钟"==t?e=3e5:"10分钟"==t?e=6e5:"20分钟"==t?e=12e5:"30分钟"==t&&(e=18e5),this.intervalId=setInterval(function(){a.propertImgGate()},e)},handleclick:function(t){var e=$.a.find(this.markers,function(e){return t==e.id}),a=e.propertyId;this.$store.commit("headerAction",a),this.$emit("markClick",t);try{window.TDAPP.onEvent("集团页面","地图标记点",{"购物中心名称":e.name})}catch(n){console.log(eventName+"集团页面-地图标记点-埋点error:"+n)}},showData:function(t,e){"show"==e?(this.markers[t].isText=!0,this.showEnter=!0):(this.markers[t].isText=!1,this.showEnter=!1)}})},J=Q,Z=(a("ce80"),a("60ed"),Object(k["a"])(J,H,U,!1,null,"1f7863f3",null)),tt=Z.exports,et=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"customcon",staticClass:"custom-count-box",staticStyle:{"margin-top":"20px"}},t._l(t.data,function(e,n){return a("div",{key:n,staticClass:"item item-age box-card bg-white"},[t._t("default",null,{item:e})],2)}))},at=[],nt={name:"CustomerAnalytics",props:{data:{type:Array,default:function(){return[]}}}},it=nt,rt=(a("8a2e"),Object(k["a"])(it,et,at,!1,null,null,null)),ot=rt.exports,st=a("be93"),ct=a("869a"),lt=a("ad00"),ut=a("67af"),dt=a("c276"),ht=a("92f6"),pt=a("69fd"),mt=a("45d6"),ft=a("9777"),yt=(a("ff37"),{name:"shoppingDashboard",mixins:[pt["a"]],components:{realTimeData:C,mapCarousel:tt,Ranking:st["a"],Trend:I["a"],indicatorCards:E["a"],dashBoard:G,iDatePicker:ut["a"],CustomerAnalytics:ot,singleCard:R["a"],CustomerCharts:ct["a"],exportMenu:ft["a"]},data:function(){return{addProrertyData:{validData:{id:"entervalid",name:"今日有效客流",data:0,type:{icon:"youxiaokeliu",color:"#2bd9cf"}},manAndWomen:{id:"entermanAndWomen",name:"性别人数",data:{name1:"女性",name2:"男性",data1:1234,data2:5678},type:{icon:"xingbie",color:"#E8585A"}},newAndOld:{id:"enternewAndOld",name:"新老顾客",data:{name1:"新顾客",name2:"老顾客",data1:1234,data2:5678},type:{icon:"xinlaoguke",color:"#857aef"}}},rankingDataShowType:"enter",dayTotalEnter:0,innerRange:"1h",outRange:"",clickTimeName:"l",center:[108.948234,34.223579],zooms:[0,18],markers:[],dashboardData:{},window:"",enterArr:[],windows:[],shopData:null,gateData:null,monthTargetVal:0,todayEnter:0,monthEnter:0,kpiData:[],historyData:null,summarySalse:[],today:x()().format("YYYY-MM-DD"),footFallTypeRes:{},zones:[],intervalId:"",initRes:[],changedMenuName:"company",currentMenuName:"",currentDayData:"",currentPropertyId:null,customChecklist:{new_old_proportion:{name:"新老顾客占比",chartType:["donut"]},vip_proportion:{name:"VIP顾客占比",chartType:["radialBar"]},arrival_distribution:{name:"到店次数",chartType:["pie"]},age_distribution:{name:"年龄分布",chartType:["bar"]},gender_propotion:{name:"性别分布",chartType:["radialBar"]}},canshow:!1,obj1:[],obj2:[],obj3:[],obj4:[],downloadName:"",timingValue:5}},computed:{tootipText:function(){this.innerRange;return"总客流： 所选时间段内的客流之和\n客流峰值：所选时间段内的客流的最大值和时间点\n集客量峰值：所选时间段内的购物中心驻留人数的最大值和时间点\n有效客流：所选时间段内的购物中心用户的唯一客流人数\n销售额：所选时间段内购物中心销售额之和\n坪效： 所选时间段内销售额除以购物中心面积\n成交率：所选时间段内购物中心的成交单数除以进入购物中心的客流\n客单价： 所选时间段内购物中心所的销售额除以购物中心的成交单数\n"},companyId:function(){return this.$store.state.user.companyId},shoppingCurrentId:function(){return this.$store.state.home.headerAction},customAnalytics:function(){var t=this,e=[];if(!y()(this.footFallTypeRes).length)return e;var a=this.footFallTypeRes;return delete a.clerk_proportion,y()(a).forEach(function(n){var i={};if("gender_propotion"===n){var r={0:{name:"女",icon:"female"},1:{name:"男",icon:"male"}};i.labels={name:"性别",key:"gender",data:y()(a[n]).map(function(t){return r[t].name}),icons:y()(a[n]).map(function(t){return r[t].icon})},i.series=m()(a[n])}else if("age_distribution"===n){var o={male:"男性",female:"女性"};i.labels={name:"年龄",key:"age",data:y()(a[n]).map(function(e){return t.ageNameformat(e)})},i.series=y()(o).map(function(t){return{name:o[t],key:t,data:m()(a[n]).map(function(e){return e[t]})}})}else i.labels={name:"类型",key:n,data:y()(a[n]).map(function(t){return ht["a"][t].name}),icons:y()(a[n]).map(function(t){return ht["a"][t].icon})},i.series=m()(a[n]);i.title=t.customChecklist[n].name,i.type=t.customChecklist[n].chartType,i.height=t.customChecklist[n].height,"vip_proportion"!==n&&e.push(i)}),e},historyIndicators:function(){var t=[].concat(Object(h["a"])(this.historyKpiData),Object(h["a"])(this.summarySalse));return t},historyNewKpi:function(){var t=this.footFallTypeRes,e=t.new_old_proportion,a=t.gender_propotion,n={id:"entermanAndWomen",name:"性别人数",data:{name1:"女性",name2:"男性",data1:a[0],data2:a[1]},type:{icon:"xingbie",color:"#E8585A"}},i={id:"enternewAndOld",name:"新老顾客",data:{name1:"新顾客",name2:"老顾客",data1:e.newNum,data2:e.oldNum},type:{icon:"xinlaoguke",color:"#857aef"}};return[n,i]},rankingIndicators:function(){return Object(d["a"])({},{enter:{name:"入客流"}},mt["a"])},filterFootfallData:function(){var t=this;if(!this.historyData)return null;var e=null;return e=$.a.find(this.historyData.property,function(e){return e.property_id===t.currentMenuName}),e},historyKpiData:function(){var t=this;if(!this.filterFootfallData)return[];var e=this.filterFootfallData,a=e.enter,n=e.occupancy,i=e.valid,r=this.processKPIData(a,"enter"),o=$.a.dropRight(this.processKPIData(n,"occupancy"));if("y"===this.clickTimeName)return $.a.dropRight([].concat(Object(h["a"])(r),Object(h["a"])(o)));var s={id:"entervalid",name:"有效客流",data:Number(i)<0?0:i,type:{icon:"youxiaokeliu",color:"#2bd9cf"}},c=x()(new Date).format("YYYY-MM-DD"),l=this.outRange.split(",")[0],u=this.outRange.split(",")[1];return c==l&&c==u&&r.forEach(function(e){"平均客流量"==e.name&&(e.data=t.currentDayData.enter.avg),"总客流"==e.name&&(e.data=e.data.number)}),o.map(function(t,e){Number(t.data.number)<0&&(o[e].data.number=0)}),[].concat(Object(h["a"])(r),Object(h["a"])(o),[s])},trendIndicators:function(){var t={enter:{name:"客流量",yaxis:{title:{text:"客流量（人）"},labels:{formatter:function(t){return t?t.toLocaleString():""}}}},occupancy:{name:"集客量",yaxis:{title:{text:"集客量（人）"},labels:{formatter:function(t){return t?t.toLocaleString():""}}}}};return Object(d["a"])({},t,mt["a"])}},mounted:function(){this.initRequest()},activated:function(){this.initRequest(),this.intervalClick("30秒")},watch:{outRange:function(){var t=this.getHistoryComputed();this.querHistory(t)},shoppingCurrentId:function(){0!=this.shoppingCurrentId&&this.initRequest()},"$store.state.home.headerAction":function(){var t=this.$router.currentRoute.name;"dashboardAnalytics"===t&&this.selectMenuByName()}},methods:Object(d["a"])({},Object(X["c"])(["saveBusinessTree","saveAllTargetData"]),{ageNameformat:function(t){return t.replace("_","-").replace("less-","小于").replace(/more-/,"大于")},updateMapZoneByName:function(t){if(this.currentMenuName=Number(t),this.currentPropertyId=Number(t),this.dashboardData[t]?this.shopData=this.dashboardData[t].shopData?this.dashboardData[t].shopData:null:this.shopData=null,this.shopData,this.dashboardData[t]){var e=$.a.cloneDeep(this.dashboardData[t].compute);this.kpiData=$.a.remove(e,function(t){return"entertotal"!==t.id}),this.dayTotalEnter=$.a.find(this.dashboardData[t].compute,function(t){return"entertotal"===t.id}).data,this.monthTargetVal=Number(this.dashboardData[t].targetValue.toFixed(0)),this.todayEnter=this.dashboardData[t].todayEnter,this.monthEnter=this.dashboardData[t].monthEnter}},selectMenuByName:function(t){var e=this.$store.state.home.headerAction;this.updateMapZoneByName("".concat(e))},mapDataInit:function(t){a("0e4d");var e=t[0].data.data,n=t[1].data.data,i=t[2].data.data;this.saveBusinessTree(i);var r=this.$store.state.home.headerAction,o=(new Date).getMonth();this.windows=[];var s=[],c=(e.name,e.property),l=n.property,u=(n.company,[]),d={};this.zones=[];try{var h=$.a.find(c,function(t){return t.property_id===r});if(h){var p,m=$.a.find(l,function(t){return t.bzid===h.bzid}),f=$.a.find(i,function(t){return t.id===h.bzid});if(m){var g=this.processKPIData(m.enter,"enter"),b=this.processKPIData(m.occupancy,"occupancy");p=$.a.concat(g,b)}else p=[];var v=0;if(h.goal_flow){var x=(new Date).getFullYear();h.goal_flow.map(function(t){if(t.year==x)if(u.push({id:h.bzid,data:h.goal_flow,marketData:h.goal_sale}),"year"===t.is_year)v=t.flow_year/12,v;else{var e=t.detail.months;v=e[o][y()(e[o])[0]]||0,v}})}m?(this.currentDayData=m,d[h.property_id]={compute:p,name:h.name,targetValue:v,shopData:f,todayEnter:m.enter.total,monthEnter:m.enter.month.number,propertyId:h.property_id}):(this.currentDayData=0,d[h.property_id]={compute:p,name:h.name,targetValue:v,shopData:f,todayEnter:0,monthEnter:0,propertyId:h.property_id})}}catch(w){console.log(w)}this.saveAllTargetData(u),this.windows=s;var D="";D=this.$store.state.home.headerAction,this.dashboardData=d,this.updateMapZoneByName(D)},processKPIData:function(t,e){var a="";a=0==t.isexist?"今日":"";var n={enter:{avg:a+"平均客流量",highest:a+"客流峰值",total:a+"总客流"},occupancy:{highest:a+"集客量峰值",total:a+"集客量"}},i={total:{icon:"occupancy"===e?"liuliang":"enter_total",color:"#857aef"},avg:{icon:"avg",color:"#1dd9d1"},highest:{icon:"occupancy"===e?"occu_highest":"highest",color:"#e8585a"}},r=[],o=n[e];for(var s in o)if(o.hasOwnProperty(s)){var c=o[s],l=void 0;t[s]?Number(t[s])<0?l=0:(l=t[s],l.number&&(l.number=Number(l.number)<0?0:l.number)):l=0,r.push({id:e+s,name:c,data:l,type:i[s]})}return r},selectDate:function(t,e){try{window.TDAPP.onEvent("购物中心首页","历史数据时间选择",{"时间段":t})}catch(a){console.log("购物中心首页-历史数据时间选择-埋点error:"+a)}if(""==t[0]||this.outRange==t.toString())return!1;this.clickTimeName=e,this.outRange=t.toString(),this.innerRange=Object(dt["j"])(t)},initDateDuration:function(){var t="YYYY-MM-DD",e=x()().add(-1,"days").format(t),a=x()().add(-1,"days").format(t),n="".concat(a,",").concat(e);return n},getCustom:function(){var t={range:this.outRange,property_id:this.currentMenuName};return Object(W["j"])(t)},getHistoryComputed:function(){var t={companyId:this.companyId,timeRange:this.outRange};return Object(W["x"])(t)},intervalClick:function(t){var e,a=this;this.timingValue=t,"30秒"==t?e=3e4:"5分钟"==t?e=3e5:"10分钟"==t?e=6e5:"20分钟"==t?e=12e5:"30分钟"==t&&(e=18e5),clearInterval(this.intervalId),this.intervalId=setInterval(function(){a.updateRealTimezone()},e)},updateRealTimezone:function(){var t=this,e=this.companyId;u.a.all([Object(W["h"])({time:this.today,companyId:e,offset:60})]).then(function(e){t.$set(t.initRes,1,e[0]),t.mapDataInit(t.initRes)}).catch(function(t){console.log(t)})},initRequest:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(){var e,a,n,i,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.outRange=this.initDateDuration(),e=this.companyId,t.next=4,u.a.all([Object(W["k"])(),Object(W["h"])({time:this.today,companyId:e,offset:60}),Object(lt["b"])({entity:52})]);case 4:this.initRes=t.sent,a=this.$store.state.user.bzid,n=this.initRes[2],i=[],n.data.data.forEach(function(t){a.indexOf(t.id)>-1&&t.children.forEach(function(t){t.area&&t.area.forEach(function(t){var e={};e.id=t.id,e.value=t.id,e.key=t.id,e.name=t.name,e.text=t.name,e.label=t.name,i.push(e)})})}),this.$store.commit("setAreaList",i),this.mapDataInit(this.initRes),this.canshow=!0,r=this.getHistoryComputed(),this.querHistory(r);case 14:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),querHistory:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var a,n,i,r,o,c;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return a=[this.getSalesData({time1:this.outRange,propertyId:this.currentPropertyId}),this.getCustom()],e&&a.push(e),t.next=4,u.a.all(a);case 4:n=t.sent,i=Object(s["a"])(n,3),r=i[0],o=i[1],c=i[2],this.summarySalse=r,o&&(this.footFallTypeRes=o.data.data),c&&(this.historyData=c.data.data);case 9:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),updateHistoryRes:function(t,e){for(var a in t.company.enter)if(t.company.enter.hasOwnProperty(a)){var n=t.company.enter[a];n.hasOwnProperty("lastRatio")&&delete n.lastRatio,n.hasOwnProperty("ringRatio")&&delete n.ringRatio,n.number=e.company[a].hasOwnProperty("number")?e.company[a].number:e.company[a]}t.property.forEach(function(t,a){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];if("enter"===n||"occupancy"===n)for(var r in i)if(i.hasOwnProperty(r)){var o=i[r];o.hasOwnProperty("lastRatio")&&delete o.lastRatio,o.hasOwnProperty("ringRatio")&&delete o.ringRatio,o.number=e.property[a][n][r].hasOwnProperty("number")?e.property[a][n][r].number:e.property[a][n][r]}}})},shopTabChange:function(t){"年龄分布"===t.type&&(this.obj1=t.data),"性别分布"===t.type&&(this.obj2=t.data),"新老顾客占比"===t.type&&(this.obj3=t.data),"到店次数"===t.type&&(this.obj4=t.data)},genderExportBiztop:function(t){"年龄分布"===t?(this.downloadName="购物中心年龄分布客流数据",this.uploadList(this.obj1)):"性别分布"===t?(this.downloadName="购物中心性别分布客流数据",this.uploadList(this.obj2)):"新老顾客占比"===t?(this.downloadName="购物中心新老顾客占比客流数据",this.uploadList(this.obj3)):"到店次数"===t&&(this.downloadName="购物中心顾客到店次数客流数据",this.uploadList(this.obj4));var e=0===this.$store.state.home.headerAction?"集团页面":"购物中心首页";try{window.TDAPP.onEvent(e,t+"下载",{})}catch(a){console.log(e+"-"+t+"下载-埋点error:"+a)}},uploadList:function(t){var e=this;Object(W["b"])(t).then(function(t){var a=new Date,n=new Blob([t.data]),i=e.downloadName,r=i+x()(a).format("YYYYMMDDHHmmss")+".xls",o=document.createElement("a");o.download=r,o.style.display="none",o.href=URL.createObjectURL(n),document.body.appendChild(o),o.click(),URL.revokeObjectURL(o.href),document.body.removeChild(o)})}}),deactivated:function(){this.intervalId&&clearInterval(this.intervalId)}}),gt=yt,bt=(a("12c7"),a("5010"),Object(k["a"])(gt,r,o,!1,null,"490769b2",null)),vt=bt.exports,xt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("real-time-data",{on:{interValChange:t.intervalClick,refresh:t.updateRealTimezone}},[a("template",{slot:"map"},[a("map-carousel",{attrs:{center:t.center,zooms:t.zooms,markers:t.markers,shopData:t.shopData,gateData:t.gateData,window:t.window,timingValue:t.currentTimeRefresh,id:t.currentMenuName},on:{markClick:t.selectMenuByName}})],1),a("template",{slot:"dashboard"},[a("right-data",{ref:"dashBoard",attrs:{rightShoppingList:t.rightShoppingList},on:{isRightImg:t.isRightImg}})],1),0==t.isKipShow?a("template",{slot:"cards"},[a("indicator-cards",{staticClass:"group-right-list groupStyle",attrs:{indicatorList:t.kpiData,propertyId:t.currentPropertyId,textName:"group-current"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.item;return[a("singleCard",{attrs:{isShowText:!0,item:n,innerRange:t.innerRange}})]}}])})],1):t._e()],2),[a("div",{staticClass:"overflow-hidden -mx-3 px-3 py-2"},[a("indicator-cards",{attrs:{indicatorList:t.historyIndicators,propertyId:t.currentPropertyId,indicatorType:"historyIndicator",textName:"group-histrry",scaleCards:"",defaultCountsOfCards:4},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.item;return[a("singleCard",{attrs:{isShowText:!1,item:n,innerRange:t.innerRange,isLiveData:!1}})]}}])},[[a("template",{slot:"title"},[a("span",{staticClass:"text-xl text-black font-medium hidden sm:block",staticStyle:{"padding-left":"18px"}},[t._v("\n              历史数据查询\n              "),a("Tooltip",{attrs:{content:t.tootipText,placement:"right",theme:"light",transfer:"","max-width":"500"}},[a("icons",{attrs:{type:"wenhao"}})],1)],1)]),a("template",{slot:"dateSelector"},[a("i-date-picker",{staticClass:"mr-8 history-date-picker",on:{selectDate:t.selectDate}})],1)]],2)],1),a("group-trend",{staticStyle:{"margin-top":"20px"},attrs:{time1:t.outRange,innerRange:t.innerRange,companyId:t.companyId,indicatorData:t.trendIndicators}}),a("Ranking",{attrs:{time1:t.outRange,propertyId:t.currentPropertyId,indicatorData:t.rankingIndicators,defaultBizIndicator:t.rankingDataShowType,defaultShopIndicator:t.rankingDataShowType}}),a("group-age-gender",{attrs:{outRange:t.outRange}})]],2)},Dt=[],wt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{position:"relative"}},[a("div",{staticClass:"comport-list"},[a("div",{staticClass:"bg-white dashboard-box"},[a("vs-row",{attrs:{type:"flex"}},[a("vs-col",{staticClass:"vs-list",attrs:{"vs-lg":"6","vs-xs":"12"}},[a("p",{staticClass:"fontSize"},[t._v("当日累积客流（人）")]),a("p",{staticClass:"dayEnter  font-number font-semibold"},[t._v(t._s(t.rightShoppingList.currentDay))]),a("div",{staticClass:"month-data"},[a("p",{staticClass:"font-normal"},[t._v(" 当月累积客流（人）")]),a("p",{staticClass:"font-number "},[t._v(t._s(t.rightShoppingList.currentMonthly))])])]),a("vs-col",{staticClass:"vs-list",staticStyle:{position:"relative"},attrs:{"vs-lg":"6","vs-xs":"12"}},[a("vue-apex-charts",{attrs:{type:"radialBar",height:"250",options:t.chartOptions,series:t.rightShoppingList.achievingRate}}),a("div",{staticClass:"month-values"},[a("p",{staticClass:"text-base text-grey font-normal"},[t._v("月达标值（人）")]),a("p",{staticClass:"text-lg text-grey font-number font-normal"},[t._v(t._s(t.rightShoppingList.monthlyGoal))])])],1)],1)],1)])])},kt=[],At={name:"dashBoard",props:{rightShoppingList:{type:Object}},components:{VueApexCharts:Y.a},data:function(){return{isheight:!1,pullDownImg:a("b215"),pullUpImg:a("dfac"),shopData:{currentDay:0,currentMonthly:0,monthlyGoal:0,achievingRate:[30]}}},computed:{chartOptions:function(){return{plotOptions:{radialBar:{size:100,startAngle:-150,endAngle:150,hollow:{size:"65%"},track:{background:"#fff",strokeWidth:"100%"},dataLabels:{value:{offsetY:15,color:"#99a2ac",fontSize:"18px"}}}},colors:["#EA5455"],fill:{type:"gradient",gradient:{shade:"dark",type:"horizontal",shadeIntensity:.5,gradientToColors:["#7367F0"],inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,1e3]}},stroke:{dashArray:8},chart:{sparkline:{},fontFamily:"source_han_sans_cn"},labels:["本月客流达成率"],responsive:[{breakpoint:1576,options:{plotOptions:{radialBar:{size:80}}}},{breakpoint:1200,options:{plotOptions:{radialBar:{size:100}}}}]}}},mounted:function(){var t={code:200,message:"",data:{main:[{name:"Dashboard",router:"/",id:1,cname:"首页",subpagesList:[{name:"GroupCompany",router:"",id:8,cname:"集团页面"},{name:"Shopping",router:null,id:9,cname:"购物中心页面"},{name:"VIPRecode",router:null,id:10,cname:"VIP顾客提醒"}]},{name:"Analytics",router:"/footfall",id:2,cname:"客流分析",subpagesList:[{name:"Entity",router:null,id:11,cname:"实体客流分析"},{name:"DwellTime",router:null,id:12,cname:"停留时间分析"},{name:"AgeGender",router:null,id:13,cname:"性别年龄分析"},{name:"Ranking",router:null,id:14,cname:"排行占比分析"},{name:"GoShop",router:null,id:15,cname:"进店率分析"},{name:"HeatMap",router:null,id:16,cname:"热力图分析"},{name:"Effective",router:null,id:17,cname:"有效客流分析"}]},{name:"Generatrix",router:"/generatrix",id:3,cname:"动线分析",subpagesList:[{name:"Relevance",router:null,id:18,cname:"关联分析"},{name:"Cross",router:null,id:19,cname:"交叉客流分析"},{name:"PathTrend",router:null,id:20,cname:"路径动向分析"},{name:"Drainage",router:null,id:21,cname:"实体引流分析"},{name:"OldPath",router:null,id:33,cname:"路径动向分析(旧)"}]},{name:"Operation",router:"/operation",id:4,cname:"运营分析",subpagesList:[{name:"Goal",router:null,id:22,cname:"目标达成分析"},{name:"HolidayAnalysis",router:null,id:23,cname:"节假日活动分析"},{name:"SalesAnalytics",router:null,id:24,cname:"销售分析"}]},{name:"Report",router:"/report",id:5,cname:"报告详情",subpagesList:[{name:"DailyReport",router:null,id:25,cname:"日报"},{name:"WeekReport",router:null,id:26,cname:"周报"},{name:"MonthReport",router:null,id:27,cname:"月报"}]},{name:"Admin",router:"/admin",id:6,cname:"后台管理",subpagesList:[{name:"EntityManage",router:null,id:28,cname:"实体管理"},{name:"Account",router:null,id:29,cname:"账户管理"},{name:"HolidayManage",router:null,id:30,cname:"节假日活动管理"},{name:"VipCustom",router:null,id:31,cname:"VIP客户管理"},{name:"Role",router:null,id:32,cname:"权限管理"}]}]}},e=t.data.main;e.map(function(t){var e={id:t.id,name:t.name},a=t.subpagesList.map(function(t){var e={id:t.id,name:t.name};return e});return _.flattenDeep([e,a])})},methods:{rightImgClick:function(){1==this.isheight?(document.getElementById("comportAction").scrollTop=0,this.isheight=!1):this.isheight=!0,this.$emit("isRightImg",this.isheight)}}},Ct=At,It=(a("8a4e"),a("d084"),Object(k["a"])(Ct,wt,kt,!1,null,"fe7c8d2a",null)),Tt=It.exports,_t=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.canshow?a("div",[a("chart-tabs",{ref:"charts",staticClass:"bg-white box-card",attrs:{xAxis:t.xAxisObj,series:t.finnalSeries,extraOptions:t.extraOptWithYaxis,type:t.chartTypeList,istotal:!0,id:"trendLine",title:"趋势分析"},on:{tableChage:t.enterTableChage}},[a("export-menu",{attrs:{slot:"export"},on:{onchange:t.exportBiztop},slot:"export"}),[a("div",{staticClass:"flex justify-between items-center mr-10"},[a("span",{staticClass:"whitespace-no-wrap mx-4 text-sm"},[t._v("数据指标:")]),a("vs-select",{attrs:{autocomplete:"","max-selected":2,id:"chartSelect"},model:{value:t.curretIndicator,callback:function(e){t.curretIndicator=e},expression:"curretIndicator"}},t._l(t.filteredSelectList,function(t,e){return a("vs-select-item",{key:e,attrs:{text:t.name,value:t.value}})}),1)],1)]],2)],1):t._e()},Ot=[],Rt=(a("6c7b"),a("774e")),Nt=a.n(Rt),St=(a("6762"),a("2fdb"),a("01c8")),Lt=(a("4917"),a("55dd"),a("c66f")),Et={name:"Trend",props:{innerRange:{type:String,default:"1h"},companyId:{type:null,default:null},time1:{type:String,default:""},time2:{type:String,default:""},indicatorData:{type:Object,default:function(){return mt["a"]}}},components:{chartTabs:ct["a"],exportMenu:ft["a"],indicatorSelector:Lt["a"]},data:function(){return{canshow:!1,allData:[],currentData:[],current:0,curretIndicator:"enter",chartData:{},extraOpt:{yaxis:[]},isNeedRender:!0,chartTypeList:["line","bar"],tableListData:[],selectType:"",timeNumber:0}},watch:{time1:{immediate:!0,handler:function(t,e){this.timeNumber=this.timeNumber+1,this.getTrendData()}},time2:{immediate:!0,handler:function(t,e){this.getTrendData()}},propertyId:{immediate:!0,handler:function(t,e){t&&this.getTrendData()}},curretIndicator:function(t,e){try{var a=[],n=$.a.find(this.filteredSelectList,["value",t]);n=n&&n.name?n.name:"",n&&a.push(n),window.TDAPP.onEvent("集团页面","趋势分析数据指标选择",{"指标":a})}catch(i){console.log("集团页面-趋势分析数据指标选择-埋点error:"+i)}this.refreshChart()}},activated:function(){var t=this;this.canshow=!1,setTimeout(function(){t.canshow=!0})},computed:{convertInnerRange:function(){return"1h"===this.innerRange?"Hour":"1day"===this.innerRange?"Date":"1month"===this.innerRange?"Month":void 0},filteredSelectList:function(){var t=this,e=y()(this.indicatorData).map(function(e){return{value:e,name:t.indicatorData[e].name}});return"1h"===this.innerRange?e:e.filter(function(t){return"occupancy"!==t.value})},filterSeries:function(){var t=[];return y()(this.chartData).length&&t.push.apply(t,Object(h["a"])(this.chartData[this.curretIndicator].series)),t},xAxisObj:function(){var t=this.currentData.length;if(0==t)return{name:"时间",data:[],key:"time"};if(1==t){var e=this.currentData[0].data;if(200==e.code){var a=this.time1.split(","),n=m()(e.data),i={name:"时间",data:[],key:"time"};return"enter"==this.curretIndicator||"occupancy"==this.curretIndicator?(n.map(function(t){var e=y()(m()(t)[0]);e.map(function(t){a[0]==a[1]?i.data.push(x()(t.split(" - ")[0]).format("HH:mm")):i.data.push(x()(t).format("YYYY-MM-DD"))})}),i.data=$.a.uniq(i.data).sort()):y()(m()(n[0])[0]).map(function(t){return i.data.push(t)}),i}}else if(2==t){var r=this.currentData[0].data;if(200==r.code){var o={name:"时间",data:[],key:"time"};if("enter"==this.curretIndicator||"occupancy"==this.curretIndicator){var s=y()(r.data);s.map(function(t){o.data.push(t)})}else{var c=m()(r.data);y()(c[0]).map(function(t){return o.data.push(t)})}return o}}},allSeriesKeys:function(){return this.filterSeries.map(function(t){return t.key.match(/[A-Za-z]+/)[0]})},extraOptWithYaxis:function(){if(this.yaxisArr.length){var t=Object(d["a"])({},this.extraOpt,{yaxis:this.yaxisArr}),e={yaxis:[]};return t.yaxis[3]?(e.yaxis.push(t.yaxis[0]),e.yaxis.push(t.yaxis[2]),e):(e.yaxis.push(t.yaxis[0]),e)}return delete this.extraOpt.yaxis,this.extraOpt},yaxisArr:function(){var t=this,e=this.allSeriesKeys.map(function(e,a){var n=$.a.cloneDeep(t.indicatorData[e].yaxis);return n.seriesName=e,n.title.style={fontSize:"13px"},n}),a=$.a.groupBy(e,"seriesName");return y()(a).forEach(function(t){var e=a[t],n=Object(St["a"])(e),i=n.slice(1);i.forEach(function(t){t.show=!1})}),y()(a).length>1&&(m()(a)[1][0].opposite=!0),e},finnalSeries:function(){var t=this,e=this,a=this.currentData.length,n=[];if(0==a)return n;if(1==a){var i=this.currentData[0].data;if(200==i.code){var r=this.time1.split(",");if("enter"==this.curretIndicator||"occupancy"==this.curretIndicator){var o=y()(i.data);o.map(function(a){var o={};if(o.name=a,o.key=t.curretIndicator+"_"+a+"_"+e.time1,o.data=[],r[0]==r[1]){var s=$.a.cloneDeep(m()(i.data[a])[0]);t.xAxisObj.data.map(function(t){var e=0;$.a.forIn(s,function(a,n){var i=x()(n.split(" - ")[0]).format("HH:mm");t==i&&(e++,Number(t)<0?o.data.push(0):o.data.push(a))}),0==e&&o.data.push(null)})}else{var c=m()(m()(i.data[a])[0]);c.map(function(t){Number(t)<0?o.data.push(0):o.data.push(t)})}n.push(o)})}else{var s=m()(i.data);y()(s[0]).map(function(t){var e={};e.name=t,e.key=t,e.data=[],m()(s[0][t]).map(function(t){return e.data.push(t)}),n.push(e)})}return n}}else if(2==a){var c=this.currentData[0].data;if(200==c.code)return e.curretIndicator.map(function(t,a){var i={};i.name=e.nameList(t),i.key=t+"_"+e.time1,i.data=[];var r=e.currentData[a].data.data;if("enter"==t||"occupancy"==t){var o=y()(r);o.map(function(t){var e=m()(r[t])[1];Number(e)<0?i.data.push(0):i.data.push(e)})}else m()(m()(r)[0]).map(function(t){i.data.push($.a.sum(m()(t)))});n.push(i)}),n}},canSelectMulti:function(){return!this.time2}},methods:{getTrendData:$.a.debounce(function(t){var e=this,a=this.time1,n=this.time2,i=this.companyId,r=this.indicatorData,o=y()(r).map(function(t){var r={time1:a,time2:n,type:t,company_id:i,range:e.convertInnerRange};return["enter","occupancy"].includes(t)?Object(lt["d"])(r):("Hour"===e.convertInnerRange&&(r.range="Date"),Object(W["m"])(r))});u.a.all(o).then(function(t){var a={};y()(r).forEach(function(i,o){var s=t[o].data.data,c=y()(s).map(function(t){var e=s[t],a=m()(e);return a=a.map(function(t){return Number(t)<0?0:t}),["CloseRate","RepeatPurchaseRate"].includes(i)&&(a=a.map(function(t){return B.a.times(t,100)})),{name:n?"".concat(r[i].name," ").concat(t.split(",").join(" - ")):r[i].name,key:"".concat(i,"_").concat(t),data:a}}),l=[];if(n&&"1h"!==e.innerRange){var u=c[0].data.length,d=c[1].data.length,p=Math.max(u,d);l=Nt()({length:p},function(t,a){return"第".concat(a+1).concat("1day"===e.innerRange?"天":"月")}),c.forEach(function(t){if(t.data.length<p){var e=new Array(p-t.data.length);e.fill(null),t.data=[].concat(Object(h["a"])(t.data),e)}})}else{var f=s[y()(s)[0]],g=y()(f);g[0]&&(l=g[0].split(" ").length>1?g.map(function(t){var e=t.split(" ");return e[1].slice(0,5)}):g)}a[i]={series:c,xAxis:l}}),e.chartData=a,e.allData=t,e.canshow=!0,e.refreshChart()}).catch(function(t){console.log(t)})},100),refreshChart:function(){var t=this,e=[];switch(this.curretIndicator){case"enter":e.push(t.allData[0]);break;case"occupancy":e.push(t.allData[1]);break;case"SaleAmount":e.push(t.allData[2]);break;case"SquaerMetre":e.push(t.allData[3]);break;case"CloseRate":e.push(t.allData[4]);break;case"UnitPrice":e.push(t.allData[5]);break}this.currentData=e},nameList:function(t){var e="";switch(t){case"enter":e="客流量";break;case"occupancy":e="集客量";break;case"SaleAmount":e="销售额";break;case"SquaerMetre":e="坪效";break;case"CloseRate":e="成交率";break;case"UnitPrice":e="客单价";break}return e},exportBiztop:function(){var t=this.time1.split(","),e=$.a.cloneDeep(this.tableListData);t[0]==t[1]&&e[1].map(function(e){e.time=t[0]+"  "+e.time});try{window.TDAPP.onEvent("集团页面","趋势分析数据指标下载",{})}catch(a){console.log(eventName+"集团页面-趋势分析数据指标下载-埋点error:"+a)}Object(W["b"])(e).then(function(t){var e=new Date,a=new Blob([t.data]),n="集团趋势分析",i=n+x()(e).format("YYYYMMDDHHmmss")+".xls",r=document.createElement("a");r.download=i,r.style.display="none",r.href=URL.createObjectURL(a),document.body.appendChild(r),r.click(),URL.revokeObjectURL(r.href),document.body.removeChild(r)})},enterTableChage:function(t){this.tableListData=t.data}}},jt=Et,Mt=Object(k["a"])(jt,_t,Ot,!1,null,null,null),zt=Mt.exports,Yt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"group-client"},[a("div",{staticClass:" box-card left"},[a("div",{staticClass:"title"},[a("p",[t._v("新老顾客占比\n          "),a("Tooltip",{attrs:{content:t.tootipText,placement:"bottom",theme:"light",transfer:"","max-width":"600"}},[a("icons",{attrs:{type:"wenhao"}})],1)],1),a("ul",t._l(t.iconList,function(e,n){return a("li",{key:n,attrs:{title:t.iconTitle[e.type]},on:{click:function(e){t.iconClick(n,"client")}}},[a("icons",{attrs:{type:e.type,size:20,color:t.clientIconIndex===e.value?t.iconColor:"#9D9D9DFF"}})],1)}))]),0==this.clientIconIndex?a("vue-apex-charts",{ref:"clientBar",attrs:{height:"500",type:"bar",options:t.clientOptions,series:t.clientSeries}}):a("table-default",{staticClass:"groupTable",attrs:{tableName:t.clientName,tableList:t.clientTableList}})],1),a("div",{staticClass:" box-card center"},[a("div",{staticClass:"title"},[a("p",[t._v("性别分布")]),a("ul",t._l(t.iconList,function(e,n){return a("li",{key:n,attrs:{title:t.iconTitle[e.type]},on:{click:function(e){t.iconClick(n,"gender")}}},[a("icons",{attrs:{type:e.type,size:20,color:t.genderIconIndex===e.value?t.iconColor:"#9D9D9DFF"}})],1)}))]),0==this.genderIconIndex?a("vue-apex-charts",{ref:"genderBar",attrs:{height:"500",type:"bar",options:t.genderChartOptions,series:t.genderSeries}}):a("table-default",{staticClass:"groupTable",attrs:{tableName:t.genderName,tableList:t.genderTableList}})],1)]),a("div",{staticClass:" group-age-gender"},[a("div",{staticClass:"box-card left"},[a("div",{staticClass:"title"},[a("p",[t._v("年龄分布")]),a("ul",t._l(t.iconList,function(e,n){return a("li",{key:n,attrs:{title:t.iconTitle[e.type]},on:{click:function(e){t.iconClick(n,"age")}}},[a("icons",{attrs:{type:e.type,size:20,color:t.iconIndex===e.value?t.iconColor:"#9D9D9DFF"}})],1)}))]),0==t.iconIndex?a("vue-apex-charts",{ref:"ageGenderBar",attrs:{height:"500",type:"bar",options:t.ageOptions,series:t.ageSeries}}):a("table-default",{staticClass:"groupTable",attrs:{tableName:t.ageName,tableList:t.ageTableList}})],1),a("div",{staticClass:" box-card right"},[a("div",{staticClass:"title"},[a("p",[t._v("到店次数占比")]),a("ul",t._l(t.iconList,function(e,n){return a("li",{key:n,attrs:{title:t.iconTitle[e.type]},on:{click:function(e){t.iconClick(n,"frequency")}}},[a("icons",{attrs:{type:e.type,size:20,color:t.frequencyIconIndex===e.value?t.iconColor:"#9D9D9DFF"}})],1)}))]),0==this.frequencyIconIndex?a("vue-apex-charts",{ref:"frequencyBar",attrs:{height:"500",type:"bar",options:t.frequencyOptions,series:t.frequencySeries}}):a("table-default",{staticClass:"groupTable",attrs:{tableName:t.frequencyName,tableList:t.frequencyTableList}})],1)])])},Pt=[],Bt=a("63d9"),Ft={name:"group-age-gender",props:{outRange:String,default:""},components:{VueApexCharts:Y.a,TableDefault:Bt["a"]},data:function(){return{downLoadIcon:"daoru",tootipText:"新顾客：在所选时间段内仅来过1次的人数\n老顾客：在所选时间段内来过2次及以上的人数",iconColor:"rgb(34, 128, 215)",iconIndex:0,frequencyIconIndex:0,vipIconIndex:0,clientIconIndex:0,genderIconIndex:0,iconList:[{type:"62",color:"#9D9D9DFF",value:0},{type:"biaoge-copy",color:"#9D9D9DFF",value:1},{type:"daoru",color:"#9D9D9DFF",value:2}],iconTitle:{62:"柱状图","biaoge-copy":"详细数据",daoru:"下载"},ageName:["购物中心"],ageTableList:[],frequencyName:["购物中心"],frequencyTableList:[],clientName:["购物中心"],clientTableList:[],genderName:["购物中心"],genderTableList:[],vipName:["购物中心"],vipTableList:[],ageSeries:[],ageOptions:{chart:{stacked:!0,toolbar:{show:!1}},dataLabels:{enabled:!1},plotOptions:{bar:{columnWidth:"20%"}},responsive:[{breakpoint:480,options:{legend:{position:"bottom",offsetX:-10,offsetY:0}}}],xaxis:{categories:[]},yaxis:{labels:{formatter:function(t){return Number(t).toLocaleString()}}},fill:{opacity:1},tooltip:{y:{formatter:function(t){return t.toLocaleString()}}},colors:["#2BD9CF","#00A0E9","#33b3ed","#FBA940","#EC7172"],legend:{position:"bottom",offsetX:0,offsetY:0}},frequencySeries:[],frequencyOptions:{chart:{stacked:!0,toolbar:{show:!1}},dataLabels:{enabled:!1},plotOptions:{bar:{columnWidth:"20%"}},responsive:[{breakpoint:480,options:{legend:{position:"bottom",offsetX:-10,offsetY:0}}}],xaxis:{categories:[]},yaxis:{labels:{formatter:function(t){return Number(t).toLocaleString()}}},fill:{opacity:1},tooltip:{y:{formatter:function(t){return t.toLocaleString()}}},colors:["#2BD9CF","#00A0E9","#33b3ed","#FBA940","#EC7172"],legend:{position:"bottom",offsetX:0,offsetY:0}},clientSeries:[],clientOptions:{chart:{stacked:!1,toolbar:{show:!1}},dataLabels:{enabled:!1},plotOptions:{bar:{columnWidth:"40%",endingShape:"rounded"}},responsive:[{breakpoint:480,options:{legend:{position:"bottom",offsetX:-10,offsetY:0}}}],xaxis:{categories:[]},yaxis:{labels:{formatter:function(t){return Number(t).toLocaleString()}}},fill:{opacity:1},tooltip:{y:{formatter:function(t){return t.toLocaleString()}}},legend:{position:"bottom",offsetX:0,offsetY:0}},genderSeries:[],genderChartOptions:{chart:{stacked:!1,toolbar:{show:!1}},dataLabels:{enabled:!1},plotOptions:{bar:{columnWidth:"40%",endingShape:"rounded"}},responsive:[{breakpoint:480,options:{legend:{position:"bottom",offsetX:-10,offsetY:0}}}],colors:["rgb(0, 160, 233)","#ee7552"],xaxis:{categories:[]},yaxis:{labels:{formatter:function(t){return Number(t).toLocaleString()}}},fill:{opacity:1},tooltip:{y:{formatter:function(t){return t.toLocaleString()}}},legend:{position:"bottom",offsetX:0,offsetY:0}},vipSeries:[],vipChartOptions:{chart:{stacked:!1,toolbar:{show:!1}},dataLabels:{enabled:!1},plotOptions:{bar:{columnWidth:"20%",endingShape:"rounded"}},responsive:[{breakpoint:480,options:{legend:{position:"bottom",offsetX:-10,offsetY:0}}}],xaxis:{categories:[]},yaxis:{labels:{formatter:function(t){return Number(t).toLocaleString()}}},fill:{opacity:1},tooltip:{y:{formatter:function(t){return t.toLocaleString()}}},legend:{position:"bottom",offsetX:0,offsetY:0}},ageTabList:[],genderTabList:[],customTabList:[],numTabList:[],downloadName:""}},computed:{},mounted:function(){},updated:function(){},activated:function(){this.initializeData()},watch:{outRange:function(){this.dataList()}},methods:{dataList:function(){var t=this,e=this,a=this.$store.state.user.companyId,n={range:this.outRange,company_id:a};Object(W["j"])(n).then(function(a){if(200==a.data.code){t.initializeData();var n=a.data.data;t.uploadChartXaxis("age",n.age_distribution,"ageSeries","ageGenderBar","ageOptions"),t.uploadChartXaxis("number",n.arrival_distribution,"frequencySeries","frequencyBar","frequencyOptions"),t.uploadChartXaxis("client",n.new_old_proportion,"clientSeries","clientBar","clientOptions");var i=y()(n.gender_propotion),r=m()(n.gender_propotion);0!=r.length&&y()(r[0]).map(function(t,a){var n={};n.name=0==a?"男性":"女性",n.data=[],r.map(function(t){n.data.push(t[a])}),e.genderSeries.push(n)}),t.genderChartOptions.xaxis.categories=i,e.$refs.genderBar.updateOptions({xaxis:{categories:e.genderChartOptions.xaxis.categories}}),e.genderSeries.map(function(t){e.genderName.push(t.name)}),i.map(function(t,a){var n={};n.name=t,n.percentList=[],e.genderSeries.map(function(t){n.percentList.push(Number(t.data[a]).toLocaleString())}),e.genderTableList.push(n)})}})},uploadChartXaxis:function(t,e,a,n,i){var r,o=this;switch(t){case"age":r=this.dataAssemble(e,"age");break;case"number":r=this.dataAssemble(e,"number");break;case"client":r=this.clinetAssemble(e,"client");break;case"vip":r=this.clinetAssemble(e,"vip");break}this[a]=r.series,this[i].xaxis.categories=r.xaxis,this.$refs[n].updateOptions({xaxis:{categories:o[i].xaxis.categories}})},dataAssemble:function(t,e){var a=this,n={xaxis:y()(t),series:[]},i=m()(t),r=y()(i[0]);return r.map(function(t,a){var o,s={};"number"==e?(o=Number(t)==r.length?t+"次及以上":t+"次",s.name=o):s.name=t;s.data=[],i.map(function(a,n){$.a.forIn(a,function(a,n){var i;t==n&&(i="age"==e?Number(a.female)+Number(a.male):a,s.data.push(i))})}),n.series.push(s)}),n.series.map(function(t){"age"==e?a.ageName.push(t.name):a.frequencyName.push(t.name)}),n.xaxis.map(function(t,i){var r={};r.name=t,r.percentList=[],n.series.map(function(t){r.percentList.push(Number(t.data[i]).toLocaleString())}),"age"==e?a.ageTableList.push(r):a.frequencyTableList.push(r)}),n},clinetAssemble:function(t,e){var a=this,n={xaxis:y()(t),series:[]},i=m()(t),r=y()(i[0]);return r.map(function(t){var a={};a.name="client"==e?"newNum"==t?"新顾客":"老顾客":"vipNum"==t?"VIP顾客":"普通顾客",a.data=[],i.map(function(e){$.a.forIn(e,function(e,n){t==n&&a.data.push(e)})}),n.series.push(a)}),n.series.map(function(t){"client"==e?a.clientName.push(t.name):a.vipName.push(t.name)}),n.xaxis.map(function(t,i){var r={};r.name=t,r.percentList=[],n.series.map(function(t){r.percentList.push(Number(t.data[i]).toLocaleString())}),"client"==e?a.clientTableList.push(r):a.vipTableList.push(r)}),n},iconClick:function(t,e){switch(e){case"vip":2==t?this.downloadVipData():this.vipIconIndex=t;break;case"client":2==t?this.downloadCusData():this.clientIconIndex=t;break;case"gender":2==t?this.downloadGenData():this.genderIconIndex=t;break;case"frequency":2==t?this.downloadNumData():this.frequencyIconIndex=t;break;case"age":2==t?this.downloadAgeData():this.iconIndex=t;break}},initializeData:function(){this.ageSeries=[],this.ageOptions.xaxis.categories=[],this.frequencySeries=[],this.frequencyOptions.xaxis.categories=[],this.clientSeries=[],this.clientOptions.xaxis.categories=[],this.genderSeries=[],this.genderChartOptions.xaxis.categories=[],this.vipSeries=[],this.vipChartOptions.xaxis.categories=[],this.iconIndex=0,this.frequencyIconIndex=0,this.vipIconIndex=0,this.clientIconIndex=0,this.genderIconIndex=0,this.ageName=["购物中心"],this.ageTableList=[],this.frequencyName=["购物中心"],this.frequencyTableList=[],this.clientName=["购物中心"],this.clientTableList=[],this.genderName=["购物中心"],this.genderTableList=[],this.vipName=["购物中心"],this.vipTableList=[]},downloadData:function(t,e){var a=[],n=[{title:t[0],key:"name"},{title:e[0].name,key:"city1"},{title:e[1].name,key:"city2"}],i=t.map(function(a,n){var i=n,r={};return r.name=t[++i],r.city1=e[0].percentList[n],r.city2=e[1].percentList[n],r});return i.pop(),a.push(n),a.push(i),a},downloadAgeData:function(){this.ageTabList=this.downloadData(this.ageName,this.ageTableList),this.downloadName="年龄分布客流数据",this.dowloadList(this.ageTabList);try{window.TDAPP.onEvent("集团页面","年龄分布下载",{})}catch(t){console.log("集团页面-年龄分布下载-埋点error:"+t)}},downloadGenData:function(){this.genderTabList=this.downloadData(this.genderName,this.genderTableList),this.downloadName="性别分布客流数据",this.dowloadList(this.genderTabList);try{window.TDAPP.onEvent("集团页面","性别分布下载",{})}catch(t){console.log("集团页面-性别分布下载-埋点error:"+t)}},downloadCusData:function(){this.customTabList=this.downloadData(this.clientName,this.clientTableList),this.downloadName="新老顾客占比数据",this.dowloadList(this.customTabList);try{window.TDAPP.onEvent("集团页面","新老顾客占比下载",{})}catch(t){console.log("集团页面-新老顾客占比下载-埋点error:"+t)}},downloadNumData:function(){this.numTabList=this.downloadData(this.frequencyName,this.frequencyTableList),this.downloadName="顾客到店次数占比数据",this.dowloadList(this.numTabList);try{window.TDAPP.onEvent("集团页面","到店次数下载",{})}catch(t){console.log("集团页面-到店次数下载-埋点error:"+t)}},downloadVipData:function(){},dowloadList:function(t){var e=this;Object(W["b"])(t).then(function(t){var a=new Date,n=new Blob([t.data]),i=e.downloadName,r=i+x()(a).format("YYYYMMDDHHmmss")+".xls",o=document.createElement("a");o.download=r,o.style.display="none",o.href=URL.createObjectURL(n),document.body.appendChild(o),o.click(),URL.revokeObjectURL(o.href),document.body.removeChild(o)})}},deactivated:function(){}},Vt=Ft,qt=(a("9316"),Object(k["a"])(Vt,Yt,Pt,!1,null,"69142824",null)),Gt=qt.exports,Ht={name:"groupDashboard",mixins:[pt["a"]],components:{realTimeData:C,mapCarousel:tt,Ranking:st["a"],indicatorCards:E["a"],rightData:Tt,iDatePicker:ut["a"],CustomerAnalytics:ot,singleCard:R["a"],CustomerCharts:ct["a"],groupAgeGender:Gt,groupTrend:zt},data:function(){return{currentTimeRefresh:5,isKipShow:!1,rightShoppingList:{currentDay:0,currentMonthly:0,monthlyGoal:0,achievingRate:[0]},rankingDataShowType:"enter",dayTotalEnter:0,innerRange:"1h",outRange:"",clickTimeName:"l",center:[108.948234,34.223579],zooms:[0,18],markers:[],dashboardData:{},window:"",enterArr:[],windows:[],shopData:null,gateData:null,monthTargetVal:0,todayEnter:0,monthEnter:0,kpiData:[],historyData:null,summarySalse:[],today:x()().format("YYYY-MM-DD"),footFallTypeRes:{},zones:[],intervalId:"",initRes:[],changedMenuName:"company",currentMenuName:"",currentPropertyId:null,customChecklist:{new_old_proportion:{name:"新老顾客占比",chartType:["donut"]},vip_proportion:{name:"VIP顾客占比",chartType:["radialBar"]},arrival_distribution:{name:"到店次数",chartType:["pie"]},age_distribution:{name:"年龄分布",chartType:["radar"]},gender_propotion:{name:"性别分布",chartType:["radialBar"]}},canshow:!1}},computed:{tootipText:function(){return"平均客流量：所选时间段内所有购物中心累计客流量除以购物中心个数\n总客流： 所选时间段内的所有购物中心客流之和\n客流峰值：所选时间段内的所有购物中心当中客流峰值的最大值\n集客量峰值：所选时间段内所有购物中心当中集客量峰值的最大值\n有效客流：所选时间段内所有购物中心的唯一客流人数之和\n销售额：所选时间段内所有购物中心销售额之和"},companyId:function(){return this.$store.state.user.companyId},customAnalytics:function(){var t=this,e=[];if(!y()(this.footFallTypeRes).length)return e;var a=this.footFallTypeRes;delete a.clerk_proportion,y()(a).forEach(function(n){var i={};if("gender_propotion"===n){var r={0:{name:"女",icon:"female"},1:{name:"男",icon:"male"}};i.labels={name:"性别",key:"gender",data:y()(a[n]).map(function(t){return r[t].name}),icons:y()(a[n]).map(function(t){return r[t].icon})},i.series=m()(a[n])}else if("age_distribution"===n){var o={male:"男性",female:"女性"};i.labels={name:"年龄",key:"age",data:y()(a[n]).map(function(e){return t.ageNameformat(e)})},i.series=y()(o).map(function(t){return{name:o[t],key:t,data:m()(a[n]).map(function(e){return e[t]})}})}else i.labels={name:"类型",key:n,data:y()(a[n]).map(function(t){return ht["a"][t].name}),icons:y()(a[n]).map(function(t){return ht["a"][t].icon})},i.series=m()(a[n]);i.title=t.customChecklist[n].name,i.type=t.customChecklist[n].chartType,i.height=t.customChecklist[n].height,e.push(i)});var n=[e[4],e[3],e[0],e[1],e[2]];return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e},historyIndicators:function(){var t=[].concat(Object(h["a"])(this.historyKpiData),Object(h["a"])(this.summarySalse));return t},historyNewKpi:function(){var t=this.footFallTypeRes,e=t.new_old_proportion,a=t.gender_propotion,n={id:"entermanAndWomen",name:"性别人数",data:{name1:"女性",name2:"男性",data1:a[0],data2:a[1]},type:{icon:"xingbie",color:"#E8585A"}},i={id:"enternewAndOld",name:"新老顾客",data:{name1:"新顾客",name2:"老顾客",data1:e.newNum,data2:e.oldNum},type:{icon:"xinlaoguke",color:"#857aef"}};return[n,i]},rankingIndicators:function(){return Object(d["a"])({},{enter:{name:"入客流"}},mt["a"])},filterFootfallData:function(){var t=this;if(!this.historyData)return null;var e=null;return e="company"===this.currentMenuName?this.historyData.company:$.a.find(this.historyData.property,function(e){return e.bzid===t.currentMenuName}),e},historyKpiData:function(){if(!this.filterFootfallData)return[];var t=this.filterFootfallData,e=t.enter,a=t.occupancy,n=(t.valid,this.processKPIData(e,"enter")),i=$.a.dropRight(this.processKPIData(a,"occupancy"));if("y"===this.clickTimeName)return $.a.dropRight([].concat(Object(h["a"])(n),Object(h["a"])(i)));var r={id:"entervalid",name:"有效客流",data:Number(e.unique)<0?0:e.unique,type:{icon:"youxiaokeliu",color:"#2bd9cf"}};return i.push(r),[].concat(Object(h["a"])(n),Object(h["a"])(i))},trendIndicators:function(){var t={enter:{name:"客流量",yaxis:{title:{text:"客流量（人）"},labels:{formatter:function(t){return t?t.toLocaleString():""}}}},occupancy:{name:"集客量",yaxis:{title:{text:"集客量（人）"},labels:{formatter:function(t){return t?t.toLocaleString():""}}}}};return Object(d["a"])({},t,mt["a"])}},mounted:function(){this.initRequest()},activated:function(){this.intervalClick("30秒"),this.initRequest()},watch:{outRange:function(){var t=this.getHistoryComputed();this.querHistory(t)}},methods:Object(d["a"])({},Object(X["c"])(["saveBusinessTree","saveAllTargetData"]),{isRightImg:function(t){this.isKipShow=t},ageNameformat:function(t){return t.replace("_","-").replace("less-","小于").replace(/more-/,"大于")},updateMapZoneByName:function(t){this.currentMenuName="company"===t?t:Number(t),this.currentPropertyId="company"===t?null:this.dashboardData[t].propertyId,this.shopData=this.dashboardData[t].shopData?this.dashboardData[t].shopData:null,this.shopData,this.kpiData=$.a.cloneDeep(this.dashboardData[t].compute)},selectMenuByName:function(t){this.updateMapZoneByName("".concat(t))},mapDataInit:function(t){var e=this,n=a("0e4d"),i=t[0].data.data,r=t[1].data.data,o=t[2].data.data;this.saveBusinessTree(o);var s=(new Date).getMonth(),c=this;this.windows=[];var l=[],u=[],d=0,h=i.name,p=i.property,m=r.property,f=r.company,g=[],b={};this.zones=[];var v,x=this.rightShoppingList;(x.currentDay=0,x.currentMonthly=0,x.monthlyGoal=0,x.achievingRate=[0],0!=m.length)&&(m.map(function(t){x.currentDay=Number(t.enter.total)+Number(x.currentDay),x.currentMonthly=Number(t.enter.month.number)+Number(x.currentMonthly),x.monthlyGoal=Number(t.flow_target.toFixed(0))+Number(x.monthlyGoal)}),v=0==x.monthlyGoal?1:B.a.divide(x.currentMonthly,x.monthlyGoal).toFixed(4),v=B.a.times(v,100),x.achievingRate=[v],x.currentDay=x.currentDay.toLocaleString(),x.currentMonthly=x.currentMonthly.toLocaleString(),x.monthlyGoal=x.monthlyGoal.toLocaleString());try{for(var D=function(t){var a=p[t];if($.a.isNull(a.bzid))return"continue";var i=$.a.find(m,function(t){return t.bzid===a.bzid}),r=$.a.find(o,function(t){return t.id===a.bzid});if(!i||!r)return"continue";e.zones.push(a.bzid);var h=e.processKPIData(i.enter,"enter"),f=e.processKPIData(i.occupancy,"occupancy"),v=$.a.concat(h,f),x={number:Number(i.enter.current.number).toLocaleString()};l.push({position:[Number(a.longitude),Number(a.latitude)],visible:!1,name:a.name,zoneId:a.bzid,passengerFlow:x,isexist:i.enter.isexist,offset:[0,-35]}),k=e,u.push({position:["calc("+100*Number(a.longitude)+"% - 10px)","calc("+100*Number(a.latitude)+"% - 27px)"],icon:n,enter:i.enter.total,isText:!1,img:o[t].map_url,events:{mouseover:function(){c.windows.forEach(function(t){t.visible=!1}),c.window=$.a.find(l,function(t){return t.zoneId===a.bzid}),c.$nextTick(function(){c.window.visible=!0})},click:function(){k.$store.commit("headerAction",a.property_id),c.selectMenuByName(a.bzid)}},propertyId:a.property_id,name:a.name,id:a.bzid});var D=0;if(a.goal_flow){var w=(new Date).getFullYear();a.goal_flow.map(function(t){if(t.year==w)if(g.push({id:a.bzid,data:a.goal_flow,marketData:a.goal_sale}),"year"===t.is_year)D=t.flow_year/12,d+=D;else{var e=t.detail.months;D=e[s][y()(e[s])[0]]||0,d+=D}})}b[a.bzid]={compute:v,name:a.name,targetValue:D,shopData:r,todayEnter:i.enter.total,monthEnter:i.enter.month.number,propertyId:a.property_id}},w=0;w<p.length;w++){var k;D(w)}}catch(T){console.log(T)}this.saveAllTargetData(g),this.windows=l;var A=d,C="";this.changedMenuName="company";var I=[{id:"enteravg",name:"今日平均客流量",data:f.avg,type:{icon:"avg",color:"#1dd9d1"}},{id:"enterhighest",name:"今日客流峰值",data:{number:Number(f.highest.number)<0?0:f.highest.number,timeRange:f.highest.timeRange,property:f.highest.property},type:{icon:"highest",color:"#e8585a"}},{id:"occupancyhighest",name:"今日集客量峰值",data:{number:Number(f.occupancy_highest.number)<0?0:f.occupancy_highest.number,timeRange:f.occupancy_highest.timeRange,property:f.occupancy_highest.property},type:{icon:"occu_highest",color:"#e8585a"}},{id:"occupancytotal",name:"今日集客量",data:Number(f.occupancy_total)<0?0:f.occupancy_total,type:{icon:"liuliang",color:"#857aef"}}];this.markers=u,b.company={name:h,compute:I,targetValue:A,todayEnter:f.total,monthEnter:$.a.sumBy(m,function(t){return t.enter.month.number})},C="company",this.dashboardData=b,this.updateMapZoneByName(C)},processKPIData:function(t,e){var a="";a=t.isexist?"今日":"";var n={enter:{avg:a+"平均客流量",highest:a+"客流峰值",total:a+"总客流"},occupancy:{highest:a+"集客量峰值",total:a+"集客量"}},i={total:{icon:"occupancy"===e?"liuliang":"enter_total",color:"#857aef"},avg:{icon:"avg",color:"#1dd9d1"},highest:{icon:"occupancy"===e?"occu_highest":"highest",color:"#e8585a"}},r=[],o=n[e];for(var s in o)if(o.hasOwnProperty(s)){var c=o[s],l=void 0;t[s]?$.a.isNumber(t[s])?l=Number(t[s])<0?0:t[s]:(Number(t[s].number)<0&&(t[s].number=0),l=t[s]):l=0,r.push({id:e+s,name:c,data:l,type:i[s]})}return r},selectDate:function(t,e){try{window.TDAPP.onEvent("集团页面","历史数据时间选择",{"时间段":t})}catch(a){console.log("集团页面-历史数据时间选择-埋点error:"+a)}if(""==t[0]||this.outRange==t.toString())return!1;this.clickTimeName=e,this.outRange=t.toString(),this.innerRange=Object(dt["j"])(t)},initDateDuration:function(){var t="YYYY-MM-DD",e=x()().add(-1,"days").format(t),a=x()().add(-1,"days").format(t),n="".concat(a,",").concat(e);return n},getCustom:function(){var t={range:this.outRange};if("company"===this.currentMenuName?t.bzid&&delete t.bzid:t.bzid=this.currentMenuName,t.bzid)return Object(W["j"])(t)},getHistoryComputed:function(){var t={companyId:this.companyId,timeRange:this.outRange};return Object(W["x"])(t)},intervalClick:function(t){var e,a=this;this.currentTimeRefresh=t,clearInterval(this.intervalId),"30秒"==t?e=3e4:"5分钟"==t?e=3e5:"10分钟"==t?e=6e5:"20分钟"==t?e=12e5:"30分钟"==t&&(e=18e5),this.intervalId=setInterval(function(){a.updateRealTimezone()},e)},updateRealTimezone:function(){var t=this,e=this.companyId;u.a.all([Object(W["h"])({time:this.today,companyId:e,offset:60})]).then(function(e){t.$set(t.initRes,1,e[0]),t.mapDataInit(t.initRes)}).catch(function(t){console.log(t)})},initRequest:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(){var e,a,n,i,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.outRange=this.initDateDuration(),e=this.companyId,t.next=4,u.a.all([Object(W["k"])(),Object(W["h"])({time:this.today,companyId:e,offset:60}),Object(lt["b"])({entity:52})]);case 4:this.initRes=t.sent,a=this.$store.state.user.bzid,n=this.initRes[2],i=[],n.data.data.forEach(function(t){a.indexOf(t.id)>-1&&t.children.forEach(function(t){t.area&&t.area.forEach(function(t){var e={};e.id=t.id,e.value=t.id,e.key=t.id,e.name=t.name,e.text=t.name,e.label=t.name,i.push(e)})})}),this.$store.commit("setAreaList",i),this.mapDataInit(this.initRes),this.canshow=!0,r=this.getHistoryComputed(),this.querHistory(r);case 14:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),querHistory:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var a,n,i,r,o,c;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return a=[this.getSalesData({time1:this.outRange,company_id:this.companyId}),this.getCustom()],e&&a.push(e),t.next=4,u.a.all(a);case 4:n=t.sent,i=Object(s["a"])(n,3),r=i[0],o=i[1],c=i[2],this.summarySalse=r.filter(function(t){return"SaleAmount"==t.id}),o&&(this.footFallTypeRes=o.data.data),c&&(this.historyData=c.data.data);case 9:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),updateHistoryRes:function(t,e){for(var a in t.company.enter)if(t.company.enter.hasOwnProperty(a)){var n=t.company.enter[a];n.hasOwnProperty("lastRatio")&&delete n.lastRatio,n.hasOwnProperty("ringRatio")&&delete n.ringRatio,n.number=e.company[a].hasOwnProperty("number")?e.company[a].number:e.company[a]}t.property.forEach(function(t,a){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];if("enter"===n||"occupancy"===n)for(var r in i)if(i.hasOwnProperty(r)){var o=i[r];o.hasOwnProperty("lastRatio")&&delete o.lastRatio,o.hasOwnProperty("ringRatio")&&delete o.ringRatio,o.number=e.property[a][n][r].hasOwnProperty("number")?e.property[a][n][r].number:e.property[a][n][r]}}})}}),deactivated:function(){this.intervalId&&clearInterval(this.intervalId)}},Ut=Ht,Kt=(a("1dd6"),a("aec5"),Object(k["a"])(Ut,xt,Dt,!1,null,"03d17679",null)),$t=Kt.exports,Wt={name:"dashboardHome",components:{shoppingDashboard:vt,groupDashboard:$t},data:function(){return{showData:!1}},created:function(){var t,e,a=JSON.parse(window.localStorage.getItem("menulist")),n=_.find(a,["name","Dashboard"]).subpagesList,i=_.find(n,["name","GroupCompany"]).id+"",r=_.find(n,["name","Shopping"]).id+"";t=_.indexOf(this.$store.state.user.access,i)>-1,e=_.indexOf(this.$store.state.user.access,r)>-1;var o=this.$store.state.user.shopUserName;t||e?this.showData=!0:(this.$router.push(o),this.showData=!1)},computed:{headerType:function(){var t;if(1==this.$store.state.user.role_id||2==this.$store.state.user.role_id)t=0!=this.$store.state.home.headerAction;else{var e=JSON.parse(window.localStorage.getItem("menulist")),a=_.find(e,["name","Dashboard"]).subpagesList;a=_.find(a,["name","GroupCompany"]).id+"";var n=_.indexOf(this.$store.state.user.access,a)>-1;if(n)t=!1;else{t=!0;var i=this.$store.state.user.checklist;this.$store.commit("headerAction",i[0])}}return t}},mounted:function(){},activated:function(){},watch:{},methods:{},deactivated:function(){}},Xt=Wt,Qt=Object(k["a"])(Xt,n,i,!1,null,null,null);e["default"]=Qt.exports},"0e4d":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAYFBMVEUAAAA/leQ/luQ/luY/luU/mOY+mOo/leQ/leVAleU/leVAluU/luU/luRAluVAleU/luVAmeY/luU/luVAluU/leU/luU+leU/lec/leg3ku07netAluU/luRBl+VAluXMxcEBAAAAH3RSTlMA5vlRTCgYOPTv1qefmJOHYBTp4MG7dDo1IA4NiIU7R72tagAAAIVJREFUGNNtj0kSgzAMBC3vC7ax2SGJ///LqADlkKJv6ippRuyRklyrUy40C0gb0yKCuOYe1BoqhFVBzxDNP4I3hIuFaxS5k+1Gdi8U3gQSwXgUdnckYLco+GFJuIOfKyOJ0fj/o/mMXeYrdjZW38VUHIaosBhVj1KzLYH8PfeeanOpsCe+QW8L0QSKJAcAAAAASUVORK5CYII="},"12c7":function(t,e,a){"use strict";var n=a("e7d5"),i=a.n(n);i.a},1425:function(t,e,a){},"1dd6":function(t,e,a){"use strict";var n=a("671b"),i=a.n(n);i.a},2373:function(t,e,a){},2731:function(t,e,a){"use strict";var n=a("2373"),i=a.n(n);i.a},"32a1":function(t,e,a){},"32d8":function(t,e,a){t.exports=a("a222")},"36af":function(t,e,a){},"49b5":function(t,e,a){},5010:function(t,e,a){"use strict";var n=a("ea8e"),i=a.n(n);i.a},"50c5":function(t,e,a){},"5eb7":function(t,e,a){},"60ed":function(t,e,a){"use strict";var n=a("6b1b"),i=a.n(n);i.a},"63d9":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("vx-card",{staticClass:"headline",attrs:{title:t.tableTitle}},[a("vs-table",{attrs:{data:t.tableList,noDataText:t.name},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.data;return t._l(n,function(e,i){return a("vs-tr",{key:i},[n[i].name?a("vs-td",{attrs:{data:n[i].name}},[t._v("\n          "+t._s(n[i].name)+"\n        ")]):t._e(),n[i].type?a("vs-td",{attrs:{data:n[i].type}},[t._v("\n          "+t._s(n[i].type)+"\n        ")]):t._e(),n[i].time?a("vs-td",{attrs:{data:n[i].time}},[t._v("\n          "+t._s(n[i].time)+"\n        ")]):t._e(),n[i].avg?a("vs-td",{attrs:{data:n[i].avg}},[t._v("\n          "+t._s(n[i].avg)+"\n        ")]):t._e(),n[i].enter?a("vs-td",{attrs:{data:n[i].enter}},[t._v("\n          "+t._s(n[i].enter)+"\n        ")]):t._e(),n[i].percent?a("vs-td",{attrs:{data:n[i].percent}},[t._v("\n          "+t._s(n[i].percent)+"%\n        ")]):t._e(),t._l(n[i].percentList,function(e,r){return n[i].percentList?a("vs-td",{key:r,attrs:{data:n[i].percentList}},[t._v("\n          "+t._s(e)+"\n        ")]):t._e()})],2)})}}])},[a("template",{slot:"thead"},t._l(t.tableName,function(e,n){return a("vs-th",{key:n,staticClass:"table-title"},[t._v(t._s(e))])}),1)],2)],1)},i=[],r={name:"dwell-time-table",props:{tableTitle:{type:String,default:""},tableName:{type:Array,default:[]},tableList:{type:Array,default:[]}},data:function(){return{name:"暂无数据"}}},o=r,s=(a("99d7"),a("2877")),c=Object(s["a"])(o,n,i,!1,null,null,null);e["a"]=c.exports},"64ea":function(t,e,a){t.exports=a.p+"img/map.eecf43ed.png"},"671b":function(t,e,a){},"67af":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"datePickerbox"},[a("DatePicker",{staticClass:"idatePicker",staticStyle:{width:"100%"},attrs:{transfer:"",type:"daterange",options:t.options,placement:"bottom-end",placeholder:"时间",editable:!1},on:{"on-change":t.selectDate},model:{value:t.defaultDate,callback:function(e){t.defaultDate=e},expression:"defaultDate"}})],1)},i=[],r=(a("ac6a"),a("c5f6"),a("c1df")),o=a.n(r),s=a("2ef0"),c=a.n(s),l={name:"idatePicker",props:{value:{type:Array,default:function(){return[o()().add(-1,"d").toDate(),o()().add(-1,"d").toDate()]}},dType:{type:Number,default:1}},data:function(){var t=this;return{clickTimeName:"l",options:{shortcuts:[{text:"今 日",value:function(){var t=new Date,e=new Date;return[e,t]},onClick:function(e){t.clickTimeName="t"}},{text:"昨 日",value:function(){var t=new Date,e=new Date;return e.setTime(e.getTime()-864e5),t.setTime(t.getTime()-864e5),[e,t]},onClick:function(e){t.clickTimeName="l"}},{text:"上 周",value:function(){var t=new Date,e=new Date;return e.setTime(o()().startOf("week").add(-6,"day").format("x")),t.setTime(o()().startOf("week").format("x")),[e,t]},onClick:function(e){t.clickTimeName="w"}},{text:"上 月",value:function(){var t=new Date,e=new Date;return e.setTime(o()().startOf("month").add(-1,"day").startOf("month").format("x")),t.setTime(o()().startOf("month").add(-1,"day").format("x")),[e,t]},onClick:function(e){t.clickTimeName="m"}},{text:"今 年",value:function(){var t=new Date,e=new Date,a=o()().dayOfYear()-1;return e.setTime(e.getTime()-864e5*a),[e,t]},onClick:function(e){t.clickTimeName="y"}}],disabledDate:function(t){return o()(t).isAfter(o()())}}}},computed:{defaultDate:{get:function(){var t=c.a.cloneDeep(this.value);return t},set:function(t){return t}}},watch:{"$store.state.home.headerAction":function(){this.value=[];var t=[o()().add(-1,"d").toDate(),o()().add(-1,"d").toDate()];this.value=t}},activated:function(){this.value=[];var t=[o()().add(-1,"d").toDate(),o()().add(-1,"d").toDate()];this.value=t},mounted:function(){},methods:{selectDate:function(t){var e=[],a="YYYY-MM-DD",n=o()().format(a),i=o()().add(-1,"M").daysInMonth(),r=o()().dayOfYear();this.options.shortcuts.forEach(function(t){var a=[];t.value().forEach(function(t){a.push(o()(t).format("YYYY-MM-DD"))}),e.push(a)});var s=[];if(e.forEach(function(e){c.a.isEqual(e,t)&&s.push(e)}),s.length){var l=Math.abs(o()(t[0]).diff(t[1],"d"));0===l&&(c.a.difference(t,[n,n]).length?this.clickTimeName="l":this.clickTimeName="t"),6===l&&(this.clickTimeName="w"),l===i&&(this.clickTimeName="m"),l===r&&(this.clickTimeName="y")}else this.clickTimeName="";this.$emit("selectDate",t,this.clickTimeName,this.dType)}}},u=l,d=(a("a5dd"),a("2877")),h=Object(d["a"])(u,n,i,!1,null,"110a81c2",null);e["a"]=h.exports},"6b1b":function(t,e,a){},"6b92":function(t,e,a){"use strict";var n=a("cf91"),i=a.n(n);i.a},"72bd":function(t,e,a){t.exports=a.p+"img/floorimage.3004ff29.jpg"},7745:function(t,e,a){"use strict";var n=a("914a"),i=a.n(n);i.a},"7f3f":function(t,e,a){},"840e":function(t,e,a){"use strict";var n=a("1425"),i=a.n(n);i.a},"850c":function(t,e,a){"use strict";var n=a("63b6"),i=a("20fd");n(n.S+n.F*a("294c")(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){var t=0,e=arguments.length,a=new("function"==typeof this?this:Array)(e);while(e>t)i(a,t,arguments[t++]);return a.length=e,a}})},"8a2e":function(t,e,a){"use strict";var n=a("5eb7"),i=a.n(n);i.a},"8a4e":function(t,e,a){"use strict";var n=a("0018"),i=a.n(n);i.a},"8c12":function(t,e,a){t.exports=a.p+"img/map-icon.6d4a9a64.png"},"8d9f":function(t,e,a){},"914a":function(t,e,a){},"92f6":function(t,e,a){"use strict";e["a"]={newNum:{name:"新顾客",icon:"kehulianxiren1"},oldNum:{name:"老顾客",icon:"kehulianxiren"},ordinaryNum:{name:"普通顾客",icon:"xingming"},vipNum:{name:"VIP顾客",icon:"shengjivip"},clertNum:{name:"工作人员",icon:"yingpinzhiwei"},customerNum:{name:"顾客",icon:"Group-"},1:{name:"1次",icon:"circle"},2:{name:"2次",icon:"circle"},3:{name:"3次",icon:"circle"},4:{name:"4次",icon:"circle"},5:{name:"5次及以上",icon:"circle"}}},9316:function(t,e,a){"use strict";var n=a("49b5"),i=a.n(n);i.a},"99d7":function(t,e,a){"use strict";var n=a("36af"),i=a.n(n);i.a},a222:function(t,e,a){a("850c"),t.exports=a("584a").Array.of},a5dd:function(t,e,a){"use strict";var n=a("7f3f"),i=a.n(n);i.a},a6d3:function(t,e,a){},a82d:function(t,e,a){"use strict";var n=a("a6d3"),i=a.n(n);i.a},ab30:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mt-6 ranking-box"},[a("div",{staticClass:"box-card bg-white"},[a("chart-tabs",{attrs:{title:t.mallTitle,xAxis:t.leftXaxis,series:t.leftSeries,type:["bar"],horizonta:""}})],1),a("div",{staticClass:"box-card bg-white"},["bar"===t.chartType?[a("chart-tabs",{attrs:{title:t.formatTitle,xAxis:t.rightXaxis,series:t.rightValue,type:["bar"],horizonta:""}})]:[a("div",{staticClass:"pieTitle"},[t._v("客流占比")]),t.isNodata?a("div",{staticClass:"pieNoData"}):t._e(),a("vue-apex-charts",{ref:"pieCharts",attrs:{width:"100%",height:"400",type:"pie",options:t.peiOptions,series:t.pieSeries}})]],2)])},i=[],r=(a("7f7f"),a("7514"),a("6b54"),a("795b")),o=a.n(r),s=(a("ac6a"),a("5df3"),a("c5f6"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.canshow?a("i-tabs",{model:{value:t.current,callback:function(e){t.current=e},expression:"current"}},[t._t("default",null,{slot:"select"}),t._l(t.tabsInfo,function(e,n){return a("tab-item",{key:n,attrs:{icon:t.iconCheck[e.type],titles:e.title}},[a("vue-apex-charts",{attrs:{type:e.type,height:"400",options:t.optionOfapxeCharts,series:t.cloneSeries}})],1)}),a("tab-item",{attrs:{icon:"biaoge-copy",titles:t.title[0],id:"table-item"}},[a("vs-table",{attrs:{data:t.tableData.data,maxHeight:"400px",noDataText:t.nodata},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.data;return t._l(n,function(e,n){return a("vs-tr",{key:n},t._l(t.tableData.column,function(n,i){return a("vs-td",{key:i},[t._v(t._s(e[n.key]?e[n.key].toLocaleString():""))])}),1)})}}])},[a("template",{slot:"thead"},t._l(t.tableData.column,function(e,n){return a("vs-th",{key:n,staticClass:"px-2"},[t._v(t._s(e.title))])}),1)],2)],1),t._l(t.tabsInfo,function(e,n){return t.showChakan?a("tab-item",{key:n,attrs:{icon:"chakan",title:e.title}},[a("div",{staticStyle:{height:"400px",width:"100%","overflow-y":"auto","overflow-x":"hidden"}},[a("vue-apex-charts",{attrs:{type:e.type,width:t.chartWidth,height:t.chartHeight,options:t.optionOfapxeCharts,series:t.cloneSeries}})],1)]):t._e()})],2):t._e()}),c=[],l=a("cebc"),u=a("75fc"),d=a("776a"),h=a("6d57"),p=a("1321"),m=a.n(p),f=a("c66f"),y=a("2ef0"),g=a.n(y),b={name:"chartTabs",components:{iTabs:d["a"],tabItem:h["a"],VueApexCharts:m.a,indicatorSelector:f["a"]},props:{xAxis:{type:Array,default:function(){return[]}},series:{type:Array,default:function(){return[]}},type:{type:Array,default:function(){return["line","bar"]}},chartLib:{type:String,default:"Apex"},title:{type:Array,default:function(){return["客流量趋势","客流量趋势"]}},horizonta:{type:Boolean,default:!1},extraOption:{type:Object,default:function(){return{}}},footfallSelect:{type:Boolean,default:!1}},data:function(){return{showChakan:!1,isAllData:!1,current:0,nodata:"暂无数据",chartWidth:"99%",chartHeight:385,canshow:!1,option:{legend:{},tooltip:{trigger:"axis"},dataset:{source:[]},grid:{left:"center",width:"90%"},xAxis:{type:"category"},yAxis:{type:"value"},series:[]},iconCheck:{bar:"62",line:"zhexiantu"},apexOptions:{xaxis:{categories:[],labels:{show:!0,style:{fontFamily:"Roboto,sans-serif"}}},colors:["#00A0E9","#2BD9CF","#8D82F0","#E8585A","#E8585A","#94E2FF"],yaxis:{labels:{formatter:function(t){return t?t.toLocaleString():""},style:{fontFamily:"Roboto,sans-serif",marginLeft:"10px"}}},tooltip:{shared:!0},stroke:{curve:"straight",width:2},plotOptions:{bar:{horizontal:!1,endingShape:"rounded",radius:0,distributed:!1}},dataLabels:{enabled:!1},noData:{text:"暂无数据",align:"center",verticalAlign:"middle",offsetX:0,offsetY:0,style:{color:void 0,fontSize:"14px",fontFamily:void 0}},chart:{toolbar:{show:!1},fontFamily:"source_han_sans_cn",zoom:{enabled:!1}},responsive:[{breakpoint:1e3,options:{plotOptions:{bar:{horizontal:!1}},legend:{position:"bottom"}}}]}}},computed:{mergeData:function(){return[].concat(Object(u["a"])(this.xAxis),Object(u["a"])(this.series))},tableData:function(){var t=this,e=[],a=[];return this.mergeData.length?(this.mergeData.forEach(function(t,a){var n=t.name,i=t.key;e.push({title:n,key:i})}),this.xAxis[0].data.forEach(function(n,i){var r={};e.forEach(function(e,a){r[e.key]=t.mergeData[a].data[i]}),a.push(r)}),{column:e,data:a}):{column:e,data:a}},optionOfapxeCharts:function(){if(!this.xAxis.length)return this.apexOptions;var t;this.isAllData?(t=this.xAxis[0].data,t.length<10?(this.chartHeight=400,this.chartWidth="100%"):(this.chartHeight=40*t.length,this.chartWidth="99%")):(this.showChakan=this.xAxis[0].data.length>10,t=g.a.take(this.xAxis[0].data,10),this.chartHeight=400);var e=Boolean(t.length),a={plotOptions:{bar:{columnWidth:t.length<5?"20%":"70%"}}};if(this.horizonta){var n={yaxis:{labels:{offsetY:t.length<5?-10:0,offsetX:10,show:e},show:e},plotOptions:{bar:{barHeight:t.length<5?"20%":"70%",horizontal:!0}},xAxis:{lines:{show:e}},grid:{yaxis:{lines:{show:e}}}};a=g.a.merge(a,n)}var i=g.a.merge(this.apexOptions,a),r={xaxis:{categories:t,labels:{formatter:function(t){return t.toLocaleString()}}}};return Object(l["a"])({},i,r)},cloneSeries:function(){var t=g.a.cloneDeep(this.series);return this.isAllData?t:(t.map(function(t){var e=[];t.data.map(function(t){e.length<10&&e.push(t)}),t.data=e}),t)},tabsInfo:function(){var t=this,e=[];return this.type.forEach(function(a,n){var i={type:a,title:t.title[n]};e.push(i)}),e}},watch:{series:function(){var t=this;this.canshow=!1,this.$nextTick(function(){t.canshow=!0})},current:function(){2==this.current?this.isAllData=!0:this.isAllData=!1}},methods:{transformToSet:function(t,e){var a=[];if(!t.length||!e.length)return{dataset:{source:a}};var n=e.map(function(t){return t.name});t[0].data.forEach(function(t,n){var i=[];i.push(t),e.forEach(function(t){i.push(t.data[n])}),a.push(i)}),n.unshift(t[0].key||""),a.unshift(n);var i=this.initSeriesOfEchart();return{dataset:{source:a},seriesCheckObj:i}},initSeriesOfEchart:function(){var t=this,e={};return this.type.forEach(function(a){var n={series:[]};t.series.forEach(function(t){n.series.push({type:a,barMaxWidth:80})}),e[a]=n}),e}}},v=b,x=(a("2731"),a("2877")),D=Object(x["a"])(v,s,c,!1,null,"405a4bb2",null),w=D.exports,k=a("3191"),A=a("c276"),C=a("5fe9"),I=a.n(C),T=(a("3022"),{name:"home_ranking",components:{chartTabs:w,VueApexCharts:m.a},props:{range:{type:String},propertyId:{type:null,default:"company"},chartType:{type:String,default:"bar"},bzids:{type:Array,default:function(){return[]}},orderName:{type:String,default:"商铺"}},data:function(){return{charType:"pie",isNodata:!1,current:0,businessCurrent:0,rightTabCurrent:0,columns:[{title:"名称",key:"name"},{title:"客流量",key:"enter"}],colors:["#42efe9"],leftXaxis:[],leftSeries:[],rightXaxis:[],rightValue:[],leftTableData:[],rightTableData:[],chartHeight:700,ismallMore:!1,isformatMore:!1,compareBzids:[],isLeftAllzero:!1,isRightAllzero:!1,peiOptions:{chart:{type:"pie"},dataLabels:{enabled:!0,formatter:function(t,e){if(e.seriesIndex==e.w.globals.seriesPercent.length-1){var a=[];e.w.globals.seriesPercent.map(function(t){a.push(Number(t[0].toFixed(2)))});var n=Number(g.a.sum(g.a.initial(a)).toFixed(2)),i=I.a.minus(100,n);return i+"%"}return t.toFixed(2)+"%"}},labels:[],legend:{position:"left"},tooltip:{followCursor:!0,y:{formatter:function(t){return Number(t).toLocaleString()}}}},pieSeries:[]}},activated:function(){},watch:{range:function(t,e){t!==e&&this.topDataReq()},propertyId:function(t,e){t!==e&&this.bzids.length>1&&this.topDataReq()},mallTitle:function(t,e){var a=this;this.$nextTick(function(){a.$refs.rankList.updateNav()})},formatTitle:function(t,e){var a=this;this.$nextTick(function(){a.$refs.bussniessRank.updateNav()})}},computed:{formatTitle:function(){return this.isformatMore?["业态排行 T O P 10","业态排行"]:["业态排行"]},mallTitle:function(){return this.ismallMore?["".concat(this.orderName,"排行 T O P 10"),"".concat(this.orderName,"排行")]:["".concat(this.orderName,"排行")]},leftFormatedData:function(){return Object(A["e"])(this.leftTableData,["enter"])},rightFormatedData:function(){return Object(A["e"])(this.rightTableData,["enter"])}},methods:{topDataReq:function(){var t=this,e="store";"company"!==this.propertyId&&1!==this.bzids.length&&this.propertyId||(e="mall"),o.a.all([Object(k["r"])(this.initParams(e)),Object(k["r"])(this.initParams("format"))]).then(function(e){var a=t.handleResData(e[0]),n=t.handleResData(e[1]);t.leftXaxis=a.xAxis,t.leftSeries=a.series,t.rightXaxis=n.xAxis,t.rightValue=n.series}).catch(function(t){console.log(t)})},initParams:function(t){var e=null;e="company"!==this.propertyId&&1!==this.bzids.length&&this.propertyId?this.propertyId:"company";var a={entity:t,type:"enter",range:this.range,id:e};return a},entitysCompareReq:function(t,e){var a=this;this.compareBzids=e;var n=Object(A["j"])(t),i=[];e.forEach(function(t){return i.push(t.id)});var r={type:"enter",range:t.toString(),innerRange:n,bzid:i.toString()};Object(k["w"])(r).then(function(t){a.handleCompareRes(t)}).catch(function(t){console.log(t)})},handleResData:function(t){var e=t.data.data.company?t.data.data.company:t.data.data,a=g.a.orderBy(e,["enter"],["desc"]),n=this.processData(a),i=n.xAxis,r=n.value,o=n.uniqarr;return o.length&&(a=o),{xAxis:[{name:"实体名称",key:"entity",data:i}],series:[{name:"客流量",data:r,key:"enter"}]}},processData:function(t){var e=[],a=[],n=[];return t.forEach(function(t){if(t.business_type_id){var i=g.a.find(n,function(e){return e.business_type_id===t.business_type_id});i?n.forEach(function(e){e.business_type_id===t.business_type_id&&(e.enter+=t.enter)}):n.push(t)}else e.push(t.name),a.push(t.enter)}),n.length&&n.forEach(function(t){e.push(t.name),a.push(t.enter)}),{xAxis:e,value:a,uniqarr:n}},handleCompareRes:function(t){var e=t.data.data,a=[],n=[],i=[],r=[],o=[],s=[];this.compareBzids.forEach(function(t,a){var n=0;e.forEach(function(t,e){t.compares[a]&&(n+=t.compares[a].number)}),r.push({name:t.name,y:n})}),o.push({size:"50%",name:"客流排行",data:r.filter(function(t){return t.y>0})});var c=g.a.orderBy(r,"y","desc");c.forEach(function(t){a.push(t.name),i.push(t.y),s.push({name:t.name,enter:t.y})}),n=[{name:"客流量",data:i,showInLegend:!1}],this.leftXaxis=[{name:"名称",key:"time",data:a}],this.leftSeries=n;var l=[],u=[];r.forEach(function(t){l.push(t.y),u.push(t.name)}),this.peiOptions.labels=u,0==g.a.sum(l)?this.isNodata=!0:this.isNodata=!1,this.pieSeries=l,this.$refs.pieCharts.updateOptions({labels:u})}}}),_=T,O=(a("fb37"),a("7745"),Object(x["a"])(_,n,i,!1,null,"09c7d9f3",null));e["a"]=O.exports},aec5:function(t,e,a){"use strict";var n=a("32a1"),i=a.n(n);i.a},b0f6:function(t,e,a){"use strict";var n=a("b9ca"),i=a.n(n);i.a},b215:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAAAhCAYAAACGA8YfAAADxUlEQVRogeWZS2hcVRjHfw1p3ShVarDduKnio1QQW9IujKVQ8AEiKC1YcaGLQgXB+oI+sii2CxcqitXUEi8IblxUfKUh0YbERog2mkcxaVVaaFOu0Ew6eUyTSfp3ce60w2Qe595zMrPwD2cz9zz+3+9858w3d5ZJuh8YBJbz/9M8sK4OGAHer7GZWuk94OwySQArgC5gcy0dVVmdwFPAXF30wRzwOHCqZpaqqzbgaUzc5DIhp5VAO9BYfV9V00/AE0QAYDEEMCBOAeuq56tqugA8DKTyP6wr0vEq8BwwVQVT1dR14EUKAEBxCGC+MXYvpaMaqBXoLvagFASAL4AOl1Vf7Zvky3+uJR7fHWZ5uTftYiGnNLC/1MNyEABeAWaTrjycWmBnT5q2S3OVOxdoMDXPYydS/Hg5m3T5fH0AhCWfSqrUPpSDdnRdFUGojrFZ6zED41kRhNr43bjL0jmlJN2uMjHaQFgjacbFRQ5E+6XKIM6kDIBHvr3ismS+3lGFGG0gOGeDJD17ckIEoU6UATEcAWj0kwGS2bw18gThHkkLro5yGdFZ5GgMRQA2+MsASToqi/hsISDpax+unu82INou3gRxxn8GSGbT7pVnCFt8udveZY7GwHhW/2YWRBBq0/deAUjScVnGVqxsLqd+TNnprJ096Rs1xOaG5fQ+eYePafPVCPTZdIwL4QVMEeVFW9snGMssMPLMKl9T5tQJbLPubZsyUauXdME2Hx9tG9fuX9KJ8/ndoWk9cDzRRblFMeKqVDEWah5TfVmp6a4VHBnNsK9/OuYycOxchrdOT7Hxzvq4QzswL4jsFYdY1G6VqcKsdGRkRgShmn+fst7GllEz5s3fJq3HRLouaYNixpQEApIOxXH2SQRiX39lEK3nMiII9cavsQFI0udKEE9SCKsUIxsk6aM/K4M4dtb0eTt+BkjSFUkNMWJwhoCkPXFdfhxlxME/FoPIAXg9WQZI0ksJYnCGcIukgbhOj0bn/UDeHRH8lXHJAEn6yiEOJwhIWi/pWlzHn0YgWkZn9MPFWRGE2nva/uIs0KiklS5xuEJA0q4kzj+L0p8g1H6LC7OELsv8uHOKwQcEJDUnieDw4LRe60t8BMYkPejDf9yyuZwOAgd8TVZBQ5g/T877mCxuxVhOzcB2YMLjnIUS0AJswhMAM6uf45DfVktqlZRNmucl1CupaQn8ej0OhVoL7AJ2AHcnnCMDfIPZ/ZOefC3SUkK4sQawHmgCHgLuA1YDDcBtQD0m2EnMa/G/gWHgZ6AHmFlqg/8B38jC/LSgNfgAAAAASUVORK5CYII="},b9ca:function(t,e,a){},c34d:function(t,e,a){"use strict";var n=a("8d9f"),i=a.n(n);i.a},ce80:function(t,e,a){"use strict";var n=a("f8bd"),i=a.n(n);i.a},cf91:function(t,e,a){},d084:function(t,e,a){"use strict";var n=a("50c5"),i=a.n(n);i.a},dfac:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAAAhCAYAAACGA8YfAAADw0lEQVRogeWZS2xUVRyHvxYBRZs2IQgscCG+CYiJKeKiwUSjBjViDC4kLiABIwkIxq2RR00IkdcOFziRqMQqKBsjqdPymCrBmLQDiESwsKC9IQ3t9DFthf5Y3DnNZHpv5z7O3C78kru5j3N//+/+z70nM1WSngA6gOn8/7gNLKoGLgF7pzjMVLEHuFwlCWAG0Aosn8pECdMMrARGqws7RoFXgMyURUqWn4E3cOvGdIKhFvgFWJZ8rsRIA69SEAATJYArIgMsSi5XYlwDngFuFe+s9jixD3gbGEggVJKMAe9RIgC8JYD7xfigkokADl7Os6N9sNK3MRwCTnkd8JoOxZwAXqpEomPXR3irpQ+A/fU1bHryvkrcxpADHgMcr4P3lLl4I5AFZtpM1NQ5wuqTfXy69H4WzJrGurYcYxIfPjXL5m2K2YePAAAkldsOyCJHrw2LlKO1mb7xfZ91DIqUo88vDNq8leGWpDpNUmMQCfMlDdlI80OnK2BDW27CscaOgUqJ2KkyNQaRYKUbvvvXFbDeQ4BhV9btiD32RAzJfYhWJDwi6U7UJN8XOuD93/wFGIyI3eetiPhCAeoLKgFJP0ZJ0TTJFPBjZ7s7NXZlY4m4I+lRWZawImyKfRfdp7ouE1yAwbwjPv6jP/S1BY4pYG1hJCDpzzApnj7eo1Xp3qhF6KNz/XrwyM2ol9crYF3lFkulrAEOx/xmj/Pu6Rw3hsZoebnO1pCGZkIs8vyWzX4cAa6HvMaTrecG+ObqMK3do6wqrBwt0hjq7KAtU7Rtidqfho2/50TKUbprRH/13hYpR6//Gn3alHBCIWuKIuEBuauwSGw+2y9Sjr76Jz++r7V7VKQcvdYcW8SYpGeVgAQkNUZJuOms2wFfX8lPOJbuGrEh4ktFqCeqhNkK2Q1GQHEHlHKq0BERvyg9kuaEqCG2BCRtDZrOTIFvr/oLMGScyFNjbYQaYkuYKam9XDLTAUEEGE4WOmJlc+Bma4pRRywJSFosadgv2ZvpXpFydNjjHVAOI2LJTz3lTv1bUm2cOsKuE0rJApv9DtbNqOJAfQ1rHr439MANc6dz9IVaFtZMm+y0btz/DmItNMKuGP34BNhmY6AQdAEvAhfjDhS3EwzbgR2WxgpCFngeCwLAngRwu2E10GtxzFIEHASeAzrtjRrvxei1zZN0SNJ/od+Gk9MmqaECea29E7xYCGwA3gEeijhGHjiO+/RbLOWaQCUljN8DWAw0AEuAx4F5wBygBvdn/zzQj/uz+BXgPHAGOA0MVTrgXQDm6kE748mhAAAAAElFTkSuQmCC"},e44b:function(t,e,a){},e7d5:function(t,e,a){},ea8e:function(t,e,a){},f8bd:function(t,e,a){},fb37:function(t,e,a){"use strict";var n=a("e44b"),i=a.n(n);i.a}}]);