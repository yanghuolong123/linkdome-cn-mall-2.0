(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-231d434a"],{"0677":function(e,t,a){"use strict";var i=a("eb3e"),r=a.n(i);r.a},"12b0":function(e,t,a){"use strict";var i=a("7f09"),r=a.n(i);r.a},"14b96":function(e,t,a){var i=a("5ca1");i(i.P,"String",{repeat:a("9744")})},"4af2":function(e,t,a){"use strict";var i=a("ebc4"),r=a.n(i);r.a},"4ce9":function(e,t,a){"use strict";var i=a("ce77"),r=a.n(i);r.a},"4ee1f":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("vs-table",{attrs:{data:e.data,maxHeight:"400px",noDataText:e.noData,id:"i-table-component"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.data;return e._l(i,function(t,i){return a("vs-tr",{key:i},e._l(e.columns,function(i,r){return a("vs-td",{key:r},[e._v(e._s(t[i.key]&&t[i.key].toLocaleString()))])}),1)})}}])},[a("template",{slot:"header"},[e._t("head")],2),a("template",{slot:"thead"},e._l(e.columns,function(t,i){return a("vs-th",{key:i},[e._v(e._s(t.title))])}),1)],2)},r=[],n={props:{columns:{type:Array,default:function(){return[]}},data:{type:Array,default:function(){return[]}},noData:{type:String,default:"暂无数据"}}},s=n,c=(a("4ce9"),a("2877")),o=Object(c["a"])(s,i,r,!1,null,"699f3333",null);t["a"]=o.exports},"7f09":function(e,t,a){},9744:function(e,t,a){"use strict";var i=a("4588"),r=a("be13");e.exports=function(e){var t=String(r(this)),a="",n=i(e);if(n<0||n==1/0)throw RangeError("Count can't be negative");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(a+=t);return a}},c2c4:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"effective"},[a("div",{staticClass:"time-selector bg-white box-card px-4 pb-6"},[a("flow-selector",{ref:"flowSelector",staticStyle:{"background-color":"#fff","border-radius":"6px"},attrs:{isShop:!0,isFloor:!0,isStore:!0,isArea:!0,multiple:!1,isNeedEntity:!1,footFall:!1,typeText:e.dwellText,isReset:""},on:{"on-change":e.paramsPrepare}})],1),a("div",{staticClass:"chartContent"},[e.isEffectiveChart?a("goalCharts",{staticClass:"charts",attrs:{id:"tendencyLine",height1:"455px",height3:"455px",title1:"有效客流趋势",options1:e.trendAndAvg.trendLineOption,series1:e.trendAndAvg.trendLineSeries,options2:e.trendAndAvg.trendBarOption,series2:e.trendAndAvg.trendBarSeries,columns:e.trendAndAvg.trendColumn,tableList:e.trendAndAvg.trendTable}}):e._e(),a("div",{staticClass:"cardContent"},[a("Cards",{attrs:{isTime:e.isTime,isUp:e.isUp1,item:e.effective}}),a("Cards",{attrs:{isTime:e.isTime,isUp:e.isUp2,item:e.repeat,margin:"20px 0px"}}),a("Cards",{attrs:{isTime:e.isTime,isUp:e.isUp3,item:e.avgTimes}})],1),a("div",{staticClass:"circles"},[a("storeChart",{staticClass:"cir",attrs:{title1:"到店次数",columns:e.chartColumns,tableList:e.chartTable,showCharts:e.showCharts,isTime:e.isTime,pieType:e.pieType,chartOptions:e.chartOptions,series:e.circleSeries}})],1),a("div",{staticStyle:{width:"54%",height:"383px"}},[a("goalCharts",{attrs:{height1:"309px",height3:"309px",title1:"平均到访频次趋势",id:"tendencyLine2",options1:e.trendAndAvg.avgLineOption,series1:e.trendAndAvg.avgLineSeries,options2:e.trendAndAvg.avgBarOption,series2:e.trendAndAvg.avgBarSeries,columns:e.trendAndAvg.avgColumn,tableList:e.trendAndAvg.avgTable}})],1)],1)])},r=[],n=a("768b"),s=a("795b"),c=a.n(s),o=(a("5df3"),a("14b96"),a("96cf"),a("3b8d")),l=(a("c5f6"),a("ac6a"),a("7f7f"),a("2b0e")),d=a("b60b"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cards",style:{margin:e.margin}},[e.isTime?e._e():a("div",{staticClass:"left"},[a("div",{staticClass:"circles",style:{backgroundColor:e.item.bg}},[a("icons",{staticClass:"icons",attrs:{type:e.item.icon,size:"28",color:e.item.color}})],1)]),e.isTime?e._e():a("div",{staticClass:"right"},[a("p",{staticClass:"title"},[e._v(e._s(e.item.title))]),a("p",{staticClass:"number"},[e._v(e._s(Number(e.item.number).toLocaleString()))])]),e.isTime?a("div",{staticClass:"header"},[a("div",{staticClass:"left"},[a("div",{staticClass:"circles",style:{backgroundColor:e.item.bg}},[a("icons",{staticClass:"icons",attrs:{type:e.item.icon,size:"28",color:e.item.color}})],1)]),a("div",{staticClass:"right"},[a("p",{staticClass:"title"},[e._v(e._s(e.item.title))])])]):e._e(),e.isTime?a("div",{staticClass:"compares"},[a("div",{staticClass:"left"},[a("p",{staticClass:"time1"},[e._v(e._s(e.item.time1))]),a("p",{staticClass:"time2"},[e._v(e._s(e.item.time2))])]),a("div",{staticClass:"right"},[a("p",{staticClass:"precent"},[e._v(e._s(e.item.precent))]),a("div",{staticClass:"iconss",class:{up:e.isUp}},[a("icons",{attrs:{type:"xiala",color:"#EC7172"}}),a("p",{staticClass:"addPrecent"},[e._v(e._s(e.item.addPrecent))])],1)])]):e._e()])},m=[],p={props:{item:{type:Object,default:{icon:"daofang",title:"平均到访次数",number:"266.333",bg:"#EAE8FD",color:"",time1:"2019-07-01 2019-08-08",time2:"2019-07-01 2019-08-08",precent:"80%",addPrecent:"15%"}},margin:{type:String,default:""},isTime:{type:Boolean,default:!1},isUp:{type:Boolean,default:!1}}},v=p,f=(a("0677"),a("2877")),g=Object(f["a"])(v,u,m,!1,null,"7573328a",null),b=g.exports,h=a("d4a6"),y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"storeCharts"},[a("div",{staticClass:"chartss"},[a("i-tabs",{staticClass:"chartsTable",style:{height:e.allHeight},model:{value:e.current,callback:function(t){e.current=t},expression:"current"}},[a("tab-item",{attrs:{icon:e.icon1,titles:e.title1}},[e.showCharts?a("div",{staticStyle:{display:"flex"}},[a("vue-apex-charts",{class:{alls:e.isTime},attrs:{type:e.pieType,height:e.height,options:e.chartOptions,series:e.series}}),e.isTime?e._e():a("div",{staticClass:"storedatass",staticStyle:{width:"50%"}},[e._l(e.labels,function(t,i){return a("div",{key:i,staticClass:"datas"},[a("div",{staticClass:"circle",style:{backgroundColor:e.colors[i]}}),a("span",{staticClass:"names"},[e._v(" "+e._s(e.labels[i])+" ")]),a("span",{staticClass:"number"},[e._v(e._s(Number(e.series[i]).toLocaleString()))])])}),e.isNoData?a("div",{staticClass:"noData"}):e._e()],2)],1):e._e()]),a("tab-item",{attrs:{icon:e.icon2,titles:e.title2}},[a("i-table",{attrs:{columns:e.columns,data:e.tableList}})],1)],1)],1)])},C=[],T=a("6d57"),A=a("1321"),S=a.n(A),N=a("c276"),x=a("4ee1f"),L=a("776a"),O={components:{VueApexCharts:S.a,tabItem:T["a"],iTabs:L["a"],iTable:x["a"]},props:{series:{type:Array,default:function(){return[44,55,13,43,20]}},isTime:{type:Boolean,default:!1},height:{type:String,default:"276px"},allHeight:{type:String,default:"350px"},icon1:{type:String,default:"fenxi"},icon2:{type:String,default:"biaoge-copy"},title1:{type:String,default:"到店次数占比"},title2:{type:String,default:"详细数据"},pieType:{type:String,default:"pie"},chartOptions:{type:Object,default:{}},showCharts:{type:Boolean,default:!1},columns:{type:Array,default:function(){return[]}},tableList:{type:Array,default:function(){return[]}}},computed:{},data:function(){return{isNoData:!1,current:0,colors:["#E85A5A","#00A0E9","#2BD9CF","#F9A143","#857AEF"],labels:["1 次","2 次","3 次","4 次","5次及以上"]}},methods:{isShowChart:function(){0===_.sum(this.series)?this.isNoData=!0:this.isNoData=!1}},mounted:function(){this.isShowChart()},updated:function(){this.isShowChart()}},D=O,j=(a("12b0"),Object(f["a"])(D,y,C,!1,null,null,null)),w=j.exports,P=a("aa75"),k=a("94b0"),B=a("3191"),E=a("c1df"),M=a.n(E),F=a("2ef0"),U=a.n(F),Y=a("f056");l["default"].component(P["a"].name,P["a"]);var q={name:"DwellTime",components:{flowSelector:h["a"],VueApexCharts:S.a,Cards:b,goalCharts:d["a"],storeChart:w},data:function(){return{isEffectiveChart:!1,showCharts:!1,isTime:!1,isUp1:!1,isUp2:!1,isUp3:!1,pieType:"pie",effective:{icon:"youxiaokeliu1",title:"有效客流",number:"",bg:"#EAE8FD",color:"#776AED",time1:"",time2:"",precent:"",addPrecent:""},repeat:{icon:"zhongfu",title:"重复客流",number:"",bg:"#D7F7F5",color:"#2BD9CF",time1:"",time2:"",precent:"",addPrecent:""},avgTimes:{icon:"daofang",title:"平均到访次数",number:"",bg:"#D8F1FB",color:"#03A1E9",time1:"",time2:"",precent:"",addPrecent:""},dwellText:"effective",iconColor:"rgb(34, 128, 215)",chartOptions:{},trendAndAvg:{trendLineOption:{},trendLineSeries:[],trendColumn:[],trendTable:[],trendBarOption:{},trendBarSeries:[],effectiveNumbser:"",repeatNumber:"",avgTimesNumber:"",avgLineOption:{},avgLineSeries:[],avgBarOption:{},avgBarSeries:[],avgColumn:[],avgTable:[]},circleSeries:[],chartColumns:[],chartTable:[],isNumber:0}},activated:function(){var e=this;this.isEffectiveChart=!1,setTimeout(function(){e.isEffectiveChart=!0})},mounted:function(){var e=this;e.$refs.flowSelector.entityType="shop",setTimeout(function(){e.$refs.flowSelector.handleClick()},200)},methods:{initTrend:function(e,t){var a=U.a.cloneDeep(this.trendAndAvg);if(200==e.status){var i=e.data.data,r=U.a.cloneDeep(N["n"]),n=U.a.cloneDeep(Y["b"]);void 0!=t?(r.xaxis.categories=t,n.xaxis.categories=t):(r.xaxis.categories=i.map(function(e,t){return M()(e.date_time).format("YYYY-MM-DD")}),n.xaxis.categories=i.map(function(e,t){return M()(e.date_time).format("YYYY-MM-DD")}));var s=[],c={name:"全部客流"};c.data=i.map(function(e){return e.visits});var o={name:"有效客流"};o.data=i.map(function(e){return e.unique_visits}),s.push(c),s.push(o);var l=U.a.cloneDeep(s);l.forEach(function(e){e.type="column"}),a.trendLineOption=r,a.trendLineSeries=s,n.xaxis.categories.length<2?n.plotOptions.bar.columnWidth="15%":n.plotOptions.bar.columnWidth="45%",a.trendBarOption=n,a.trendBarSeries=l,a.effectiveNumbser=U.a.sum(s[1].data),a.repeatNumber=Object(N["d"])(U.a.sum(s[0].data)-U.a.sum(s[1].data));var d=e.data.data;d.length?a.avgTimesNumber=Object(N["d"])(U.a.sumBy(e.data.data,"avgFrequencyVisits")/d.length):a.avgTimesNumber=0,a.trendTable=e.data.data.map(function(e){var t={};return t.name=M()(e.date_time).format("YYYY-MM-DD"),t.begin=e.visits?e.visits.toLocaleString():" ",t.end=e.unique_visits?e.unique_visits.toLocaleString():" ",t}),a.trendColumn=["日期","全部客流量","有效客流量"];var u=[],m={name:"平均到访频次"};m.data=i.map(function(e){return e.avgFrequencyVisits}),a.avgLineSeries=u,a.avgLineOption=U.a.cloneDeep(r),a.avgLineOption.yaxis.labels.formatter=function(e){return Number(e).toFixed(1)},u.push(m);var p=U.a.cloneDeep(u);p.forEach(function(e){e.type="column"}),a.avgBarOption=U.a.cloneDeep(n),a.avgBarOption.xaxis.categories.length<2?a.avgBarOption.plotOptions.bar.columnWidth="15%":a.avgBarOption.plotOptions.bar.columnWidth="45%",a.avgBarOption.yaxis.labels.formatter=function(e){return Number(e).toFixed(1)},a.avgBarSeries=p,a.avgTable=e.data.data.map(function(e){var t={};return t.begin=M()(e.date_time).format("YYYY-MM-DD"),t.end=e.avgFrequencyVisits?e.avgFrequencyVisits:" ",t}),a.avgColumn=["日期","平均到访频次"]}return a},initCircle:function(e){var t=this;if(200==e.status){t.chartColumns=[{key:"name",title:"类型",align:"center"},{key:"enter",title:"客流量",align:"center"}];var a=e.data.data.arrival_distribution,i=[],r=[],n=0;for(var s in a){n++;var c={};c.name=5==n?s+"次及以上":s+"次",c.enter=a[s],r.push(c),i.push(a[s])}t.chartTable=r,t.circleSeries=i}},paramsPrepare:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(t){var a,i,r,n,s,o,l,d,u,m,p,v,f,g,b,h,y,C,T,A,S,x,_,L,O,D,j,w,P,E,F,Y,q,R,$,z,V,I,W,H,J,G,K,Q,X,Z,ee,te;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a=this,this.showCharts=!1,!(0==t.entitys.length&&this.isNumber>0)){e.next=4;break}return e.abrupt("return",!1);case 4:if(this.isNumber=this.isNumber+1,i=t.entitys[0].id,"not"!=t.compareType){e.next=19;break}a.$store.commit("setRequestNumber",2),this.isTime=!1,this.pieType="pie",this.chartOptions=N["p"],r=t.date1Array[0],n=t.date1Array[1],s=t.date1Array.join(","),o=[],l=this.gotInnerRange(t.date1Array),Object(k["j"])(i,r,n,l).then(function(e){o.push(e),Object(B["j"])({range:s,bzid:i}).then(function(e){o.push(e);var t=a.initTrend(o[0]);a.trendAndAvg=t,a.effective.number=a.trendAndAvg.effectiveNumbser,a.repeat.number=a.trendAndAvg.repeatNumber,a.avgTimes.number=a.trendAndAvg.avgTimesNumber.toFixed(1),a.initCircle(o[1]),a.showCharts=!0})}),e.next=117;break;case 19:if("time"!=t.compareType){e.next=117;break}return a.$store.commit("setRequestNumber",4),this.isTime=!0,this.pieType="bar",d=t.date1Array[0],u=t.date1Array[1],m=t.date2Array[0],p=t.date2Array[1],s=t.date1Array.join(","),v=this.gotInnerRange(t.date1Array),f=this.gotInnerRange(t.date2Array),g="Month"==v||"Month"==f?"Month":"Date",b="Month"==g?"月":"天",e.next=34,c.a.all([Object(k["j"])(i,d,u,g),Object(k["j"])(i,m,p,g),Object(B["j"])({range:s,bzid:i})]);case 34:return o=e.sent,s=t.date2Array.join(","),e.next=38,c.a.all([Object(B["j"])({range:s,bzid:i})]);case 38:for(h=e.sent,o.push(h[0]),y="Month"==g?"Month":"day",C=M()(t.date1Array[1]).diff(M()(t.date1Array[0]),y),T=M()(t.date2Array[1]).diff(M()(t.date2Array[0]),y),A=C>T?C:T,A++,A++,S=[],x=1;x<A;x++)S.push("第"+x+b);if(_=a.initTrend(o[0],S),L=a.initTrend(o[1],S),O=t.entitys[0].label+" "+t.date1Array.join(" - ")+"有效客流",D=t.entitys[0].label+" "+t.date2Array.join(" - ")+"有效客流",j=t.entitys[0].label+" "+t.date1Array.join(" - ")+"平均到访频次",w=t.entitys[0].label+" "+t.date2Array.join(" - ")+"平均到访频次",P=t.entitys[0].label+" "+t.date1Array.join(" - ")+"到店次数",E=t.entitys[0].label+" "+t.date2Array.join(" - ")+"到店次数",_.trendLineSeries[0].name=O,_.trendLineSeries[0].data=_.trendLineSeries[1].data,_.trendLineSeries[1].name=D,_.trendLineSeries[1].data=L.trendLineSeries[1].data,_.trendBarSeries=_.trendLineSeries,_.trendColumn=["日期",O,D],F=[],S.forEach(function(e,t){var a={};a.name=e,a.begin=_.trendLineSeries[0].data[t]?_.trendLineSeries[0].data[t].toLocaleString():" ",a.end=_.trendLineSeries[1].data[t]?_.trendLineSeries[1].data[t].toLocaleString():" ",F.push(a)}),_.trendTable=F,_.avgLineSeries[0].name=j,_.avgLineSeries[1]=U.a.cloneDeep(_.avgLineSeries[0]),_.avgLineSeries[1].name=w,_.avgLineSeries[1].data=L.avgLineSeries[0].data,_.avgBarSeries=U.a.cloneDeep(_.avgLineSeries),_.avgBarSeries.forEach(function(e){e.type="column"}),_.avgColumn=["日期",j,w],Y=[],S.forEach(function(e,t){var a={};a.name=e,a.begin=_.avgLineSeries[0].data[t]?_.avgLineSeries[0].data[t]:" ",a.end=_.avgLineSeries[1].data[t]?_.avgLineSeries[1].data[t]:" ",Y.push(a)}),_.avgTable=Y,a.trendAndAvg=_,a.effective.time1=t.date1Array.join(" - "),a.effective.time2=t.date2Array.join(" - "),a.repeat.time1=t.date1Array.join(" - "),a.repeat.time2=t.date2Array.join(" - "),a.avgTimes.time1=t.date1Array.join(" - "),a.avgTimes.time2=t.date2Array.join(" - "),a.effective.precent=_.effectiveNumbser,_.effectiveNumbser>=L.effectiveNumbser?(a.isUp1=!1,_.effectiveNumbser==L.effectiveNumbser?a.effective.addPrecent="0%":0==L.effectiveNumbser?a.effective.addPrecent="-100%":0==_.effectiveNumbser?a.effective.addPrecent="100%":(q=Math.round(L.effectiveNumbser/_.effectiveNumbser*100),a.effective.addPrecent=100-q+"%")):(a.isUp1=!0,0==L.effectiveNumbser?a.effective.addPrecent="-100%":0==_.effectiveNumbser?a.effective.addPrecent="100%":a.effective.addPrecent=Math.round(L.effectiveNumbser/_.effectiveNumbser*100)-100+"%"),_.repeatNumber>=L.repeatNumber?(a.isUp2=!1,_.repeatNumber==L.repeatNumber?a.repeat.addPrecent="0%":0==L.repeatNumber?a.repeat.addPrecent="-100%":0==_.repeatNumber?a.repeat.addPrecent="100%":a.repeat.addPrecent=100-Math.round(L.repeatNumber/_.repeatNumber*100)+"%"):(a.isUp2=!0,0==L.repeatNumber?a.repeat.addPrecent="-100%":0==_.repeatNumber?a.repeat.addPrecent="100%":a.repeat.addPrecent=Math.round(L.repeatNumber/_.repeatNumber*100)-100+"%"),_.avgTimesNumber>=L.avgTimesNumber?(a.isUp3=!1,_.avgTimesNumber==L.avgTimesNumber?a.avgTimes.addPrecent="0%":0==L.avgTimesNumber?a.avgTimes.addPrecent="-100%":0==_.avgTimesNumber?a.avgTimes.addPrecent="100%":a.avgTimes.addPrecent=100-Math.round(L.avgTimesNumber/_.avgTimesNumber*100)+"%"):(a.isUp3=!0,0==L.avgTimesNumber?a.avgTimes.addPrecent="-100%":0==_.avgTimesNumber?a.avgTimes.addPrecent="100%":a.avgTimes.addPrecent=Math.round(L.avgTimesNumber/_.avgTimesNumber*100)-100+"%"),a.repeat.precent=_.repeatNumber,a.avgTimes.precent=_.avgTimesNumber.toFixed(1),R=[0,0,0,0,0],200==o[2].status)for(I in V=o[3].data.data.arrival_distribution,$=[],V)$.push(V[I]);else $=U.a.cloneDeep(R);if(200==o[3].status)for(H in W=o[3].data.data.arrival_distribution,z=[],W)z.push(W[H]);else z=U.a.cloneDeep(R);a.chartColumns=[{key:"name",title:"时间",align:"center"},{key:"value1",title:"1次",align:"center"},{key:"value2",title:"2次",align:"center"},{key:"value3",title:"3次",align:"center"},{key:"value4",title:"4次",align:"center"},{key:"value5",title:"5次及以上",align:"center"}],J=[],G={},G.name=P,G.value1=$[0],G.value2=$[1],G.value3=$[2],G.value4=$[3],G.value5=$[4],K={},K.name=E,K.value1=z[0],K.value2=z[1],K.value3=z[2],K.value4=z[3],K.value5=z[4],J.push(G),J.push(K),a.chartTable=J,Q=["1 次","2 次","3 次","4 次","5次及以上"],X=Q.map(function(e,t){var a={};return a.name=e,a.data=[$[t],z[t]],a}),Z=U.a.cloneDeep(N["q"]),Z.xaxis.categories=[P,E],this.chartOptions=Z,this.circleSeries=X,this.showCharts=!0;case 117:try{"not"===t.compareType?(ee="无对比",te=t.date1Array[0]+","+t.date1Array[1]):(ee="时间对比",te=[t.date1Array.join(","),t.date2Array.join(",")]),window.TDAPP.onEvent(this.$route.meta.pageTitle+"页面","数据查询",{"对比方式":ee,"时间段":te,"实体选择":t.entitys[0].label})}catch(ae){console.log(this.$route.meta.pageTitle+"页面-数据查询埋点error:"+ae)}case 118:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),gotInnerRange:function(e){var t=Object(n["a"])(e,2),a=t[0],i=t[1],r=M()(a),s=M()(i),c=M.a.duration(s.diff(r)).asDays(),o="";return o=c<60?"Date":"Month",o}}},R=q,$=(a("4af2"),Object(f["a"])(R,i,r,!1,null,"590d5b71",null));t["default"]=$.exports},ce77:function(e,t,a){},eb3e:function(e,t,a){},ebc4:function(e,t,a){}}]);