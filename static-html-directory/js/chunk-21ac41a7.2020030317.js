(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-21ac41a7"],{"6cc9":function(t,e,a){},7422:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"goalAnaysis"},[a("div",{staticClass:"box-card bg-white header"},[a("Col",[a("vs-select",{staticClass:"selectExample selects",attrs:{autocomplete:""},model:{value:t.goalDate,callback:function(e){t.goalDate=e},expression:"goalDate"}},t._l(t.years,function(t,e){return a("vs-select-item",{key:e,attrs:{value:t,text:t}})}),1)],1),a("vs-select",{staticClass:"selectExample selects",attrs:{autocomplete:""},model:{value:t.activitySelect,callback:function(e){t.activitySelect=e},expression:"activitySelect"}},t._l(t.activityList,function(t,e){return a("vs-select-item",{key:e,attrs:{value:t.value,text:t.key}})}),1),a("vs-button",{staticClass:"handleSearch",attrs:{color:"primary"},on:{click:t.handleSearch}},[t._v("查询")]),a("div",{staticClass:"goal-submit goal-reset",on:{click:t.reset}},[t._v("重置")])],1),t.isFestivai?a("goalCharts",{ref:"goalCharts",staticStyle:{"margin-top":"20px"},attrs:{tableList:t.tableData,options1:t.options1,options2:t.options2,series1:t.series1,series2:t.series2}}):t._e(),t.isChart?a("goal-enter",{ref:"goalCharts",staticStyle:{"margin-top":"20px"},attrs:{tableList:t.tableData,options1:t.options1,options2:t.options2,series1:t.series1,series2:t.series2,xAxis:t.xAxis,isEnter:!0,titleText:t.enterTitle}}):t._e(),t.isMarket?a("goal-enter",{ref:"marketCharts",staticStyle:{"margin-top":"20px"},attrs:{tableList:t.marketTableData,options1:t.marketOptions1,options2:t.marketOptions2,series1:t.marketSeries1,series2:t.marketSeries2,titleText:t.marketTitle,xAxis:t.xAxis,isEnter:!1,columns:t.marketTableTitle}}):t._e()],1)},s=[],n=(a("c5f6"),a("28a5"),a("6b54"),a("7514"),a("ac6a"),a("7f7f"),a("f056")),o=a("d4a6"),r=a("c1df"),c=a.n(r),l=a("b60b"),p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"bg-white box-card box-cardss",staticStyle:{position:"relative"}},[a("div",{staticClass:"enterType"},[t._l(t.enterTypeList,function(e,i){return a("div",{key:i,staticClass:"enterYear",class:{selectAction:t.typeAction==i},on:{click:function(e){t.enterTypeClick(i)}}},[t._v("\n          "+t._s(e)+"\n        ")])}),a("div",{staticClass:"lineBox"})],2),a("ul",{staticClass:"enterIcon"},t._l(t.iconList,function(e,i){return a("li",{key:i,on:{click:function(e){t.iconClick(i)}}},[a("icons",{attrs:{title:t.iconTitle[e.type],type:e.type,size:20,color:t.iconIndex===i?t.iconColor:"#9D9D9DFF"}})],1)})),a("i-tabs",{staticClass:"chartsTable",model:{value:t.current,callback:function(e){t.current=e},expression:"current"}},[0==t.typeAction?a("tab-item",{staticClass:"chart-div"},[a("div",{staticClass:"left-title"},[a("p",{staticClass:"title"},[t._v(t._s(t.titleText))])]),a("vue-apex-charts",{staticStyle:{"padding-top":"55px"},attrs:{type:"line",height:"530",options:t.options1,series:t.series1}})],1):t._e(),1==t.typeAction?a("tab-item",{staticClass:"chart-div"},[a("div",{staticClass:"left-title"},[a("p",{staticClass:"title"},[t._v(t._s(t.titleText))])]),a("gola-enter-analysis",{attrs:{xAxis:t.options2.xaxis.categories,series:t.series2}})],1):t._e(),a("tab-item",{staticClass:"chart-div"},[a("div",{staticClass:"left-title"},[a("p",{staticClass:"title"},[t._v(t._s(t.titleText))])]),a("TableMultipleSelected",{staticStyle:{"overflow-y":"scroll","margin-top":"50px",height:"530px"},attrs:{tableName:t.columns,tableList:t.tableList}})],1)],1)],1)},u=[],h=a("6d57"),f=a("1321"),d=a.n(f),m=a("693f"),y=a("776a"),v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("vue-apex-charts",{ref:"chartBar",staticStyle:{"padding-top":"55px"},attrs:{type:"bar",height:"640",options:t.chartOptions,series:t.series}})],1)},g=[],b={name:"goalCharts",props:{xAxis:{type:Array},series:{type:Array}},components:{tabItem:h["a"],VueApexCharts:d.a,TableMultipleSelected:m["a"],iTabs:y["a"]},data:function(){return{isChart:!0,chartOptions:{plotOptions:{bar:{horizontal:!1,columnWidth:"70%",endingShape:"rounded"}},dataLabels:{enabled:!1},chart:{zoom:{enabled:!1},toolbar:{show:!1}},stroke:{show:!0,width:2,colors:["transparent"]},colors:["#00A0E9","#897FF0","#EA5455","#FF9F43","#1E1E1E"],xaxis:{categories:[]},yaxis:{title:{text:""},min:0,labels:{show:!0,formatter:function(t){return Number(t.toFixed(0)).toLocaleString()}}},fill:{opacity:1},tooltip:{y:{formatter:function(t){return t.toLocaleString()+"人"}}}}}},computed:{},activated:function(){this.iconIndex=0,this.current=0},watch:{xAxis:function(){this.dataList()}},mounted:function(){this.dataList()},methods:{dataList:function(){var t=this;this.chartOptions.xaxis.categories=this.xAxis,this.$refs.chartBar.updateOptions({xaxis:{categories:t.chartOptions.xaxis.categories}}),t.chartOptions.xaxis.categories.length<5?(t.chartOptions.plotOptions.bar.columnWidth="15%",t.$refs.chartBar.updateOptions({plotOptions:t.chartOptions.plotOptions})):(t.chartOptions.plotOptions.bar.columnWidth="70%",t.$refs.chartBar.updateOptions({plotOptions:t.chartOptions.plotOptions}))}}},x=b,D=a("2877"),k=Object(D["a"])(x,v,g,!1,null,null,null),_=k.exports,O={name:"goalCharts",props:{options1:{type:Object,default:function(){}},options2:{type:Object,default:function(){}},series1:{type:Array,default:function(){return[]}},series2:{type:Array,default:function(){return[]}},xAxis:{type:Array,default:function(){return[]}},columns:{type:Array,default:function(){return["日期","客流量","目标客流量"]}},tableList:{type:Array,default:function(){return[]}},titleText:{type:String,default:""},isEnter:{type:Boolean,default:!0}},components:{tabItem:h["a"],VueApexCharts:d.a,TableMultipleSelected:m["a"],iTabs:y["a"],golaEnterAnalysis:_},data:function(){return{istab:!0,current:0,enterTypeList:["年度趋势","月度趋势"],typeAction:0,iconIndex:0,iconColor:"rgb(34, 128, 215)",tableText:[],iconList:[{type:"zhexiantu",color:"#9D9D9DFF"},{type:"biaoge-copy",color:"#9D9D9DFF"}],iconTitle:{zhexiantu:"折线图",62:"柱状图","biaoge-copy":"详细数据"}}},computed:{},activated:function(){this.iconIndex=0,this.current=0},mounted:function(){},methods:{enterTypeClick:function(t){if(this.typeAction=t,this.iconList[0].type=0==t?"zhexiantu":"62","客流量趋势"===this.titleText){var e=0==t?"客流量年度趋势":"客流量月度趋势";try{window.TDAPP.onEvent("目标达成分析页面",e,{})}catch(a){console.log("目标达成分析页面-"+e+"-埋点error:"+a)}}},iconClick:function(t){var e;this.iconIndex=t,this.current=t,e=1==this.isEnter?"客流量趋势":"销售额总览",this.titleText=1==t?"详细数据":e}}},C=O,S=(a("d220"),Object(D["a"])(C,p,u,!1,null,null,null)),w=S.exports,A=a("3191"),T=a("94b0"),L=a("e285"),E=a("2ef0"),F=a.n(E),$={components:{goalCharts:l["a"],goalEnter:w,flowSelector:o["a"]},data:function(){return{years:[],isFestivai:!1,isChart:!1,isMarket:!1,chartHeight:"660px",enterListData:"",enterTitle:"客流量趋势",marketTitle:"销售额总览",flow_year_data:"",xAxis:[],selectType:[{name:"年份",value:0}],goalDate:"",activityList:[],entities:[{key:"城市立方",value:15}],activitySelect:"",selectEntity:"",targetData:[],current:0,year:"",bzids:[],tableData:[],issingleEntity:!0,series1:[],series2:[],options1:{},options2:{},marketTableTitle:["日期","销售额","目标销售额"],marketTableData:[],marketOptions1:{},marketOptions2:{},marketSeries1:[],marketSeries2:[]}},created:function(){this.checkTargetData(),this.options1=F.a.cloneDeep(n["a"]),this.marketOptions1=F.a.cloneDeep(n["a"]),this.options2=F.a.cloneDeep(n["b"]),this.marketOptions2=F.a.cloneDeep(n["b"])},watch:{"$store.state.home.headerAction":function(){this.reset();var t=this.$router.currentRoute.name;"Goal"===t&&this.shoppingList()},goalDate:function(){this.shoppingList()}},mounted:function(){this.goalDate=c()(new Date).year(),this.shoppingList();var t=this;t.$refs.goalCharts&&(t.$refs.goalCharts.updateOptions({xaxis:{categories:t.options2.xaxis}}),t.options2.xaxis.categories.length<2?(t.options2.plotOptions.bar.columnWidth="10%",t.$refs.goalCharts.updateOptions({plotOptions:t.options2.plotOptions})):t.options2.xaxis.categories.length<5?(t.options2.plotOptions.bar.columnWidth="20%",t.$refs.goalCharts.updateOptions({plotOptions:t.options2.plotOptions})):(t.options2.plotOptions.bar.columnWidth="70%",t.$refs.goalCharts.updateOptions({plotOptions:t.options2.plotOptions})))},activated:function(){this.isChart=!1,this.isMarket=!1,this.shoppingInfoData()},methods:{reset:function(){try{window.TDAPP.onEvent("目标达成分析页面","重置",{})}catch(t){console.log("目标达成分析页面-重置-埋点error:"+t)}this.goalDate=c()(new Date).year(),this.activitySelect=this.activityList[0].value},shoppingList:function(){var t=this;this.isChart=!1,this.isMarket=!1;var e=this.$store.state.home.bussinessTree;this.entities=[];var a=this.$store.state.home.headerAction;e.forEach(function(e){if(e.property_id==a){var i={};i.key=e.name,i.value=e.id,i.property_id=e.property_id,t.entities.push(i)}}),this.shoppingInfoData()},shoppingInfoData:function(){var t=this;Object(L["q"])().then(function(e){if(200==e.data.code){var a=t.entities[0].value,i=e.data.data.property,s=i.find(function(e){return e.property_id===t.$store.state.home.headerAction});t.years=s.goal_sale.map(function(t){return t.year}),i.map(function(e){e.bzid==a&&(t.flow_year_data=e)}),t.activityData()}else t.years=[]}).catch(function(e){t.years=[]})},activityData:function(){var t=this,e=this,a=this.$store.state.home.headerAction;Object(T["c"])({date:e.goalDate,property_id:a}).then(function(a){e.activityList=[];var i={value:"1",key:"客流量趋势"};i.time="".concat(t.goalDate,"-01-01")+","+"".concat(t.goalDate,"-12-31"),i.action=!0,e.activityList.push(i);var s=a.data.data;s.map(function(t){var a={};a.value=t.id,a.key=t.name,a.time=t.begin+","+t.end,a.enter=t.target_enter,a.action=!1,e.activityList.push(a)}),e.activitySelect=e.activityList[0].value,e.handleSearch()}).catch(function(t){console.log(t)})},timeList:function(){var t=[],e=c()().year(),a=-1;while(++a<1)t.push({key:e,value:e}),e--;return t},handleSearch:function(){var t=this.goalDate;"number"!==typeof t&&(t=c()(t).format("YYYY"));var e=this;if(t){try{var a=F.a.find(this.activityList,["value",this.activitySelect]);a=a&&a.key?a.key:"",window.TDAPP.onEvent("目标达成分析页面","数据查询",{"时间段":this.goalDate.toString(),"目标实体选择":a})}catch(l){console.log("目标达成分析页面-数据查询-埋点error:"+l)}if(this.flow_year_data.goal_flow)if(this.flow_year_data.goal_flow[0].flow_year){this.year=t;var i=F.a.find(e.activityList,function(t){return t.value==e.activitySelect}),s=i.time,n=c()(s.split(",")[0]),o=c()(s.split(",")[1]),r=Math.abs(o.diff(n,"day"))<60?"1day":"1month";this.getData(s,this.entities[0].value,r),this.marketData(t,this.entities[0].property_id)}else alert("选择商场无目标数据")}else alert("请选择年份")},getData:function(t,e,a){var i=this;Object(A["w"])({type:"enter",range:t,bzid:e,innerRange:a}).then(function(t){i.handleRes(t.data.data)}).catch(function(t){console.log(t)})},handleRes:function(t,e){var a=F.a.cloneDeep(this.flow_year_data.goal_flow),i=F.a.find(a,["year",this.goalDate]),s=this,o=[];t.forEach(function(t){o.push(t.compares)});var r=F.a.zip.apply(F.a,o),l=r[0].map(function(t){return t.number}),p=[];r[0]&&r[0].map(function(t){return t.number});var u,h=[];if("year"==i.is_year)u=Number(i.flow_year);else{var f=[];i.detail.months.map(function(t){F.a.forIn(t,function(t,e){f.push(t)})}),u=Number(F.a.sum(f))}this.issingleEntity=!0;var d=1,m=[],y=[],v=F.a.find(this.activityList,function(t){return t.value==s.activitySelect});if(s.isMarket=v.action,"1"!=s.activitySelect?(s.isChart=!1,s.isFestivai=!0):(s.isChart=!0,s.isFestivai=!1),1==v.action){while(l.length<12)l.push(null);m=this.cumsumArr(l);while(d<13)d<10?p.push("".concat(this.year,"-0").concat(d)):p.push("".concat(this.year,"-").concat(d)),y.push(u),d++}else{var g=v.enter;t.map(function(t,e){var a=c()(t.begin).format("YYYY-MM-DD");p.push(a),y.push(g)}),m=this.cumsumArr(l)}this.series1=[{name:"客流量",data:m},{name:"目标客流量",data:y}],this.options1=F.a.cloneDeep(n["a"]),this.options1.xaxis.categories=p;var b=[],x=[];1==v.action?i.detail.months.map(function(t,e){var a={};a.name=p[e],b.push(l[e]);var s,n=l[e]?l[e].toLocaleString()+" 人":" ";a.begin=n,"year"==i.is_year?s=(Number(i.flow_year)/12).toFixed(0):F.a.forIn(t,function(t,e){s=t}),null==s?x.push(0):x.push(s);var o=Number(s).toLocaleString()+" 人";a.end=o,h.push(a)}):t.forEach(function(e,a){var i={};i.name=p[a],b.push(l[a]);var s=l[a]?l[a].toLocaleString()+" 人":" ";i.begin=s;var n=(v.enter/t.length).toFixed(0);x.push(n);var o=Number(n).toLocaleString()+" 人";i.end=o,h.push(i)}),this.series2=[{name:"客流量",data:b},{name:"目标客流量",data:x}];var D=F.a.cloneDeep(n["b"]);D.xaxis.categories=p,this.xAxis=p,this.options2=D,this.tableData=h},cumsumArr:function(t){var e=[];return t.forEach(function(a,i){void 0===a||0===a||null===a?e.push(null):e.push(F.a.sumBy(F.a.take(t,i+1)))}),e},checkTargetData:function(){this.$store.state.home.allTargetData.length?this.targetData=F.a.cloneDeep(this.$store.state.home.allTargetData):this.targetDataReq()},marketData:function(t,e){var a=this,i="".concat(t,"-01-01"),s="".concat(t,"-12-31");Object(A["m"])({time1:i+","+s,type:"SaleAmount",property_id:this.entities[0].property_id,range:"Month"}).then(function(t){var i=[];F.a.forIn(t.data.data,function(t,e){F.a.forIn(t,function(t,e){var a={};a.begin=e,a.end=e,a.compares=[];var s={};s.number=Number(t),a.compares.push(s),i.push(a)})}),a.markerListData(i,e)}).catch(function(t){console.log(t)})},markerListData:function(t,e){var a=this.flow_year_data.goal_sale[0],i=[];t.forEach(function(t){i.push(t.compares)});var s=F.a.zip.apply(F.a,i),o=s[0].map(function(t){return t.number}),r=[];while(12!==o.length)o.push(null);var c,l=[];if("year"==a.is_year)c=Number(a.sale_year);else{var p=[];a.detail.months.map(function(t){F.a.forIn(t,function(t,e){p.push(t)})}),c=Number(F.a.sum(p))}if(e){this.issingleEntity=!0;var u=1,h=this.cumsumArr(o),f=[];while(u<13)u<10?r.push("".concat(this.year,"-0").concat(u)):r.push("".concat(this.year,"-").concat(u)),f.push(c),u++;this.marketSeries1=[{name:"销售额",data:h},{name:"目标销售额",data:f}],this.marketOptions1=F.a.cloneDeep(n["a"]),this.marketOptions1.xaxis.categories=r;var d=[],m=[];a.detail.months.map(function(t,e){var i={};i.name=r[e],d.push(o[e]);var s,n=o[e]?o[e].toLocaleString()+" 元":" ";i.begin=n,"year"==a.is_year?s=(Number(a.sale_year)/12).toFixed(0):F.a.forIn(t,function(t,e){s=t}),null==s?m.push(0):m.push(s);var c=Number(s).toLocaleString()+" 元";i.end=c,l.push(i)}),this.marketSeries2=[{name:"销售额",data:d},{name:"目标销售额",data:m}],this.marketOptions2=F.a.cloneDeep(n["b"]),this.marketOptions2.xaxis.categories=r,this.marketTableData=l}}}},I=$,M=(a("c042"),Object(D["a"])(I,i,s,!1,null,null,null));e["default"]=M.exports},a0ed:function(t,e,a){},c042:function(t,e,a){"use strict";var i=a("6cc9"),s=a.n(i);s.a},d220:function(t,e,a){"use strict";var i=a("a0ed"),s=a.n(i);s.a}}]);