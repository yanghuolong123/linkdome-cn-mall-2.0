(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c5bfd2c"],{4402:function(e,t,a){"use strict";var r=a("99de"),n=a.n(r);n.a},5566:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"bg-white box-card pb-6 px-4"},[a("flow-selector",{attrs:{routName:"ageGender",isFloor:!0,isStore:!0,isShop:!1,isArea:!0,isGate:!0,isReset:!0,isAgeGender:""},on:{"on-change":e.paramsPrepare}})],1),a("div",{staticClass:"mt-6 age-chart-box"},[a("div",{staticClass:"bg-white box-card pb-6"},[a("chart-tabs",{attrs:{xAxis:e.agechartData.xAxis,labels:e.agechartData.labels,series:e.agechartData.series,type:e.agechartData.type,chartWidth:e.ageChartWidth,title:"年龄分布",extraOptions:e.agechartData.extraOptions},on:{tableChage:e.ageTableChange}},[a("export-menu",{attrs:{slot:"export"},on:{onchange:e.ageExportBiztop},slot:"export"})],1)],1),a("div",{staticClass:"bg-white box-card pb-6"},[a("chart-tabs",{attrs:{xAxis:e.genderChartData.xAxis,labels:e.genderChartData.labels,series:e.genderChartData.series,type:e.genderChartData.type,chartWidth:e.ageChartWidth,title:"性别分布",extraOptions:e.genderChartData.extraOptions},on:{tableChage:e.genderTableChange}},[a("export-menu",{attrs:{slot:"export"},on:{onchange:e.genderExportBiztop},slot:"export"})],1)],1)])])},n=[],i=(a("28a5"),a("c5f6"),a("7514"),a("db0c")),s=a.n(i),o=(a("7f7f"),a("cebc")),d=a("e265"),u=a.n(d),c=a("a4bb"),h=a.n(c);function l(e,t){if(null==e)return{};var a,r,n={},i=h()(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}function g(e,t){if(null==e)return{};var a,r,n=l(e,t);if(u.a){var i=u()(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}a("a481"),a("ac6a"),a("6b54"),a("96cf");var m=a("3b8d"),p=a("3191"),f=a("d4a6"),b=a("94b0"),y=a("9777"),x=a("869a"),v=a("c1df"),D=a.n(v),_={name:"ageGender",components:{flowSelector:f["a"],chartTabs:x["a"],exportMenu:y["a"]},data:function(){return{typeOfCustom:"0",range:"",range2:"",canshow:!1,genderName:{0:{name:"女",icon:"female"},1:{name:"男",icon:"male"}},genderDict:{male:"男性",female:"女性"},chartData:{age:{},gender:{}},extraOptions:{chart:{stacked:!0},plotOptions:{bar:{endingShape:"flat"}},legend:{show:!0}},ageTableList:[],genderTableList:[]}},computed:{agechartData:function(){return this.chartData.age},genderChartData:function(){return this.chartData.gender},ageChartWidth:function(){var e;if(this.chartData.age.xAxis){var t=this.chartData.age.xAxis.data.length;e=t<10?"100%":60*t}else e="100%";return e}},methods:{paramsPrepare:function(){var e=Object(m["a"])(regeneratorRuntime.mark(function e(t){var a,r,n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.$store.state.home.headerAction||0!=t.entitys.length){e.next=3;break}return alert("请选择实体"),e.abrupt("return",!1);case 3:if(this.entitys=t.entitys,this.bzids=this.entitys.map(function(e){return e.id}),this.range=t.date1Array.toString(),"time"!==t.compareType){e.next=13;break}return this.range2=t.date2Array.toString(),e.next=10,Object(b["l"])({range1:this.range,range2:this.range2,bzid:this.bzids.toString()});case 10:a=e.sent,e.next=16;break;case 13:return e.next=15,Object(b["l"])({range1:this.range,bzid:this.bzids.toString()});case 15:a=e.sent;case 16:this.chartData=this.handleTypeData(a);try{"not"===t.compareType?(r="无对比",n=t.date1Array[0]+","+t.date1Array[1]):"entity"===t.compareType?(r="实体对比",t.entitys.forEach(function(e){i=e.belongsType?e.belongsType:""})):(r="时间对比",n=[t.date1Array.join(","),t.date2Array.join(",")]),window.TDAPP.onEvent(this.$route.meta.pageTitle+"页面","数据查询",{"对比方式":r,"时间段":n,"实体选择":i})}catch(s){console.log(this.$route.meta.pageTitle+"页面-数据查询埋点error:"+s)}case 18:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),handleTypeData:function(e){var t,a,r,n=this,i=e.data.data,d=1===h()(i[0].stat).length,u=[],c=[],l=[];if(i.forEach(function(e){h()(e.stat).forEach(function(t){var a=e.stat[t];u.push({id:e.bzid,time:t,name:"age_distribution",data:a.age_distribution}),c.push({id:e.bzid,time:t,name:"gender_propotion",data:a.gender_propotion})})}),t={name:"年龄",key:"age",data:h()(u[0].data).map(function(e){return e.replace("_","-").replace("less-","小于").replace(/more-/,"大于")})},d){var m=this.getGenderChartData(c,["id"]),p=m.labels,f=g(m,["labels"]);r=Object(o["a"])({xAxis:{name:"实体",key:"id",data:p}},f),l={name:"实体",key:"id",data:this.getAgeXaxis(u,["id"])},a=this.getAgeSeries(u)}else{var b=this.getGenderChartData(c,["id","time"]),y=b.labels,x=g(b,["labels"]);r=Object(o["a"])({xAxis:{name:"名称",key:"name",data:y}},x),l={name:"类别",key:"id_key",data:this.getAgeXaxis(u,["id","time"])},a=this.getAgeSeries(u)}if(1===i.length)if(d)r={labels:{name:"性别",key:"gender",data:h()(c[0].data).map(function(e){return n.genderName[e].name}),icons:h()(c[0].data).map(function(e){return n.genderName[e].icon})},series:s()(c[0].data),type:["radialBar"]},a=h()(this.genderDict).map(function(e){return{name:n.genderDict[e],key:e,data:s()(u[0].data).map(function(t){return t[e]})}});else{var v=this.getGenderChartData(c,["time"]),D=v.labels,_=g(v,["labels"]);r=Object(o["a"])({xAxis:{name:"时间",key:"time",data:D}},_),l={name:"时间",key:"time",data:this.getAgeXaxis(u,["time"])},a=this.getAgeSeries(u)}else if(d){var A=this.getGenderChartData(c,["id"]),z=A.labels,w=g(A,["labels"]);r=Object(o["a"])({xAxis:{name:"实体",key:"id",data:z}},w),l={name:"实体",key:"id",data:this.getAgeXaxis(u,["id"])},a=this.getAgeSeries(u)}else{var k=this.getGenderChartData(c,["id","time"]),C=k.labels,T=g(k,["labels"]);r=Object(o["a"])({xAxis:{name:"名称",key:"name",data:C}},T),l={name:"类别",key:"id_key",data:this.getAgeXaxis(u,["id","time"])},a=this.getAgeSeries(u)}return 1===i.length&&d?{age:{labels:t,series:a,type:["bar"]},gender:r}:{age:{xAxis:l,series:a,type:["bar"],extraOptions:this.extraOptions},gender:r}},getAgeXaxis:function(e,t){var a=this,r=[];return e.forEach(function(e){h()(a.genderDict).forEach(function(n){var i=[];t&&t.forEach(function(t){"id"===t&&i.push("".concat(a.entitys.find(function(t){return Number(t.id)===Number(e.id)}).label)),"time"===t&&i.push(e[t].split(",").join(" - "))});var s=i.length?"".concat(i.join(" ")," ").concat(a.genderDict[n]):"".concat(a.genderDict[n]);r.push(s)})}),r},getAgeSeries:function(e){var t=this,a=[];return h()(e[0].data).forEach(function(r){var n={},i=[];n.name=r.replace("_","-").replace("less-","小于").replace(/more-/,"大于"),n.key=r,e.forEach(function(e){h()(t.genderDict).forEach(function(t){i.push(e.data[r][t])})}),n.data=i,a.push(n)}),a},getGenderChartData:function(e,t){var a=this,r=[],n=[];e.forEach(function(e){var n=[];t.forEach(function(t){"id"===t&&n.push("".concat(a.entitys.find(function(t){return Number(t.id)===Number(e.id)}).label)),"time"===t&&n.push(e[t].split(",").join(" - "))}),r.push(n.join(" "))}),n=h()(e[0].data).map(function(t){var n={name:a.genderName[t].name,key:t,data:r.map(function(a,r){return e[r].data[t]})};return n});var i={chart:{stacked:1!==t.length},plotOptions:{bar:{endingShape:1!==t.length?"flat":"rounded"}},legend:{show:!0}};return{labels:r,series:n,type:["bar"],extraOptions:i}},ageTableChange:function(e){this.ageTableList=e.data},ageExportBiztop:function(){this.uploadList(this.ageTableList);try{window.TDAPP.onEvent(this.$route.meta.pageTitle+"页面","年龄分布下载",{})}catch(e){console.log(this.$route.meta.pageTitle+"页面-年龄分布下载-埋点error:"+e)}},genderTableChange:function(e){this.genderTableList=e.data},genderExportBiztop:function(){this.uploadList(this.genderTableList);try{window.TDAPP.onEvent(this.$route.meta.pageTitle+"页面","性别分布下载",{})}catch(e){console.log(this.$route.meta.pageTitle+"页面-性别分布下载-埋点error:"+e)}},uploadList:function(e){Object(p["b"])(e).then(function(e){var t=new Date,a=new Blob([e.data]),r="年龄性别客流数据",n=r+D()(t).format("YYYYMMDDHHmmss")+".xls",i=document.createElement("a");i.download=n,i.style.display="none",i.href=URL.createObjectURL(a),document.body.appendChild(i),i.click(),URL.revokeObjectURL(i.href),document.body.removeChild(i)})}}},A=_,z=(a("4402"),a("2877")),w=Object(z["a"])(A,r,n,!1,null,null,null);t["default"]=w.exports},"94b0":function(e,t,a){"use strict";a.d(t,"e",function(){return s}),a.d(t,"h",function(){return o}),a.d(t,"d",function(){return d}),a.d(t,"r",function(){return u}),a.d(t,"f",function(){return c}),a.d(t,"l",function(){return h}),a.d(t,"b",function(){return l}),a.d(t,"p",function(){return g}),a.d(t,"q",function(){return m}),a.d(t,"g",function(){return p}),a.d(t,"i",function(){return f}),a.d(t,"a",function(){return b}),a.d(t,"c",function(){return y}),a.d(t,"j",function(){return x}),a.d(t,"m",function(){return v}),a.d(t,"o",function(){return D}),a.d(t,"n",function(){return _}),a.d(t,"k",function(){return A});var r=a("66df"),n=a("4328"),i=a.n(n),s=function(e){return r["a"].request({url:"analysis/dateentityscompare",data:e,method:"post"})},o=function(e){var t=e.time1,a=e.time2,n=e.bzid;return r["a"].request({url:"dwelltime/chart",params:{time1:t,time2:a,bzid:n},method:"get"})},d=function(e){var t=e.time1,a=e.time2,n=e.from_bzid,i=e.to_bzid,s=e.range;return r["a"].request({url:"crossFlow/index",params:{time1:t,time2:a,from_bzid:n,to_bzid:i,range:s},method:"get"})},u=function(e){var t=e.bzid,a=e.time;return r["a"].request({url:"flow/assoc",params:{bzid:t,time:a},method:"get"})},c=function(e){var t=e.bzid,a=e.time;return r["a"].request({url:"cross/direction",params:{bzid:t,time:a},method:"get"})},h=function(e){return r["a"].request({url:"stat/entityFlowBatch",params:e,method:"get"})},l=function(e){return r["a"].request({url:"dict/industry",params:e,method:"get"})},g=function(e){var t=e.time1,a=e.time2,n=e.industry_id,i=e.property_id;return r["a"].request({url:"shop/enterRate/top",params:{time1:t,time2:a,industry_id:n,property_id:i},method:"get"})},m=function(e){var t=e.time1,a=e.time2,n=e.bzid,i=e.range;return r["a"].request({url:"shop/enterRate/trend",params:{time1:t,time2:a,bzid:n,range:i},method:"get"})},p=function(e){var t=e.time,a=e.bzid;return r["a"].request({url:"flow/drainage",params:{time:t,bzid:a},method:"get"})},f=function(e){var t=e.time,a=e.property_id;return r["a"].request({url:"flow/moving",params:{time:t,property_id:a},method:"get"})},b=function(e){var t=e.time,a=e.property_id,n=e.start,i=e.end,s=e.floor_id;return r["a"].request({url:"judge/keyPath",params:{time:t,property_id:a,start:n,end:i,floor_id:s},method:"get"})},y=function(e){var t=e.date,a=e.property_id;return r["a"].request({url:"manager/query_active_target",params:{date:t,property_id:a},method:"get"})},x=function(e,t,a,n){return r["a"].request({url:"passflow/visits",data:{bzid:e,start_time:t,end_time:a,innerRange:n},method:"post"})},v=function(e){var t=e.time,a=e.bzid,n=e.timeRange;return r["a"].request({url:"analysis/heat_map",data:i.a.stringify({time:t,bzid:a,timeRange:n}),method:"post"})},D=function(e){var t=e.bzid,a=e.type,n=e.time;return r["a"].request({url:"judge/getIsFloat",params:{bzid:t,type:a,time:n},method:"get"})},_=function(e){var t=e.property_id,a=e.type;return r["a"].request({url:"judge/getHKBzids",params:{property_id:t,type:a},method:"get"})},A=function(e){var t=e.time1,a=e.range,n=e.from_bzids,i=e.to_bzids;return r["a"].request({url:"cross/trend",params:{time1:t,range:a,from_bzids:n,to_bzids:i},method:"get"})}},"99de":function(e,t,a){}}]);