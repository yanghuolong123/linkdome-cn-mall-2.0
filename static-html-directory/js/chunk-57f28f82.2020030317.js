(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-57f28f82"],{"01c8":function(t,e,i){"use strict";i.d(e,"a",function(){return o});var n=i("178b"),a=i("3953"),r=i("1df6");function o(t){return Object(n["a"])(t)||Object(a["a"])(t)||Object(r["a"])()}},"1e32":function(t,e,i){},"2d1f":function(t,e,i){t.exports=i("b606")},"36bd":function(t,e,i){"use strict";var n=i("4bf8"),a=i("77f1"),r=i("9def");t.exports=function(t){var e=n(this),i=r(e.length),o=arguments.length,s=a(o>1?arguments[1]:void 0,i),c=o>2?arguments[2]:void 0,u=void 0===c?i:a(c,i);while(u>s)e[s++]=t;return e}},4474:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mt-6 p-6 bg-white box-card"},[i("div",{staticClass:"ranking-selector-box flex items-center"},[i("span",{staticClass:"mr-3"},[t._v(t._s(t.selectTitle))]),i("vs-select",{attrs:{autocomplete:"",placeholder:"请选择",noDataText:"暂无数据"},model:{value:t.bussinessType,callback:function(e){t.bussinessType=e},expression:"bussinessType"}},t._l(t.withAllOptions,function(t){return i("vs-select-item",{key:t.value,attrs:{value:t.value,text:t.text}})}),1)],1),t.bizTopData.length?i("div",{staticClass:"ranking-box mt-3"},[i("div",[i("chart-tabs",{key:"bizTop",attrs:{xAxis:t.bizChartData.xAxis,series:t.bizChartData.series,type:t.chartTypes,extraOptions:t.bizExtraOptions,istotal:t.istotal,title:"业态排行"},model:{value:t.exportType,callback:function(e){t.exportType=e},expression:"exportType"}},[t.indicatorSelector?i("vs-select",{staticClass:"chartSelector",attrs:{autocomplete:""},model:{value:t.bizIndicator,callback:function(e){t.bizIndicator=e},expression:"bizIndicator"}},t._l(t.indicators,function(t,e){return i("vs-select-item",{key:e,attrs:{text:t.name,value:t.value}})}),1):t._e(),i("export-menu",{attrs:{slot:"export"},on:{onchange:t.exportBiztop},slot:"export"})],1)],1),i("div",[i("chart-tabs",{key:"shopTop",attrs:{xAxis:t.topShopData.xAxis,series:t.topShopData.series,type:t.chartTypes,extraOptions:t.extraOptions,title:t.rightTypeTitle,isHome:!0,istotal:t.istotal},model:{value:t.exportType,callback:function(e){t.exportType=e},expression:"exportType"}},[i("export-menu",{attrs:{slot:"export"},on:{onchange:t.exportShoptop},slot:"export"}),t.indicatorSelector?i("vs-select",{staticClass:"chartSelector",attrs:{autocomplete:""},model:{value:t.shopIndicator,callback:function(e){t.shopIndicator=e},expression:"shopIndicator"}},t._l(t.indicators,function(t,e){return i("vs-select-item",{key:e,attrs:{text:t.name,value:t.value}})}),1):t._e()],1)],1)]):t._e()])},a=[],r=i("768b"),o=i("2d1f"),s=i.n(o),c=(i("55dd"),i("01c8")),u=i("795b"),d=i.n(u),l=(i("5df3"),i("6762"),i("2fdb"),i("6b54"),i("96cf"),i("3b8d")),p=i("cebc"),f=i("a745"),m=i.n(f),h=(i("28a5"),i("db0c")),b=i.n(h),y=(i("7514"),i("ac6a"),i("20d6"),i("7f7f"),i("75fc")),g=i("a4bb"),v=i.n(g),x=(i("c5f6"),i("869a")),z=i("2f62"),_=i("3191"),T=i("45d6"),D=i("9777"),O=i("c1df"),S=i.n(O),I=i("2ef0"),j=i.n(I),k={name:"rankingAnalytics",components:{chartTabs:x["a"],exportMenu:D["a"]},props:{time1:{type:String,default:null},time2:{type:String,default:null},propertyId:{type:[String,Number],default:null},footfallIndicators:{type:Object,default:function(){return{}}},indicatorData:{type:Object,default:function(){return T["a"]}},selectTitle:{type:String,default:"排行分析"},defaultBizIndicator:{type:String,default:"SaleAmount"},defaultShopIndicator:{type:String,default:"SaleAmount"},indicatorSelector:{type:Boolean,default:!0},bzid:{type:Array,default:null},drainageId:{type:Number,default:null},isDrainage:{type:Boolean,default:!1},typeName:{type:String,default:""},drainageApi:{type:Object,default:function(){return{}}},istotal:{type:Boolean,default:!1}},data:function(){return{showData:!1,exportEx:1,bussinessType:"all",readySelector:null,bizIndicator:"",shopIndicator:"",bizTopData:[],shopTopData:[],allBizTopData:[],chartTypes:["bar"],bizTypeOfSelect:"all",extraOptions:{plotOptions:{bar:{horizontal:!0}},colors:["#867bf0","#fbab3e"]},exportType:""}},watch:{time1:{immediate:!0,handler:function(t,e){this.getTopData()}},time2:{immediate:!0,handler:function(t,e){this.getTopData()}},propertyId:{immediate:!0,handler:function(t,e){this.getTopData()}},bussinessType:{handler:function(t,e){this.bizTypeOfSelect=t}},bzid:{handler:function(t,e){t&&this.getTopData()}},"$store.state.home.isGetDict":function(){1==this.$store.state.home.isGetDict&&this.getDict()}},created:function(){this.readySelector=this.getDictOfBussiness(),this.bizIndicator=this.defaultBizIndicator,this.shopIndicator=this.defaultShopIndicator},activated:function(){},computed:{rightTypeTitle:function(){var t;return t=0==this.$store.state.home.headerAction?"购物中心排行":"商铺排行",t},bussinessTypes:function(){var t=this.$store.state.home.bussinessDict;return v()(t).map(function(e){return{text:t[e],value:Number(e)}})},withAllOptions:function(){var t={text:"所有业态",value:"all"};return[t].concat(Object(y["a"])(this.bussinessTypes))},indicators:function(){var t=this;return v()(this.indicatorData).map(function(e){return{value:e,name:t.indicatorData[e].name}})},currentBizIdx:function(){var t=this;return j.a.findIndex(this.bussinessTypes,function(e){return e.value===t.bussinessType})},bizInxOfSelect:function(){var t=this;return j.a.findIndex(this.bussinessTypes,function(e){return e.value===t.bizTypeOfSelect})},bizChartData:function(){var t=this,e=this.currentBizIdx,i=v()(this.indicatorData).indexOf(this.bizIndicator),n=this.bizTopData[i].data.data,a={};e<0?a=n:v()(n).forEach(function(e){a[e]={},a[e][t.bussinessType]=n[e].find(function(e){return e.id===Number(t.bussinessType)})});var r=this;return{xAxis:{name:"名称",key:"bussiness",data:b()(b()(a)[0]).map(function(t){return t.name})},series:v()(a).map(function(t,e){if(e<10){var i={name:"".concat(r.indicatorData[r.bizIndicator].name," ").concat(t.split(",").join(" - ")),key:"data_".concat(t),data:b()(a[t]).map(function(t){return t.data})};return i}}),source:b()(b()(a)[0]).map(function(t){return t.id})}},topShopData:function(){var t=this,e=null,i=v()(this.indicatorData).indexOf(this.shopIndicator),n=this.currentBizIdx===this.bizInxOfSelect?this.currentBizIdx:this.bizInxOfSelect;e=n<0?this.allBizTopData[i].data.data:this.shopTopData[i][n].data.data;var a=m()(b()(e)[0])?e:this.sortdObj(e),r=v()(a)[0],o=a[r],s=[];return o.forEach(function(t,e){e<10&&s.push(t)}),{xAxis:{name:"名称",key:"shop",data:b()(a)[0].map(function(t){return j.a.isArray(t.name)?t.name[0]:t.name})},series:v()(a).map(function(e){return{name:"".concat(t.indicatorData[t.shopIndicator].name," ").concat(e.split(",").join(" - ")),key:"data_".concat(e),data:b()(a[e]).map(function(t){return t.data})}})}},bizExtraOptions:function(){var t=this,e={chart:{events:{dataPointSelection:function(e,i,n){t.handleChartPointSelect(n)}}},colors:["#00a1ea","#16dad2"]};return Object(p["a"])({},j.a.cloneDeep(this.extraOptions),j.a.cloneDeep(e))}},methods:Object(p["a"])({},Object(z["b"])(["getDictOfBussiness"]),{getTopData:j.a.debounce(Object(l["a"])(regeneratorRuntime.mark(function t(){var e,i,n,a,r,o=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this.$store.state.user.companyId,t.next=3,this.readySelector;case 3:i=[],n=[],a=[],r=this.propertyId,v()(this.indicatorData).forEach(function(t){var s;s=0!=o.$store.state.home.headerAction?{time1:o.time1,type:t,property_id:r,bzid:o.bzid&&o.bzid.toString()}:{time1:o.time1,type:t,company_id:e,bzid:o.bzid&&o.bzid.toString()};var c,u,d=["enter","occupancy"].includes(t),l=o.bussinessTypes.map(function(i){var n;if(n=0!=o.$store.state.home.headerAction?{time1:o.time1,type:t,property_id:r,industry_id:i.value,bzid:o.bzid&&o.bzid.toString()}:{time1:o.time1,type:t,company_id:e,industry_id:i.value,bzid:o.bzid&&o.bzid.toString()},o.time2&&(n.time2=o.time2),d){if(o.isDrainage){var a={};return a.time1=o.time1,a.from_bzids=o.bzid&&o.bzid.toString(),a.to_bzids=o.drainageId,a.industry_id=i.value,Object(_["i"])(a)}return Object(_["o"])(n)}return Object(_["q"])(n)});if(o.time2&&(s.time2=o.time2),d)if(o.isDrainage){var p={};p.time1=o.time1,p.from_bzids=o.bzid&&o.bzid.toString(),p.to_bzids=o.drainageId,c=Object(_["i"])(p)}else c=Object(_["o"])(s);else c=Object(_["q"])(s);if(n.push(c),a.push(l),d)if(o.isDrainage){var f={};f.time1=o.time1,f.from_bzids=o.bzid&&o.bzid.toString(),f.to_bzids=o.drainageId,u=Object(_["n"])(f)}else u=Object(_["f"])(s);else u=Object(_["p"])(s);i.push(u)}),d.a.all([i,n].concat(a).map(function(t){return d.a.all(t)})).then(function(t){var e=Object(c["a"])(t);o.bizTopData=e[0],o.allBizTopData=e[1],o.shopTopData=e.slice(2)}).catch(function(t){console.log(t)});case 9:case"end":return t.stop()}},t,this)})),100),handleChartPointSelect:function(t){this.bussinessType=this.bizChartData.source[t.dataPointIndex],this.bizTypeOfSelect=this.bizChartData.source[t.dataPointIndex]},sortdObj:function(t){var e=j.a.cloneDeep(b()(t)),i=e.reduce(function(t,e){return v()(t).forEach(function(i){t[i]=Number(t[i])+Number(e[i])}),t}),n=s()(i).sort(function(t,e){return e[1]-t[1]}),a={};return v()(j.a.cloneDeep(t)).forEach(function(e){var i=t[e];a[e]=n.map(function(t){var e=Object(r["a"])(t,2),n=e[0];e[1];return{name:[n],data:i[n]}})}),a},dowloadXlsx:function(t){var e=new Date,i=new Blob([t.data]),n=this.$router.currentRoute.name,a="";"drainage"==n?a="实体引流分析":"pathTrend"==n?a="路径动向分析":"sales"==n&&(a="销售分析");var r="";r=1==this.exportEx?"业态排行":"商铺排行";var o=a+r+S()(e).format("YYYYMMDDHHmmss")+".xls",s=document.createElement("a");s.download=o,s.style.display="none",s.href=URL.createObjectURL(i),document.body.appendChild(s),s.click(),URL.revokeObjectURL(s.href),document.body.removeChild(s)},exportBiztop:function(t){var e=this;"current"===t&&("drainage"==this.typeName?Object(_["d"])(this.drainageApi).then(function(t){e.exportEx=1,e.dowloadXlsx(t)}):Object(_["a"])({time1:this.time1,time2:this.time2,property_id:this.propertyId,type:this.bizIndicator,bzid:this.bzid&&this.bzid.toString()}).then(function(t){e.exportEx=1,e.dowloadXlsx(t)}))},exportShoptop:function(t){var e=this;"current"===t&&("drainage"==this.typeName?Object(_["e"])(this.drainageApi).then(function(t){e.exportEx=2,e.dowloadXlsx(t)}):Object(_["c"])({time1:this.time1,time2:this.time2,property_id:this.propertyId,type:this.shopIndicator,bzid:this.bzid&&this.bzid.toString(),industry_id:"all"===this.bussinessType?null:this.bussinessType}).then(function(t){e.exportEx=2,e.dowloadXlsx(t)}))},getDict:function(){var t=this;Object(_["g"])().then(function(e){t.$store.commit("saveBussinessType",e.data.data),t.$store.commit("isGetDict",!1)}).catch(function(t){console.log(t)})}})},w=k,A=(i("83d7"),i("2877")),B=Object(A["a"])(w,n,a,!1,null,"3d43b690",null);e["a"]=B.exports},"45d6":function(t,e,i){"use strict";i("c5f6");e["a"]={SaleAmount:{name:"销售额",icon:"dangrixiaoshoue",color:"#F64F61",unit:"（元）",yaxis:{title:{text:"销售额"},labels:{formatter:function(t){return null!==t?t.toLocaleString():""}}}},SquaerMetre:{name:"坪效",icon:"xingxiaoxiaoguo",color:"#1DD9D1",unit:"（元/平方米）",yaxis:{title:{text:"坪效（元/平方米）"},labels:{formatter:function(t){return null!==t?t.toLocaleString():""}}}},CloseRate:{name:"成交率",icon:"chengjiaohuafen",color:"#857AEF",yaxis:{title:{text:"成交率"},labels:{formatter:function(t){var e=Math.floor(100*Number(t))/100;if("number"===typeof e)return"".concat(e,"%")}}}},UnitPrice:{name:"客单价",icon:"jiage",color:"#33B3ED",unit:"（元）",yaxis:{title:{text:"客单价（元）"},labels:{formatter:function(t){return null!==t?t.toLocaleString():""}}}}}},"4d06":function(t,e,i){},5241:function(t,e,i){"use strict";i.d(e,"c",function(){return n}),i.d(e,"b",function(){return a}),i.d(e,"a",function(){return r});i("6c7b"),i("ac6a");var n=[],a=function(t,e,i,n,a){var r=Math.atan2(n-e,i-t),o=.5*(t+i),s=.5*(e+n),c=Math.abs(a*Math.cos(r)),u=Math.abs(a*Math.sin(r)),d=0,l=0;n<e&&i>t?(d=o+u,l=s+c):e==n&&t<i?(d=o,l=s+10):e==n&&t>i?(d=o,l=s-10):t==i&&e>n?(d=o+10,l=s):t==i&&e<n?(d=o-10,l=s):n<e&&t>i?(d=o+u,l=s-c):e-n<0&&t-i>0?(d=o-u,l=s-c):e-n<0&&i-t>0&&(d=o-u,l=s+c);var p={};return p.x=d,p.y=l,p},r=function(t,e,i,n){if(!Boolean(e)&&!Boolean(e))return!1;t.clearRect(e-50,i-50,120,120),t.beginPath(),t.arc(e,i,3,0,2*Math.PI,!1),t.fillStyle="#E8585A",t.fill(),t.beginPath(),t.lineWidth=.5,t.arc(e,i,n,0,2*Math.PI,!1),t.arc(e,i,n+2,0,2*Math.PI,!1),t.arc(e,i,n+4,0,2*Math.PI,!1),t.strokeStyle="#E8585A",t.stroke()}},"6c7b":function(t,e,i){var n=i("5ca1");n(n.P,"Array",{fill:i("36bd")}),i("9c6c")("fill")},"83d7":function(t,e,i){"use strict";var n=i("1e32"),a=i.n(n);a.a},"94b0":function(t,e,i){"use strict";i.d(e,"e",function(){return o}),i.d(e,"h",function(){return s}),i.d(e,"d",function(){return c}),i.d(e,"r",function(){return u}),i.d(e,"f",function(){return d}),i.d(e,"l",function(){return l}),i.d(e,"b",function(){return p}),i.d(e,"p",function(){return f}),i.d(e,"q",function(){return m}),i.d(e,"g",function(){return h}),i.d(e,"i",function(){return b}),i.d(e,"a",function(){return y}),i.d(e,"c",function(){return g}),i.d(e,"j",function(){return v}),i.d(e,"m",function(){return x}),i.d(e,"o",function(){return z}),i.d(e,"n",function(){return _}),i.d(e,"k",function(){return T});var n=i("66df"),a=i("4328"),r=i.n(a),o=function(t){return n["a"].request({url:"analysis/dateentityscompare",data:t,method:"post"})},s=function(t){var e=t.time1,i=t.time2,a=t.bzid;return n["a"].request({url:"dwelltime/chart",params:{time1:e,time2:i,bzid:a},method:"get"})},c=function(t){var e=t.time1,i=t.time2,a=t.from_bzid,r=t.to_bzid,o=t.range;return n["a"].request({url:"crossFlow/index",params:{time1:e,time2:i,from_bzid:a,to_bzid:r,range:o},method:"get"})},u=function(t){var e=t.bzid,i=t.time;return n["a"].request({url:"flow/assoc",params:{bzid:e,time:i},method:"get"})},d=function(t){var e=t.bzid,i=t.time;return n["a"].request({url:"cross/direction",params:{bzid:e,time:i},method:"get"})},l=function(t){return n["a"].request({url:"stat/entityFlowBatch",params:t,method:"get"})},p=function(t){return n["a"].request({url:"dict/industry",params:t,method:"get"})},f=function(t){var e=t.time1,i=t.time2,a=t.industry_id,r=t.property_id;return n["a"].request({url:"shop/enterRate/top",params:{time1:e,time2:i,industry_id:a,property_id:r},method:"get"})},m=function(t){var e=t.time1,i=t.time2,a=t.bzid,r=t.range;return n["a"].request({url:"shop/enterRate/trend",params:{time1:e,time2:i,bzid:a,range:r},method:"get"})},h=function(t){var e=t.time,i=t.bzid;return n["a"].request({url:"flow/drainage",params:{time:e,bzid:i},method:"get"})},b=function(t){var e=t.time,i=t.property_id;return n["a"].request({url:"flow/moving",params:{time:e,property_id:i},method:"get"})},y=function(t){var e=t.time,i=t.property_id,a=t.start,r=t.end,o=t.floor_id;return n["a"].request({url:"judge/keyPath",params:{time:e,property_id:i,start:a,end:r,floor_id:o},method:"get"})},g=function(t){var e=t.date,i=t.property_id;return n["a"].request({url:"manager/query_active_target",params:{date:e,property_id:i},method:"get"})},v=function(t,e,i,a){return n["a"].request({url:"passflow/visits",data:{bzid:t,start_time:e,end_time:i,innerRange:a},method:"post"})},x=function(t){var e=t.time,i=t.bzid,a=t.timeRange;return n["a"].request({url:"analysis/heat_map",data:r.a.stringify({time:e,bzid:i,timeRange:a}),method:"post"})},z=function(t){var e=t.bzid,i=t.type,a=t.time;return n["a"].request({url:"judge/getIsFloat",params:{bzid:e,type:i,time:a},method:"get"})},_=function(t){var e=t.property_id,i=t.type;return n["a"].request({url:"judge/getHKBzids",params:{property_id:e,type:i},method:"get"})},T=function(t){var e=t.time1,i=t.range,a=t.from_bzids,r=t.to_bzids;return n["a"].request({url:"cross/trend",params:{time1:e,range:i,from_bzids:a,to_bzids:r},method:"get"})}},"9a6d":function(t,e,i){"use strict";var n=i("4d06"),a=i.n(n);a.a},"9c60":function(t,e,i){var n=i("63b6"),a=i("13c8")(!0);n(n.S,"Object",{entries:function(t){return a(t)}})},b606:function(t,e,i){i("9c60"),t.exports=i("584a").Object.entries},c4a4:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"pathTab"},[i("div",{staticClass:"circle"},[t.parking?t._e():i("icons",{staticStyle:{cursor:"pointer"},attrs:{type:"zoulu",size:40,color:"#857AEF"}}),t.parking?i("p",{staticClass:"parking"},[t._v("P")]):t._e()],1),i("p",{staticClass:"title"},[t._v(t._s(t.title))]),i("p",{staticClass:"number",style:{right:t.right}},[t._v(t._s(t.numbers))])])},a=[],r={name:"pathTab",props:{title:{type:String,default:" 0 "},numbers:{type:String,default:" 0 "},right:{type:String,default:"24%"},parking:{type:Boolean,default:!1}},data:function(){return{}},watch:{}},o=r,s=(i("9a6d"),i("2877")),c=Object(s["a"])(o,n,a,!1,null,"102bce82",null);e["a"]=c.exports}}]);