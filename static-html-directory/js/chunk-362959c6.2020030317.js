(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-362959c6"],{"13c8":function(t,e,a){var i=a("c3a1"),r=a("36c3"),n=a("355d").f;t.exports=function(t){return function(e){var a,o=r(e),s=i(o),u=s.length,d=0,c=[];while(u>d)n.call(o,a=s[d++])&&c.push(t?[a,o[a]]:o[a]);return c}}},"13eb":function(t,e,a){t.exports=a.p+"img/floor-gate-icon.512f5e06.png"},"3f05":function(t,e,a){"use strict";var i=a("4684"),r=a.n(i);r.a},4305:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAACCCAYAAABGtuhTAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAARlJREFUaIHt2d1twzAMRlFSZpsVi+7/kAni/NpZ4hhgWnmAi/uJlETIef753QN+Q8ImcAIn8O8AKxIDM+npFaVDe8Mc/YGbBQ5uuGDg0JH/o+HSv220oV5DbhjaMPob6p1ywBpS3gQSoJ4cpmFHYP/IesbeteFrsYtYj9EdeB9lgTcP/GoOXDXwOr4tcE0MvOrIl3GyQB551UW5pI7s26Z9UXhjtze8pT5torvhPTQw8SX1CAx84nmuNm0YHLjjyB6oixKbHWEr8Excsdup/YDIGzfUQPvKMg0J0L6lHbJTKO8Tqpw6Mv7HFTX6R9bAoRvbG76w4QFAyotanhqoIx9gqIHcsD2w2hfFG7aP/AGGGujPQ27Y/V5+A5WHZrX/5CyOAAAAAElFTkSuQmCC"},4684:function(t,e,a){},"64c8":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"heatMaps"},[a("div",{staticClass:"path-picker"},[a("DatePicker",{staticStyle:{width:"230px",float:"left"},attrs:{type:"daterange",placement:"bottom-end",placeholder:"选择日期",options:t.disabledDate,format:"yyyy-MM-dd"},on:{"on-change":t.changeDayTime},model:{value:t.dayTime,callback:function(e){t.dayTime=e},expression:"dayTime"}}),a("Select",{staticClass:"selectExample",attrs:{disabled:t.disabled},model:{value:t.hourTime,callback:function(e){t.hourTime=e},expression:"hourTime"}},t._l(t.hourList,function(e){return a("Option",{key:e.label,attrs:{value:e.value,disabled:e.disabled}},[t._v(t._s(e.label))])}),1),a("Select",{staticClass:"selectExample selectFloor",model:{value:t.floor,callback:function(e){t.floor=e},expression:"floor"}},t._l(t.floorList,function(e){return a("Option",{key:e.label,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1),a("div",{staticClass:"drainage-submit",on:{click:t.searchData}},[t._v("查询")]),a("div",{staticClass:"drainage-submit drainage-reset",on:{click:t.reset}},[t._v("重置")])],1),a("div",{staticClass:"heatMap",style:{width:t.canvasWidth,height:t.canvasHeight},attrs:{id:"heatMap"}},[t.map?a("img",{attrs:{src:t.map,id:"mapImg"}}):a("div",{staticClass:"noData"},[t._v("暂无数据")]),a("div",{staticClass:"colorBar"},[a("p",{staticClass:"maxNumber"},[t._v(t._s(t.maxNumber))]),a("p",{staticClass:"minNumber"},[t._v(t._s(t.minNumber))]),a("img",{attrs:{src:t.colorBar,width:"20"}})]),t._l(t.gateList,function(e,i){return a("div",{key:i,staticClass:"gateDataList",style:{left:e.position.x-15+"px",top:e.position.y-30+"px"}},[a("img",{attrs:{src:t.gateIcon,alt:""},on:{mouseover:function(e){t.showData(i,"show")},mouseout:function(e){t.showData(i,"hide")}}}),e.isText?a("div",{staticClass:"gateDataText"},[a("p",[t._v(t._s(e.name))]),a("span",[t._v("客流 : "+t._s(e.enter))])]):t._e()])})],2)])},r=[],n=(a("ac6a"),a("db0c")),o=a.n(n),s=(a("7514"),a("a481"),a("c5f6"),a("28a5"),a("7f7f"),a("c1df")),u=a.n(s),d=a("2ef0"),c=a.n(d),m=a("94b0"),l=a("c276"),h={name:"goShop",components:{},data:function(){return{maxNumber:"",minNumber:"0",disabled:!1,canvasWidth:"",canvasHeight:"",map:"",colorBar:a("4305"),gateIcon:a("13eb"),hourTime:"",hourList:[],floor:"",floorList:[],dayTime:[],timeRange:"",gateList:[],disabledDate:""}},created:function(){this.disabledDate=l["b"],this.initHourList(),this.getFloorList()},watch:{screenWidth:{handler:function(t,e){this.screenWidth=t;var a=document.getElementById("heatMap").offsetWidth,i=document.getElementById("heatMap").offsetHeight;this.canvasWidth=a,this.canvasHeight=i}},dayTime:function(t){this.outRange=u()(t[0]).format("YYYY-MM-DD")+","+u()(t[1]).format("YYYY-MM-DD")},"$store.state.home.headerAction":function(){var t=this,e=this.$router.currentRoute.name;"HeatMap"===e&&(this.getFloorList(),setTimeout(function(){t.reset()},2e3))}},computed:{},mounted:function(){this.hourTime=u()(new Date).format("HH");var t=u()(new Date).format("YYYY-MM-DD"),e=c.a.cloneDeep(t);e=e.split("-"),e.splice(2,1,"01"),e=e.join("-");var a=[];a.push(t),a.push(t),this.dayTime=a,this.changeDayTime(a);var i=this;setTimeout(function(){var t=document.getElementsByClassName("heatMap")[0].offsetWidth,e=document.getElementsByClassName("heatMap")[0].offsetHeight;i.canvasWidth=t,i.canvasHeight=e}),window.onresize=function(){return function(){window.screenWidth=document.body.clientWidth,i.screenWidth=window.screenWidth}()}},methods:{getFloorList:function(){var t=this,e=this.$store.state.home.headerAction,a=this.$store.state.user.role_id,i=this.$store.state.user.bzid,r="is_heatmap";Object(m["n"])({property_id:e,type:r}).then(function(e){if(200==e.data.code){t.floorList=[];var r=e.data.data,n=r.map(function(t,e){var a={};return a.label=t.name,a.value=t.bzid,a.url=t.map_url,a.bzid=t.data.join(","),a});if(a<3)t.floorList=n;else{var o=[];n.map(function(t){i.map(function(e){t.value==e&&o.push(t)})}),t.floorList=o}t.floorList[0]&&(t.floor=t.floorList[0].value),t.searchData()}})},initHourList:function(){for(var t=[{label:"全天",value:"-1",disabled:!1}],e=0;e<24;e++){var a={};a.label=e+1+"时",a.value=Number(e)+"",a.disabled=!1,t.push(a)}this.hourList=t},changeDayTime:function(t){var e=u()(this.dayTime[0]).format("YYYY-MM-DD"),a=u()(this.dayTime[1]).format("YYYY-MM-DD"),i="";if(e==a&&Boolean(e)){i="hourly";var r=u()(new Date).format("HH");this.disabled=!1;var n=c.a.cloneDeep(this.hourList);n=e==u()(new Date).format("YYYY-MM-DD")?n.map(function(t){return r>=Number(t.value)?t.disabled=!1:t.disabled=!0,t}):n.map(function(t){return t.disabled=!1,t}),this.hourList=n}else i="daily",this.disabled=!0;this.timeRange=i},reset:function(){var t=u()(new Date).format("YYYY-MM-DD"),e=[t,t];this.dayTime=e,this.hourTime=u()(new Date).format("HH"),this.floor=this.floorList.length>0?this.floorList[0].value:"",this.disabled=!1;var a=document.getElementsByClassName("ivu-select-dropdown-list")[0].children;for(var i in a)if(i>=0&&i<=24){var r=a[i].className;a[i].className=r.replace("ivu-select-item-focus","")}try{window.TDAPP.onEvent(this.$route.meta.pageTitle+"页面","重置",{})}catch(n){console.log(this.$route.meta.pageTitle+"页面-重置-埋点error:"+n)}},searchData:function(){var t=this,e=this,a=u()(this.dayTime[0]).format("YYYY-MM-DD"),i=u()(this.dayTime[1]).format("YYYY-MM-DD"),r=a+","+i;if(this.map="",this.gateList=[],""==this.floor)return!1;var n=c.a.find(this.floorList,["value",this.floor]),s=n.bzid,d=document.getElementsByTagName("canvas");if(d[0]&&d[0].remove(),!s)return!1;this.map=n.url;var l=this.timeRange;Object(m["m"])({time:r,bzid:s,timeRange:l}).then(function(t){if(200==t.data.code){var a=[],i=t.data.data;if("hourly"==e.timeRange){for(var r in i)if("-1"==e.hourTime)a.push(i[r]);else if(Number(r)==Number(e.hourTime)){a.push(i[r]);break}setTimeout(function(){e.initHeatMap(a)},200)}else{for(var n in i)a.push(i[n]);setTimeout(function(){e.initHeatMap(a)},200)}}}),Object(m["o"])({time:r,bzid:n.value,type:l}).then(function(r){if(200==r.data.code){var n=r.data.data,s=document.getElementsByClassName("heatMap")[0].offsetWidth,u=document.getElementsByClassName("heatMap")[0].offsetHeight;n.map(function(r){var n={};n.name=r.name,n.id=r.bzid,n.isText=!1,n.position={x:Math.floor(r.position_x*s),y:Math.floor(r.position_y*u)},a==i?"-1"==e.hourTime?n.enter=c.a.sum(o()(r.enterList)).toLocaleString():n.enter=o()(r.enterList)[Number(e.hourTime)+1].toLocaleString():n.enter=c.a.sum(o()(r.enterList)).toLocaleString(),t.gateList.push(n)})}});try{var h=c.a.find(this.hourList,["value",this.hourTime]),f=-1==h.value?"全天":h.label;window.TDAPP.onEvent(this.$route.meta.pageTitle+"页面","数据查询",{"时间段":r,"小时数":f,"实体选择":n.label})}catch(p){console.log(this.$route.meta.pageTitle+"页面-数据查询埋点error:"+p)}},showData:function(t,e){this.gateList[t].isText="show"==e},initHeatMap:function(t){if(!(t.length>0))return!1;var e=t[0];t.forEach(function(t,a){a>0&&t.forEach(function(t,a){e[a].enter+=t.enter})}),t=[e];var a=document.getElementsByTagName("canvas");a[0]&&a[0].remove();var i=document.getElementsByClassName("heatMap")[0].offsetWidth,r=document.getElementsByClassName("heatMap")[0].offsetHeight,n=Number(.09*i),o=h337.create({container:document.querySelector("#heatMap"),radius:n,gradient:{".9":"#ec1313",".8":"#e8585a",".66":"#feb33d",".5":"#86ef40",".42":"#2bd9cf",".28":"#33b3ed",".15":"#7367f0"}}),s=[],u=c.a.maxBy(t[0],"enter");u=u.enter,this.maxNumber=u,t[0].forEach(function(t){var e={x:Math.floor(t.x*i),y:Math.floor(t.y*r),value:t.enter};0!=Number(t.x)&&0!=Number(t.y)&&0!=Number(t.enter)&&s.push(e)});var d={max:u,data:s};o.setData(d)}}},f=h,p=(a("3f05"),a("2877")),g=Object(p["a"])(f,i,r,!1,null,null,null);e["default"]=g.exports},"7d6d":function(t,e,a){var i=a("63b6"),r=a("13c8")(!1);i(i.S,"Object",{values:function(t){return r(t)}})},"94b0":function(t,e,a){"use strict";a.d(e,"e",function(){return o}),a.d(e,"h",function(){return s}),a.d(e,"d",function(){return u}),a.d(e,"r",function(){return d}),a.d(e,"f",function(){return c}),a.d(e,"l",function(){return m}),a.d(e,"b",function(){return l}),a.d(e,"p",function(){return h}),a.d(e,"q",function(){return f}),a.d(e,"g",function(){return p}),a.d(e,"i",function(){return g}),a.d(e,"a",function(){return v}),a.d(e,"c",function(){return b}),a.d(e,"j",function(){return y}),a.d(e,"m",function(){return D}),a.d(e,"o",function(){return A}),a.d(e,"n",function(){return T}),a.d(e,"k",function(){return w});var i=a("66df"),r=a("4328"),n=a.n(r),o=function(t){return i["a"].request({url:"analysis/dateentityscompare",data:t,method:"post"})},s=function(t){var e=t.time1,a=t.time2,r=t.bzid;return i["a"].request({url:"dwelltime/chart",params:{time1:e,time2:a,bzid:r},method:"get"})},u=function(t){var e=t.time1,a=t.time2,r=t.from_bzid,n=t.to_bzid,o=t.range;return i["a"].request({url:"crossFlow/index",params:{time1:e,time2:a,from_bzid:r,to_bzid:n,range:o},method:"get"})},d=function(t){var e=t.bzid,a=t.time;return i["a"].request({url:"flow/assoc",params:{bzid:e,time:a},method:"get"})},c=function(t){var e=t.bzid,a=t.time;return i["a"].request({url:"cross/direction",params:{bzid:e,time:a},method:"get"})},m=function(t){return i["a"].request({url:"stat/entityFlowBatch",params:t,method:"get"})},l=function(t){return i["a"].request({url:"dict/industry",params:t,method:"get"})},h=function(t){var e=t.time1,a=t.time2,r=t.industry_id,n=t.property_id;return i["a"].request({url:"shop/enterRate/top",params:{time1:e,time2:a,industry_id:r,property_id:n},method:"get"})},f=function(t){var e=t.time1,a=t.time2,r=t.bzid,n=t.range;return i["a"].request({url:"shop/enterRate/trend",params:{time1:e,time2:a,bzid:r,range:n},method:"get"})},p=function(t){var e=t.time,a=t.bzid;return i["a"].request({url:"flow/drainage",params:{time:e,bzid:a},method:"get"})},g=function(t){var e=t.time,a=t.property_id;return i["a"].request({url:"flow/moving",params:{time:e,property_id:a},method:"get"})},v=function(t){var e=t.time,a=t.property_id,r=t.start,n=t.end,o=t.floor_id;return i["a"].request({url:"judge/keyPath",params:{time:e,property_id:a,start:r,end:n,floor_id:o},method:"get"})},b=function(t){var e=t.date,a=t.property_id;return i["a"].request({url:"manager/query_active_target",params:{date:e,property_id:a},method:"get"})},y=function(t,e,a,r){return i["a"].request({url:"passflow/visits",data:{bzid:t,start_time:e,end_time:a,innerRange:r},method:"post"})},D=function(t){var e=t.time,a=t.bzid,r=t.timeRange;return i["a"].request({url:"analysis/heat_map",data:n.a.stringify({time:e,bzid:a,timeRange:r}),method:"post"})},A=function(t){var e=t.bzid,a=t.type,r=t.time;return i["a"].request({url:"judge/getIsFloat",params:{bzid:e,type:a,time:r},method:"get"})},T=function(t){var e=t.property_id,a=t.type;return i["a"].request({url:"judge/getHKBzids",params:{property_id:e,type:a},method:"get"})},w=function(t){var e=t.time1,a=t.range,r=t.from_bzids,n=t.to_bzids;return i["a"].request({url:"cross/trend",params:{time1:e,range:a,from_bzids:r,to_bzids:n},method:"get"})}},"9e1c":function(t,e,a){a("7d6d"),t.exports=a("584a").Object.values},db0c:function(t,e,a){t.exports=a("9e1c")}}]);