(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-eb665092"],{4977:function(t,e,a){"use strict";var n=a("671c"),i=a.n(n);i.a},"671c":function(t,e,a){},"8f16":function(t,e,a){"use strict";var n=a("e76d"),i=a.n(n);i.a},"92f6":function(t,e,a){"use strict";e["a"]={newNum:{name:"新顾客",icon:"kehulianxiren1"},oldNum:{name:"老顾客",icon:"kehulianxiren"},ordinaryNum:{name:"普通顾客",icon:"xingming"},vipNum:{name:"VIP顾客",icon:"shengjivip"},clertNum:{name:"工作人员",icon:"yingpinzhiwei"},customerNum:{name:"顾客",icon:"Group-"},1:{name:"1次",icon:"circle"},2:{name:"2次",icon:"circle"},3:{name:"3次",icon:"circle"},4:{name:"4次",icon:"circle"},5:{name:"5次及以上",icon:"circle"}}},"94b0":function(t,e,a){"use strict";a.d(e,"e",function(){return o}),a.d(e,"h",function(){return s}),a.d(e,"d",function(){return c}),a.d(e,"r",function(){return u}),a.d(e,"f",function(){return l}),a.d(e,"l",function(){return h}),a.d(e,"b",function(){return p}),a.d(e,"p",function(){return f}),a.d(e,"q",function(){return d}),a.d(e,"g",function(){return m}),a.d(e,"i",function(){return y}),a.d(e,"a",function(){return g}),a.d(e,"c",function(){return b}),a.d(e,"j",function(){return D}),a.d(e,"m",function(){return v}),a.d(e,"o",function(){return x}),a.d(e,"n",function(){return T}),a.d(e,"k",function(){return _});var n=a("66df"),i=a("4328"),r=a.n(i),o=function(t){return n["a"].request({url:"analysis/dateentityscompare",data:t,method:"post"})},s=function(t){var e=t.time1,a=t.time2,i=t.bzid;return n["a"].request({url:"dwelltime/chart",params:{time1:e,time2:a,bzid:i},method:"get"})},c=function(t){var e=t.time1,a=t.time2,i=t.from_bzid,r=t.to_bzid,o=t.range;return n["a"].request({url:"crossFlow/index",params:{time1:e,time2:a,from_bzid:i,to_bzid:r,range:o},method:"get"})},u=function(t){var e=t.bzid,a=t.time;return n["a"].request({url:"flow/assoc",params:{bzid:e,time:a},method:"get"})},l=function(t){var e=t.bzid,a=t.time;return n["a"].request({url:"cross/direction",params:{bzid:e,time:a},method:"get"})},h=function(t){return n["a"].request({url:"stat/entityFlowBatch",params:t,method:"get"})},p=function(t){return n["a"].request({url:"dict/industry",params:t,method:"get"})},f=function(t){var e=t.time1,a=t.time2,i=t.industry_id,r=t.property_id;return n["a"].request({url:"shop/enterRate/top",params:{time1:e,time2:a,industry_id:i,property_id:r},method:"get"})},d=function(t){var e=t.time1,a=t.time2,i=t.bzid,r=t.range;return n["a"].request({url:"shop/enterRate/trend",params:{time1:e,time2:a,bzid:i,range:r},method:"get"})},m=function(t){var e=t.time,a=t.bzid;return n["a"].request({url:"flow/drainage",params:{time:e,bzid:a},method:"get"})},y=function(t){var e=t.time,a=t.property_id;return n["a"].request({url:"flow/moving",params:{time:e,property_id:a},method:"get"})},g=function(t){var e=t.time,a=t.property_id,i=t.start,r=t.end,o=t.floor_id;return n["a"].request({url:"judge/keyPath",params:{time:e,property_id:a,start:i,end:r,floor_id:o},method:"get"})},b=function(t){var e=t.date,a=t.property_id;return n["a"].request({url:"manager/query_active_target",params:{date:e,property_id:a},method:"get"})},D=function(t,e,a,i){return n["a"].request({url:"passflow/visits",data:{bzid:t,start_time:e,end_time:a,innerRange:i},method:"post"})},v=function(t){var e=t.time,a=t.bzid,i=t.timeRange;return n["a"].request({url:"analysis/heat_map",data:r.a.stringify({time:e,bzid:a,timeRange:i}),method:"post"})},x=function(t){var e=t.bzid,a=t.type,i=t.time;return n["a"].request({url:"judge/getIsFloat",params:{bzid:e,type:a,time:i},method:"get"})},T=function(t){var e=t.property_id,a=t.type;return n["a"].request({url:"judge/getHKBzids",params:{property_id:e,type:a},method:"get"})},_=function(t){var e=t.time1,a=t.range,i=t.from_bzids,r=t.to_bzids;return n["a"].request({url:"cross/trend",params:{time1:e,range:a,from_bzids:i,to_bzids:r},method:"get"})}},e76d:function(t,e,a){},ea99:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"bg-white box-card px-4 pb-6"},[a("flow-selector",{attrs:{footFall:t.footFall,isNeedEntity:t.userType,routName:"entity",isGate:!0,isShop:!1,isArea:!0,isFloor:!0,isStore:!0,isReset:!0},on:{"on-change":t.paramsPrepare}})],1),a("div",{staticClass:"mt-6 z-50"},[a("charts-list",{attrs:{data:t.computeChartData},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.item;return[a("chart-tabs",{attrs:{xAxis:n.xAxis,labels:n.labels,series:n.series,type:n.type,height:n.height,title:n.title,extraOptions:n.extraOptions,istotal:!n.title,chartWidth:t.entityChartWidth(n)},on:{tableChage:t.enterTableChage}},[n.footfallSelect?[a("div",{staticClass:"flex justify-between items-center mr-10"},[a("span",{staticClass:"whitespace-no-wrap mx-4 text-sm"},[t._v("数据指标:")]),a("vs-select",{attrs:{autocomplete:"",multiple:"",id:"chartSelect"},model:{value:t.footfallType,callback:function(e){t.footfallType=e},expression:"footfallType"}},t._l(t.selectList,function(t,e){return a("vs-select-item",{key:e,attrs:{text:t.name,value:t.value}})}),1)],1)]:t._e(),a("export-menu",{attrs:{slot:"export"},on:{onchange:function(e){t.enterExportBiztop(n)}},slot:"export"})],2)]}}])}),2!==this.footfallType.length?a("div",{staticClass:"bg-white box-card",staticStyle:{padding:"25px","margin-top":"20px"}},[a("i-table",{attrs:{columns:t.eoData.detail.columns,data:t.eoData.detail.data}},[a("template",{slot:"head"},[a("span",{staticClass:"text-xl table-header pb-3"},[t._v("客流量详细数据信息")])])],2)],1):t._e()],1),t.occuCanshow?a("div",[a("div",{staticClass:"bg-white box-card  mt-6"},[a("chart-tabs",{attrs:{xAxis:t.occuData.xAxis,extraOptions:t.occpuancyOptions,series:t.occuData.series,title:"集客量趋势",istotal:!1},on:{tableChage:t.occupancyTableChage}},[a("export-menu",{attrs:{slot:"export"},on:{onchange:t.occupancyExportBiztop},slot:"export"})],1)],1),a("div",{staticClass:"bg-white box-card",staticStyle:{padding:"25px","margin-top":"20px"}},[a("i-table",{attrs:{columns:t.occuData.detail.columns,data:t.occuData.detail.data}},[a("template",{slot:"head"},[a("span",{staticClass:"text-xl table-header pb-3"},[t._v("集客量详细数据信息")])])],2)],1)]):t._e()])},i=[],r=(a("a481"),a("6762"),a("2fdb"),a("28a5"),a("7514"),a("20d6"),a("7f7f"),a("db0c")),o=a.n(r),s=a("795b"),c=a.n(s),u=(a("ac6a"),a("5df3"),a("6b54"),a("75fc")),l=(a("c5f6"),a("a4bb")),h=a.n(l),p=a("3191"),f=a("92f6"),d=a("94b0"),m=a("2ef0"),y=a.n(m),g=a("c276"),b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"chart-list"},t._l(t.data,function(e,n){return a("div",{key:n,staticClass:"item box-card bg-white",class:{times:"arrival_distribution"===e.name}},[t._t("default",null,{item:e})],2)}))},D=[],v={name:"chartList",props:{data:{type:Array,default:function(){return[]}}}},x=v,T=(a("8f16"),a("2877")),_=Object(T["a"])(x,b,D,!1,null,"831c5ba2",null),C=_.exports,w=a("c1df"),z=a.n(w),O=a("869a"),k=a("d4a6"),A=a("4ee1f"),E=a("9777"),L={name:"footfallAnalytics",components:{flowSelector:k["a"],ChartsList:C,chartTabs:O["a"],iTable:A["a"],exportMenu:E["a"]},data:function(){return{dateType:"",footFall:!0,typeOfCustom:0,isShowExit:!0,selectType:"",entitys:[],bzids:[],occupancyId:[],innerRange:"",innerRange2:"",isDurationOneDay:!1,range:"",range2:"",isDateCompare:!1,occuCanshow:!0,entitysType:{floor:"楼层",gate:"出入口",area:"区域",shop:"购物中心",store:"商铺"},footfallData:{},reqTypes:null,defaultData:{xAxis:{name:"",key:null,data:[]},series:[{name:"客流量",key:null,data:[]}],detail:{columns:[],data:[]}},chartsListData:[],sourceData:[{type:["donut"],name:"new_old_proportion",title:"新老顾客占比"},{type:["radialBar"],name:"vip_proportion",title:"VIP顾客占比"},{type:["pie"],name:"arrival_distribution",title:"到店次数"},{type:["radialBar"],name:"clerk_proportion",title:"工作人员占比"}],selectList:[{value:"enter",name:"入客流"},{value:"exit",name:"出客流"}],footfallType:["enter"],occpuancyOptions:{yaxis:[]},enterTableList:[],occupancyTableList:[],clientTabList:[],frequencyTabList:[]}},watch:{footfallType:function(){0==this.footfallType.length&&(this.footfallType=["enter"]);try{var t;t=0==this.footfallType.length?"出客流":1==this.footfallType.length?"enter"==this.footfallType[0]?"入客流":"出客流":["入客流","出客流"],window.TDAPP.onEvent(this.$route.meta.pageTitle+"页面","客流量趋势指标选择",{"指标":t})}catch(e){console.log(this.$route.meta.pageTitle+"页面-客流量趋势指标选择指标-埋点error:"+e)}}},computed:{userType:function(){var t=this.$store.state.user.accountLvl;return"store"!=t&&"floor"!=t},eoData:function(){if(!h()(this.footfallData).length)return this.defaultData;if(2===this.footfallType.length)return this.footfallData.all;if("enter"===this.footfallType[0])return this.footfallData.enter;if("exit"===this.footfallType[0])return this.footfallData.exit;var t=y.a.cloneDeep(this.footfallData.enter);return t.xAxis.data=[],t.sumArr=[],t.series.map(function(t){t.data=[]}),t.detail={data:[],columns:[{key:"name",title:"实体名称"},{key:"type",title:"实体类别"},{key:"sum",title:"累计入客流量"},{key:"highest",title:"入客流峰值",type:"html"}]},this.footfallData.enter},occuData:function(){var t=this;if(!h()(this.footfallData).length&&this.occuCanshow)return this.defaultData;this.footfallData.occupancy.series.map(function(e,a){e.data.map(function(e,n){Number(e)<0&&(t.footfallData.occupancy.series[a].data[n]=0)})});var e=y.a.sum(this.footfallData.occupancy.series[0]&&this.footfallData.occupancy.series[0].data),a={title:{text:"",style:{fontSize:"13px"}},labels:{formatter:function(t){return y.a.round(t,0).toLocaleString()}}};return 0!=e&&(a.min=0),this.occpuancyOptions.yaxis=[],this.occpuancyOptions.yaxis.push(a),this.footfallData.occupancy},chartTypes:function(){return this.bzids.length>1&&2===this.footfallType.length?["bar"]:["line","bar"]},computeChartData:function(){var t={plotOptions:{bar:{horizontal:!1,endingShape:"rounded",radius:0,distributed:!1}},yaxis:[]},e={xAxis:this.eoData.xAxis,series:this.eoData.series,footfallSelect:this.isShowExit,extraOptions:t,type:this.chartTypes},a=y.a.sum(e.series[0]&&e.series[0].data),n={title:{text:"",style:{fontSize:"13px"}},labels:{formatter:function(t){return y.a.round(t,0).toLocaleString()}}};0!=a&&(n.min=0),t.yaxis.push(n);var i=this.$store.state.user.accountLvl;return"store"==i?[e].concat():[].concat(Object(u["a"])(this.chartsListData),[e])}},methods:{paramsPrepare:function(t){var e=this;if(0==this.$store.state.home.headerAction)return!1;if(0==t.entitys.length)return alert("请选择实体"),!1;this.innerRange=Object(g["j"])(t.date1Array),this.innerRange2=Object(g["j"])(t.date2Array),this.isShowExit="0"===t.enterType,this.typeOfCustom=t.enterType,this.entitys=t.entitys,this.occupancyId=this.entitys.filter(function(t){return"gate"!==t.itype}).map(function(t){return t.id}),this.bzids=this.entitys.map(function(t){return t.id}),this.range=this.formatDay(t.date1Array[0])+","+this.formatDay(t.date1Array[1]);var a=null,n=null;if(this.bzids=y.a.remove(this.bzids,function(t){return 0!=t}),this.selectType=t.compareType,"time"===t.compareType){var i=Object(g["j"])(t.date1Array),r=Object(g["j"])(t.date2Array);this.isDurationOneDay="1h"===this.innerRange&&"1h"===this.innerRange2,this.isDateCompare=!0,this.range2=this.formatDay(t.date2Array[0])+","+this.formatDay(t.date2Array[1]),a=this.getDateCompareParams(),n=a.map(function(t){return Object(d["e"])(t)}),this.dateType="1month"==i||"1month"==r?"月":"天",Object(d["l"])({range1:this.range,range2:this.range2,bzid:this.bzids.toString()}).then(function(t){e.handleTypeData(t)})}else this.isDurationOneDay="1h"===this.innerRange,this.isDateCompare=!1,a=this.getCompareParams(),n=a.map(function(t){return Object(p["w"])(t)}),Object(d["l"])({range1:this.range,bzid:this.bzids.toString()}).then(function(t){e.handleTypeData(t)});c.a.all(n).then(function(a){"time"===t.compareType?e.handleDateCompareRes(a):e.handleRes(a)}),this.occuCanshow=this.isDurationOneDay&&this.occupancyId.length,this.reqTypes=a.map(function(t){return t.type});try{var o,s,u;"not"===t.compareType?(o="无对比",s=t.date1Array[0]+","+t.date1Array[1]):"entity"===t.compareType?(o="实体对比",t.entitys.forEach(function(t){u=t.belongsType?t.belongsType:""})):(o="时间对比",s=[t.date1Array.join(","),t.date2Array.join(",")]),window.TDAPP.onEvent(this.$route.meta.pageTitle+"页面","实体客流数据查询",{"对比方式":o,"时间段":s,"实体选择":u})}catch(l){console.log(this.$route.meta.pageTitle+"页面-实体客流数据查询埋点error:"+l)}},formatDay:function(t){return z()(t).format("YYYY-MM-DD")},getCompareParams:function(){var t=[this.initParams({})];return this.isShowExit&&t.push(this.initParams({type:"exit"})),this.isDurationOneDay&&this.occupancyId.length&&t.push(this.initParams({type:"occupancy"})),t},getDateCompareParams:function(){var t=[];return this.isDurationOneDay?(t.push(this.initdateReqParams({innerRange:"1h"})),this.isShowExit&&t.push(this.initdateReqParams({type:"exit",innerRange:"1h"})),this.occupancyId.length&&t.push(this.initdateReqParams({type:"occupancy",innerRange:"1h"}))):(t.push(this.initdateReqParams({})),this.isShowExit&&t.push(this.initdateReqParams({type:"exit"}))),t},initParams:function(t){var e=t.type,a=void 0===e?"enter":e,n="occupancy"===a?this.occupancyId:this.bzids;return{range:this.range,innerRange:this.innerRange,bzid:n.toString(),type:a}},handleTypeData:function(t){var e,a=t.data.data;a.length>0&&(e=1===h()(a[0].stat).length);var n=[];a.forEach(function(t){h()(t.stat).forEach(function(e){var a=t.stat[e];delete a.age_distribution,delete a.gender_propotion,h()(a).forEach(function(i){var r={};r.id=t.bzid,r.time=e,r.name=i,r.val=o()(a[i]),r.labels=h()(a[i]),n.push(r)})})}),this.chartsListData=1===a.length?e?this.generateChartData(n):this.generateChartData(n,["time"],"bar"):e?this.generateChartData(n,["id"],"bar"):this.generateChartData(n,["id","time"],"bar"),this.chartsListData=y.a.remove(this.chartsListData,function(t){return"vip_proportion"!==t.name}),this.chartsListData=y.a.remove(this.chartsListData,function(t){return"clerk_proportion"!==t.name})},generateChartData:function(t,e,a){for(var n=this,i=y.a.cloneDeep(this.filterInitChartData()),r=y.a.groupBy(t,"name"),o=e?2===e.length?"名称":"time"===e[0]?"时间":"实体":"类型",s=h()(r),c=function(t){var c=s[t],u=y.a.findIndex(i,function(t){return t.name===c});if(u<0)return"continue";a&&"bar"===a?(i[u].type=["bar"],i[u].extraOptions={chart:{stacked:!("arrival_distribution"!==c&&2!==e.length)},plotOptions:{bar:{endingShape:"arrival_distribution"===c||2===e.length?"flat":"rounded"}},legend:{show:!0}},i[u].series=n.getSeries(r[c]),i[u].xAxis={name:o,key:e.join("_"),data:r[c].map(function(t){var a=[];return e.forEach(function(e){"id"===e&&a.push("".concat(n.entitys.find(function(e){return Number(e.id)===Number(t.id)}).label)),"time"===e&&a.push(t[e].split(",").join(" - "))}),a.join(" ")})}):(i[u].labels={name:o,key:"id",data:r[c][0].labels.map(function(t){return f["a"][t].name}),icons:r[c][0].labels.map(function(t){return f["a"][t].icon})},i[u].series=r[c][0].val)},u=0;u<s.length;u++)c(u);return i},filterInitChartData:function(){var t;return"0"===this.typeOfCustom&&(t=this.sourceData.map(function(t){return t})),"1"===this.typeOfCustom&&(t=this.sourceData.filter(function(t){return"clerk_proportion"!==t.name})),"2"===this.typeOfCustom&&(t=this.sourceData.filter(function(t){return"enter"===t.name})),"3"===this.typeOfCustom&&(t=this.sourceData.filter(function(t){return["vip_proportion","arrival_distribution","enter"].includes(t.name)})),"4"===this.typeOfCustom&&(t=this.sourceData.filter(function(t){return["arrival_distribution","enter"].includes(t.name)})),t},getSeries:function(t){var e=t[0].labels;return e.map(function(e,a){return{name:f["a"][e].name,key:e,data:t.map(function(t){return t.val[a]})}})},initdateReqParams:function(t){var e,a=t.type,n=void 0===a?"enter":a,i=this.range.split(","),r=this.range2.split(","),o="occupancy"===n?this.occupancyId:this.bzids,s=Object(g["j"])(i),c=Object(g["j"])(r);e="1month"==s||"1month"==c?"1month":"1h"===s&&"1h"===c?"1h":"1day";var u={begin:z()(i[0]).format("YYYY-MM-DD"),end:z()(i[1]).format("YYYY-MM-DD")},l={begin:z()(r[0]).format("YYYY-MM-DD"),end:z()(r[1]).format("YYYY-MM-DD")},h={date1:u,date2:l,type:n,bzid:o.toString(),innerRange:e};return h},handleRes:function(t){var e=this,a={};if(this.reqTypes.forEach(function(n,i){a[n]=e.processData(t[i].data.data,n)}),this.isShowExit){var n=[],i=[],r=a.enter,o=a.exit;1===this.entitys.length?(n=y.a.cloneDeep(r.series),n.push(o.series[0]),i=r.xAxis):(n.push({name:"入客流",key:"enter",data:r.sumArr}),n.push({name:"出客流",key:"exit",data:o.sumArr}),i={key:"entity",name:"实体",data:r.eoXaxis}),a.all={xAxis:i,series:n}}this.footfallData=a},processData:function(t,e){var a=this,n=this.getFootFallName(e),i=[],r=[],o=[],s=[],c=[],u=[],l={},h=[];t.forEach(function(t,e){var n=Object(g["f"])({beginDate:t.begin,innerRange:a.innerRange});i.push(n),a.isDurationOneDay&&t?(z()(t.end).isAfter(z()(),"h")&&t.compares.forEach(function(t){t.number=null}),r.push(t.compares)):r.push(t.compares)});var p=y.a.zip.apply(y.a,r);return p.forEach(function(e){s.push(y.a.sumBy(e,function(t){return t?t.number:0}));var a=y.a.maxBy(e,function(t){return t.number}).number,n=y.a.findIndex(e,function(t){return t.number===a}),i="".concat(t[n].begin,",").concat(t[n].end);u.push({number:a,date:i})}),t[0]&&t[0].compares.forEach(function(t,i){var r=y.a.find(a.entitys,function(e){return e.id===t.bzid}).itype;o.push({name:"".concat(t.name," ").concat(n),key:"".concat(t.bzid,"_").concat(e),data:p[i].map(function(t){return t.number})}),c.push(t.name);var f=u[i].number>0?u[i].number:0;h.push({name:t.name,sum:"".concat(s[i].toLocaleString(),"人"),type:a.entitysType[r]||"购物中心",highest:"".concat(f.toLocaleString(),"人   ").concat(a.highestDateFormat(u[i].date))}),l.data=h,l.columns=a.initColumns(e)}),{xAxis:{key:"date",name:"时间",data:i},series:o,eoXaxis:c,sumArr:s,detail:l}},handleDateCompareRes:function(t){var e=this,a={};if(this.reqTypes.forEach(function(n,i){a[n]=e.datesEntityFind(t[i].data.data,n)}),this.isShowExit){var n=y.a.cloneDeep(a.enter),i=y.a.cloneDeep(a.exit),r=n.series,o=i.series;r.forEach(function(t,e){r.splice(2*e+1,0,o[e])}),a.all={xAxis:n.xAxis,series:r}}this.footfallData=a},datesEntityFind:function(t,e,a){var n=this,i=this.getFootFallName(e),r="occupancy"===e?this.entitys.filter(function(t){return"gate"!==t.itype}):this.entitys,o=this.isDurationOneDay,s=[],c=[],u=[],l=this.initColumns(e),h={},p={title:"时间点",key:"time"};l.splice(2,0,p),y.a.forEach(r,function(t,a){var r={name:"".concat(t.name,"|").concat(n.formatDate(n.range),"|").concat(i),key:"".concat(e,"_").concat(t.id,"_").concat(n.range),data:[]},o={name:"".concat(t.name,"|").concat(n.formatDate(n.range2),"|").concat(i),key:"".concat(e,"_").concat(t.id,"_").concat(n.range2),data:[]};s.push(r),s.push(o)});var f=this.compareDurations(this.range,this.range2);return y.a.forEach(t,function(a,i){var r=n.createPointsData(a.date1,n.range,e,f),u=n.createPointsData(a.date2,n.range2,e,!f);if(y.a.forEach(a.date1,function(t,e){s[2*e].data.push(r[e])}),y.a.forEach(a.date2,function(t,e){s[2*e+1].data.push(u[e])}),o){var l=t[i].date1[0].belong.split(" ")[1];c.push(l)}else c.push("第".concat(i+1).concat(n.dateType))}),s.forEach(function(e,a){var i=y.a.sum(e.data),o=y.a.max(e.data),s=y.a.findIndex(e.data,function(t){return o===t}),c=n.entitysType[r[Math.floor(a/2)].itype];c=c||"购物中心",u.push({name:e.name.split("|")[0],type:c,time:e.name.split("|")[1],sum:"".concat(i.toLocaleString()," 人"),highest:"".concat(o.toLocaleString()||0,"人    ").concat(n.highestDateFormat(t[s]["date".concat(a%2+1)][Math.floor(a/2)].belong))})}),h.data=u,h.columns=l,{xAxis:{name:"时间",key:"time",data:c},series:s,detail:h}},formatDate:function(t){return this.isDurationOneDay?t.split(",")[0]:"".concat(t.split(",")[0]," - ").concat(t.split(",")[1])},getFootFallName:function(t){var e={enter:"入客流",exit:"出客流",occupancy:"集客量"};return e[t]},highestDateFormat:function(t){var e=t.split(" ");if(this.isDateCompare)return this.isDurationOneDay?"".concat(e[1]," - ").concat(e[1].replace(/0*$/,"59")):e[0];var a=e[1].split(",");return this.isDurationOneDay?"".concat(a[0].slice(0,5)," - ").concat(e[2].slice(0,5)):e[0]},initColumns:function(t){var e="入";"exit"===t&&(e="出"),"occupancy"===t&&(e="集");var a=[{title:"实体名称",key:"name"},{title:"实体类别",key:"type"},{title:"累计".concat(e,"客流量"),key:"sum"},{title:"".concat(e,"客").concat("occupancy"===t?"量":"流","峰值"),key:"highest",type:"html"}];return"occupancy"===t&&a.splice(2,1),a},createPointsData:function(t,e,a,n){var i=[];return this.isDurationOneDay?z()(e.split(",")[1]).isSame(z()(),"d")?t.forEach(function(t){i.push(z()(t.belong).isAfter(z()())?null:t[a])}):t.forEach(function(t){i.push(t[a])}):n?t.forEach(function(t,n){i.push(t[a]),z()(t.belong).isAfter(z()(e.split(",")[1]))&&(i[n]=null)}):t.forEach(function(t){i.push(t[a])}),i},compareDurations:function(t,e){var a=t.split(","),n=e.split(",");return z()(a[1]).diff(a[0],"days")<z()(n[1]).diff(n[0],"days")},getFrequencyData:function(){var t=this.computeChartData.filter(function(t){return"到店次数"===t.title}),e=[],a=[];if("not"==this.selectType)e=[{title:"类型",key:"id"},{title:"客流量",key:"enter"}],a=t[0].series.map(function(e,a){var n={};return n.id=t[0].labels.data[a],n.enter=t[0].series[a],n});else{var n="time"==this.selectType?"时间":"实体",i=t[0].series;e=[{title:n,key:"name"}],i.map(function(t){e.push({title:t.name,key:t.key})}),t[0].xAxis.data.map(function(t,e){var n={};n.name=t,i.map(function(t){n[t.key]=t.data[e]}),a.push(n)})}return this.frequencyTabList.push(e),this.frequencyTabList.push(a),this.frequencyTabList},enterTableChage:function(t){"客流量趋势"===t.type?this.enterTableList=t.data:"新老顾客占比"===t.type&&(this.clientTabList=t.data)},occupancyTableChage:function(t){this.occupancyTableList=t.data},enterExportBiztop:function(t){var e;e=t.footfallSelect?"客流量趋势":t.title;try{window.TDAPP.onEvent(this.$route.meta.pageTitle+"页面",e+"下载",{})}catch(a){console.log(this.$route.meta.pageTitle+"页面-"+e+"下载-埋点error:"+a)}"新老顾客占比"===t.title&&this.uploadList(this.clientTabList),"到店次数"===t.title&&this.uploadList(this.getFrequencyData()),t.footfallSelect&&this.uploadList(this.enterTableList)},occupancyExportBiztop:function(t){try{window.TDAPP.onEvent(this.$route.meta.pageTitle+"页面","集客量趋势下载",{})}catch(e){console.log(this.$route.meta.pageTitle+"页面-集客量趋势下载-埋点error:"+e)}this.uploadList(this.occupancyTableList)},uploadList:function(t){if("time"!=this.selectType){var e=this.range.split(",");e[0]==e[1]&&t[1].map(function(t){t.date=e[0]+"  "+t.date})}Object(p["b"])(t).then(function(t){var e=new Date,a=new Blob([t.data]),n="实体客流分析客流量趋势",i=n+z()(e).format("YYYYMMDDHHmmss")+".xls",r=document.createElement("a");r.download=i,r.style.display="none",r.href=URL.createObjectURL(a),document.body.appendChild(r),r.click(),URL.revokeObjectURL(r.href),document.body.removeChild(r)})},entityChartWidth:function(t){var e="100%";if(t.xAxis&&!t.footfallSelect){var a=t.xAxis.data.length;e=a<10?"100%":60*a}return e}}},S=L,q=(a("4977"),Object(T["a"])(S,n,i,!1,null,"f850475e",null));e["default"]=q.exports}}]);