(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fa59b712"],{"01c8":function(t,e,a){"use strict";a.d(e,"a",function(){return s});var n=a("178b"),i=a("3953"),r=a("1df6");function s(t){return Object(n["a"])(t)||Object(i["a"])(t)||Object(r["a"])()}},"08ac":function(t,e,a){},"1c2b":function(t,e,a){"use strict";var n=a("4efc"),i=a.n(n);i.a},"2d1f":function(t,e,a){t.exports=a("b606")},"36bd":function(t,e,a){"use strict";var n=a("4bf8"),i=a("77f1"),r=a("9def");t.exports=function(t){var e=n(this),a=r(e.length),s=arguments.length,o=i(s>1?arguments[1]:void 0,a),c=s>2?arguments[2]:void 0,l=void 0===c?a:i(c,a);while(l>o)e[o++]=t;return e}},"39a1":function(t,e,a){},"45d6":function(t,e,a){"use strict";a("c5f6");e["a"]={SaleAmount:{name:"销售额",icon:"dangrixiaoshoue",color:"#F64F61",unit:"（元）",yaxis:{title:{text:"销售额"},labels:{formatter:function(t){return null!==t?t.toLocaleString():""}}}},SquaerMetre:{name:"坪效",icon:"xingxiaoxiaoguo",color:"#1DD9D1",unit:"（元/平方米）",yaxis:{title:{text:"坪效（元/平方米）"},labels:{formatter:function(t){return null!==t?t.toLocaleString():""}}}},CloseRate:{name:"成交率",icon:"chengjiaohuafen",color:"#857AEF",yaxis:{title:{text:"成交率"},labels:{formatter:function(t){var e=Math.floor(100*Number(t))/100;if("number"===typeof e)return"".concat(e,"%")}}}},UnitPrice:{name:"客单价",icon:"jiage",color:"#33B3ED",unit:"（元）",yaxis:{title:{text:"客单价（元）"},labels:{formatter:function(t){return null!==t?t.toLocaleString():""}}}}}},"470b":function(t,e,a){"use strict";var n=a("39a1"),i=a.n(n);i.a},"4a88":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"bg-white p-4 text-left box-card card-box"},[a("span",{staticClass:"iconBox",style:{backgroundColor:""+t.iconBg}},[a("icons",{attrs:{type:t.item.type.icon,size:20,color:t.item.type.color}})],1),t.item.data.hasOwnProperty("name1")?a("span",{staticClass:"home-name"},[t._v(" "+t._s(t.item.name))]):t._e(),t.multiDate?t._e():a("p",{staticClass:"text-size text-black number-con"},[t.item.data.hasOwnProperty("number")?[a("span",{staticClass:"font-number font-bold"},[t._v(t._s(t._f("numberFormat")(t.item.data.number)))]),t._v(" \n      "),t.item.data.hasOwnProperty("timeRange")&&t.item.data.number?a("span",{staticClass:"font-number font-bold"},[t.isLiveData?a("span",{staticClass:"text-sm"},[t._v(t._s(t.item.data.timeRange.replace(/.{2}$/,"59"))+" ")]):a("span",{staticClass:"text-sm"},[t._v(t._s(t._f("dateformat")(t.item.data.timeRange,t.innerRange))+" ")]),a("p",{staticClass:"number-name"},[t._v(t._s(t.item.data.property))])]):t._e()]:[t.item.data.hasOwnProperty("name1")?t._e():a("span",{staticClass:"font-number font-bold"},[t._v(t._s(t._f("numberFormat")(t.item.data)))]),t.item.data.hasOwnProperty("name1")?a("p",{staticClass:"font-number multipleData"},[a("span",[t._v(t._s(t.item.data.name1)+":")]),t._v(t._s(t.item.data.data1)+"\n      ")]):t._e(),t.item.data.hasOwnProperty("name1")?a("p",{staticClass:"font-number multipleData"},[a("span",[t._v(t._s(t.item.data.name2)+":")]),t._v(t._s(t.item.data.data2)+"\n      ")]):t._e()]],2),t.item.data.hasOwnProperty("name1")?t._e():a("p",{staticClass:"text-base type-name"},[t._v(t._s(t.item.name))]),t.item.data.hasOwnProperty("ringRatio")?a("p",{staticClass:"numberrate text-grey-lighter"},[a("span",{staticClass:"mr-2"},[t._v("\n      同比\n      "),a("span",{class:{iconRotate:t.item.data.lastRatio>=0}},[a("icons",{attrs:{type:"xiala",color:"#F64F61"}})],1),a("span",{staticClass:"font-number font-bold text-base"},[t._v(t._s(t._f("numberFormat")(100*t.item.data.lastRatio))+"%")])]),a("span",[t._v("\n      环比\n      "),a("span",{class:{iconRotate:t.item.data.ringRatio>=0}},[a("icons",{attrs:{type:"xiala",color:"#F64F61"}})],1),a("span",{staticClass:"font-number font-bold text-base"},[t._v(t._s(t._f("numberFormat")(100*t.item.data.ringRatio))+"%")])])]):t._e(),t.multiDate?[a("div",{staticClass:"datecompare-box"},[a("p",{staticClass:"text-black font-bold"},[a("span",[t._v(t._s(t.item.time1))]),a("span",{staticClass:"text-2xl ml-6"},[t._v(t._s(t.item.data))])]),a("p",[a("span",[t._v(t._s(t.item.time2))]),a("span",{staticClass:"text-xl ml-8"},[a("icons",{style:{transform:parseInt(t.item.compareRate)>=0?"rotate(180deg)":"rotate(0deg)"},attrs:{type:"xiala",color:parseInt(t.item.compareRate)>=0?"#26B465":"#F64F61"}}),t._v("\n          "+t._s(t.item.compareRate)+"\n        ")],1)])])]:t._e()],2)},i=[],r=(a("28a5"),a("768b")),s=a("ab14"),o=a.n(s),c={name:"singleCard",props:{item:{type:null},isLiveData:{type:Boolean,default:!0},rangeName:{type:String,default:""},innerRange:{type:String,default:"1h"},isShowText:{type:Boolean,default:!1},multiDate:{type:Boolean,default:!1}},computed:{iconBg:function(){return o()(this.item.type.color,"0.2")}},filters:{dateformat:function(t,e){var a=t.split("-"),n=Object(r["a"])(a,6),i=n[0],s=n[1],o=n[2],c=n[5];return"".concat(i+"-"+s+"-"+o.slice(0),"-").concat(c.slice(3))}}},l=c,u=(a("6226"),a("fc23"),a("2877")),d=Object(u["a"])(l,n,i,!1,null,"53617613",null);e["a"]=d.exports},"4efc":function(t,e,a){},6226:function(t,e,a){"use strict";var n=a("d7f5"),i=a.n(n);i.a},"69fd":function(t,e,a){"use strict";a("28a5"),a("c5f6"),a("7f7f");var n=a("e814"),i=a.n(n),r=(a("6762"),a("2fdb"),a("a4bb")),s=a.n(r),o=a("795b"),c=a.n(o),l=a("3191"),u=a("45d6"),d=a("5fe9"),h=a.n(d);e["a"]={methods:{getSalesData:function(t){var e=t.time1,a=t.isCompare,n=void 0===a?1:a,r=t.time2,o=t.propertyId,d={time1:e,is_compare:n,time2:r,property_id:"company"===o?null:o};return new c.a(function(t,a){try{Object(l["l"])(d).then(function(a){var o=a.data.data;delete o.RepeatPurchaseRate;var c=s()(o).map(function(t){var a=["CloseRate","RepeatPurchaseRate"].includes(t)?"".concat(100*o[t].value,"%"):o[t].value;["SaleAmount","UnitPrice"].includes(t)&&(a=i()(a));var s={id:t,name:"".concat(u["a"][t].name).concat(u["a"][t].unit?u["a"][t].unit:""),type:{icon:u["a"][t].icon,color:u["a"][t].color||"#1dd9d1"}};if(o[t].hasOwnProperty("compareRate")){var c=h.a.times(Number(o[t].compareRate),100);s.compareRate="".concat(c,"%"),s.time1=e.split(",").join("-"),s.time2=r.split(",").join("-")}return s.data=n?{number:a,ringRatio:o[t].chainRatioRate,lastRatio:o[t].YearOnYearRate}:a,s});t(c)}).catch(function(t){a(t)})}catch(o){t(o)}})}}}},"6c7b":function(t,e,a){var n=a("5ca1");n(n.P,"Array",{fill:a("36bd")}),a("9c6c")("fill")},"9c60":function(t,e,a){var n=a("63b6"),i=a("13c8")(!0);n(n.S,"Object",{entries:function(t){return i(t)}})},ab14:function(t,e,a){"use strict";var n=function(t){return"#"===t.charAt(0)?t.slice(1):t},i=function(t){var e=3===t.length||4===t.length,a=e?""+t.slice(0,1)+t.slice(0,1):t.slice(0,2),n=e?""+t.slice(1,2)+t.slice(1,2):t.slice(2,4),i=e?""+t.slice(2,3)+t.slice(2,3):t.slice(4,6),r=(e?""+t.slice(3,4)+t.slice(3,4):t.slice(6,8))||"ff";return{r:a,g:n,b:i,a:r}},r=function(t){return parseInt(t,16)},s=function(t){var e=t.r,a=t.g,n=t.b,i=t.a;return{r:r(e),g:r(a),b:r(n),a:+(r(i)/255).toFixed(2)}},o=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},c=function(t,e){var a=t.r,n=t.g,i=t.b,r=t.a,s=o(e)?e:r;return"rgba("+a+", "+n+", "+i+", "+s+")"},l=function(t,e){var a=n(t),r=i(a),o=s(r);return c(o,e)};t.exports=l},b606:function(t,e,a){a("9c60"),t.exports=a("584a").Object.entries},be93:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"p-6 bg-white box-card",staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"ranking-selector-box flex items-center"},[a("span",{staticClass:"mr-3"},[t._v(t._s(t.selectTitle))]),a("vs-select",{attrs:{autocomplete:"",placeholder:"请选择",noDataText:"暂无数据"},model:{value:t.bussinessType,callback:function(e){t.bussinessType=e},expression:"bussinessType"}},t._l(t.withAllOptions,function(t){return a("vs-select-item",{key:t.value,attrs:{value:t.value,text:t.text}})}),1)],1),t.isText?a("div",{staticClass:"ranking-box mt-3"},[0!=t.bizChartData?a("div",[a("chart-tabs",{key:"bizTop",attrs:{xAxis:t.bizChartData.xAxis,series:t.bizChartData.series,type:t.chartTypes,extraOptions:t.bizExtraOptions,istotal:t.istotal,title:t.titleText.left},model:{value:t.exportType,callback:function(e){t.exportType=e},expression:"exportType"}},[t.indicatorSelector?a("vs-select",{staticClass:"chartSelector",attrs:{autocomplete:""},model:{value:t.bizIndicator,callback:function(e){t.bizIndicator=e},expression:"bizIndicator"}},t._l(t.indicators,function(t,e){return a("vs-select-item",{key:e,attrs:{text:t.name,value:t.value}})}),1):t._e(),a("export-menu",{attrs:{slot:"export"},on:{onchange:t.exportBiztop},slot:"export"})],1)],1):t._e(),0!=t.topShopData?a("div",[a("chart-tabs",{key:"shopTop",attrs:{xAxis:t.topShopData.xAxis,series:t.topShopData.series,type:t.chartTypes,extraOptions:t.extraOptions,title:t.titleText.right,isHome:!0,istotal:t.istotal},on:{getShopTableCoumn:t.getShopTableCoumn,getShopTableData:t.getShopTableData},model:{value:t.exportType,callback:function(e){t.exportType=e},expression:"exportType"}},[a("export-menu",{attrs:{slot:"export"},on:{onchange:t.exportShoptop},slot:"export"}),t.indicatorSelector?a("vs-select",{staticClass:"chartSelector",attrs:{autocomplete:""},model:{value:t.shopIndicator,callback:function(e){t.shopIndicator=e},expression:"shopIndicator"}},t._l(t.indicators,function(t,e){return a("vs-select-item",{key:e,attrs:{text:t.name,value:t.value}})}),1):t._e()],1)],1):t._e()]):t._e()])},i=[],r=a("2d1f"),s=a.n(r),o=(a("55dd"),a("768b")),c=a("795b"),l=a.n(c),u=(a("5df3"),a("6b54"),a("96cf"),a("3b8d")),d=a("cebc"),h=a("a745"),p=a.n(h),f=(a("28a5"),a("db0c")),m=a.n(f),b=(a("20d6"),a("7f7f"),a("75fc")),y=a("a4bb"),v=a.n(y),x=(a("7514"),a("ac6a"),a("c5f6"),a("869a")),g=a("2f62"),D=a("3191"),_=a("45d6"),w=a("9777"),C=a("c1df"),O=a.n(C),T=a("2ef0"),S=a.n(T),L={name:"rankingAnalytics",components:{chartTabs:x["a"],exportMenu:w["a"]},props:{time1:{type:String,default:null},time2:{type:String,default:null},propertyId:{type:[String,Number],default:null},footfallIndicators:{type:Object,default:function(){return{}}},indicatorData:{type:Object,default:function(){return _["a"]}},selectTitle:{type:String,default:"排行分析"},defaultBizIndicator:{type:String,default:"SaleAmount"},defaultShopIndicator:{type:String,default:"SaleAmount"},indicatorSelector:{type:Boolean,default:!0},bzid:{type:Array,default:null},drainageId:{type:Number,default:null},isDrainage:{type:Boolean,default:!1},typeName:{type:String,default:""},drainageApi:{type:Object,default:function(){return{}}},istotal:{type:Boolean,default:!1}},data:function(){return{isText:!0,bussinessDictList:[],showData:!1,exportEx:1,bussinessType:"all",readySelector:null,bizIndicator:"",shopIndicator:"",bizTopData:"",shopTopData:[],allBizTopData:[],chartTypes:["bar"],extraOptions:{plotOptions:{bar:{horizontal:!0}},colors:["#867bf0","#fbab3e"]},exportType:"",ShopTableCoumn:"",ShopTableData:""}},watch:{time1:{immediate:!0,handler:function(t,e){this.getTopData()}},time2:{immediate:!0,handler:function(t,e){this.getTopData()}},propertyId:{immediate:!0,handler:function(t,e){this.getTopData()}},bussinessType:{handler:function(t,e){var a=this;if(this.getTopData(),this.bussinessType=t,S.a.isArray(t)&&t.forEach(function(t){a.withAllOptions.forEach(function(e){t===e.value&&(a.bussinessType=t)})}),window.location.href.indexOf("dashboard/analytics")>-1)try{var n=S.a.find(this.withAllOptions,["value",t]),i=n&&n.text?n.text:"",r=0===this.$store.state.home.headerAction?"集团页面":"购物中心首页";window.TDAPP.onEvent(r,"业态排行业态选择",{"业态":i})}catch(s){console.log(eventName+"-业态排行业态选择-埋点error:"+s)}}},bzid:{handler:function(t,e){t&&this.getTopData()}},bizIndicator:function(){this.businessDataList()},shopIndicator:function(){this.shopAndStoreDataList()},"$store.state.home.headerAction":function(){this.getDict()},"$store.state.home.isGetDict":function(){1==this.$store.state.home.isGetDict&&this.getDict()}},created:function(){this.readySelector=this.getDictOfBussiness()},activated:function(){var t=this;this.isText=!1,setTimeout(function(){t.isText=!0})},mounted:function(){this.bizIndicator=this.defaultBizIndicator,this.shopIndicator=this.defaultShopIndicator,this.getDict()},computed:{titleText:function(){var t={left:"",right:""};return 0==this.$store.state.home.headerAction?(t.left="集团业态排行",t.right="购物中心业态排行"):(t.left="业态排行",t.right="商铺排行"),t},bussinessTypes:function(){var t=this;return v()(this.bussinessDictList).map(function(e){return{text:t.bussinessDictList[e],value:Number(e)}})},withAllOptions:function(){var t={text:"所有业态",value:"all"};return[t].concat(Object(b["a"])(this.bussinessTypes))},indicators:function(){var t=this;return v()(this.indicatorData).map(function(e){return{value:e,name:t.indicatorData[e].name}})},currentBizIdx:function(){var t=this;return S.a.findIndex(this.bussinessTypes,function(e){return e.value===t.bussinessType})},bizChartData:function(){var t=this;if(""==this.bizTopData)return!1;var e=this.bizTopData.data.data;if(0==e.length)return!1;var a=this.currentBizIdx,n={};a<0?n=e:v()(e).forEach(function(a){n[a]={},n[a][t.bussinessType]=S.a.find(e[a],function(e){if(-1!==S.a.indexOf(e.id,t.bussinessType))return e})});var i=this;return{xAxis:{name:"名称",key:"bussiness",data:m()(m()(n)[0]).map(function(t){return t.name})},series:v()(n).map(function(t,e){if(e<10){var a={name:"".concat(i.indicatorData[i.bizIndicator].name," ").concat(t.split(",").join(" - ")),key:"data_".concat(t),data:m()(n[t]).map(function(t){return t.data})};return a}}),source:m()(m()(n)[0]).map(function(t){return t.id})}},topShopData:function(){var t,e=this,a=this.currentBizIdx;if(a<0){if(0==this.allBizTopData.length)return!1;t=this.allBizTopData[0].data.data}else{if(0==this.shopTopData.length)return!1;if(!this.shopTopData[0])return!1;t=this.shopTopData[0].data.data}var n=p()(m()(t)[0])?t:this.sortdObj(t),i=v()(n)[0],r=n[i],s=[];return void 0!=r&&(r.forEach(function(t,e){e<10&&s.push(t)}),{xAxis:{name:"名称",key:"shop",data:m()(n)[0].map(function(t){return S.a.isArray(t.name)?t.name[0]:t.name})},series:v()(n).map(function(t){return{name:"".concat(e.indicatorData[e.shopIndicator].name," ").concat(t.split(",").join(" - ")),key:"data_".concat(t),data:m()(n[t]).map(function(t){return t.data})}})})},bizExtraOptions:function(){var t=this,e={chart:{events:{dataPointSelection:function(e,a,n){t.handleChartPointSelect(n)}}},colors:["#00a1ea","#16dad2"]};return Object(d["a"])({},S.a.cloneDeep(this.extraOptions),S.a.cloneDeep(e))}},methods:Object(d["a"])({},Object(g["b"])(["getDictOfBussiness"]),{getTopData:S.a.debounce(Object(u["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.readySelector;case 2:this.businessDataList(),this.shopAndStoreDataList();case 4:case"end":return t.stop()}},t,this)})),100),businessDataList:function(){var t=this,e=[],a={time1:this.time1,type:this.bizIndicator,bzid:this.bzid&&this.bzid.toString()};this.time2&&(a.time2=this.time2);var n=this.$store.state.home.headerAction;0!=n?a.property_id=n:a.company_id=this.$store.state.user.companyId,e="enter"==this.bizIndicator?Object(D["f"])(a):Object(D["p"])(a),e.then(function(e){t.bizTopData=e})},getShopTableCoumn:function(t){this.ShopTableCoumn=t},getShopTableData:function(t){this.ShopTableData=t},shopAndStoreDataList:function(){var t=this,e=[],a=[],n=this.$store.state.home.headerAction,i=S.a.find(this.bussinessTypes,function(e){return e.value==t.bussinessType});if(i){var r={time1:this.time1,type:this.shopIndicator,industry_id:i.value,bzid:this.bzid&&this.bzid.toString()};0!=n?r.property_id=n:r.company_id=this.$store.state.user.companyId,this.time2&&(r.time2=this.time2);var s="enter"==this.shopIndicator?Object(D["o"])(r):Object(D["q"])(r);e.push(s)}var c={time1:this.time1,type:this.shopIndicator,bzid:this.bzid&&this.bzid.toString()};0!=n?c.property_id=n:c.company_id=this.$store.state.user.companyId,this.time2&&(c.time2=this.time2);var u="enter"==this.shopIndicator?Object(D["o"])(c):Object(D["q"])(c);a.push(u),l.a.all([a,e].map(function(t){return l.a.all(t)})).then(function(e){var a=Object(o["a"])(e,2);t.allBizTopData=a[0],t.shopTopData=a[1]}).catch(function(t){console.log(t)})},handleChartPointSelect:function(t){this.bussinessType=this.bizChartData.source[t.dataPointIndex]},sortdObj:function(t){if(0==t.length)return!1;var e=S.a.cloneDeep(m()(t)),a=e.reduce(function(t,e){return v()(t).forEach(function(a){t[a]=Number(t[a])+Number(e[a])}),t}),n=s()(a).sort(function(t,e){return e[1]-t[1]}),i={};return v()(S.a.cloneDeep(t)).forEach(function(e){var a=t[e];i[e]=n.map(function(t){var e=Object(o["a"])(t,2),n=e[0];e[1];return{name:[n],data:a[n]}})}),i},dowloadXlsx:function(t){var e=new Date,a=new Blob([t.data]),n=this.$router.currentRoute.name,i="";"drainage"==n?i="实体引流分析":"pathTrend"==n?i="路径动向分析":"sales"==n&&(i="销售分析");var r="";r=1==this.exportEx?"业态排行":"商铺排行";var s=i+r+O()(e).format("YYYYMMDDHHmmss")+".xls",o=document.createElement("a");o.download=s,o.style.display="none",o.href=URL.createObjectURL(a),document.body.appendChild(o),o.click(),URL.revokeObjectURL(o.href),document.body.removeChild(o)},exportBiztop:function(t){var e=this;"current"===t&&("drainage"==this.typeName?Object(D["d"])(this.drainageApi).then(function(t){e.exportEx=1,e.dowloadXlsx(t)}):Object(D["a"])({time1:this.time1,time2:this.time2,property_id:this.propertyId,type:this.bizIndicator,bzid:this.bzid&&this.bzid.toString()}).then(function(t){if(window.location.href.indexOf("dashboard/analytics")>-1){var a=0===e.$store.state.home.headerAction?"集团页面":"购物中心首页";try{window.TDAPP.onEvent(a,"业态排行下载",{})}catch(n){console.log(a+"-业态排行下载-埋点error:"+n)}}e.exportEx=1,e.dowloadXlsx(t)}))},exportShoptop:function(t){var e=this;if("current"===t)if("drainage"==this.typeName)Object(D["e"])(this.drainageApi).then(function(t){e.exportEx=2,e.dowloadXlsx(t)});else if(window.location.href.indexOf("dashboard/analytics")>-1)if(0===this.$store.state.home.headerAction){var a=[this.ShopTableCoumn,this.ShopTableData];if(0==this.ShopTableData.length)return alert("暂无数据可下载"),!1;Object(D["b"])(a).then(function(t){var e=new Date,a=new Blob([t.data]),n="购物中心排行下载",i=n+O()(e).format("YYYYMMDDHHmmss")+".xls",r=document.createElement("a");r.download=i,r.style.display="none",r.href=URL.createObjectURL(a),document.body.appendChild(r),r.click(),URL.revokeObjectURL(r.href),document.body.removeChild(r)});try{window.TDAPP.onEvent("集团页面","购物中心排行下载",{})}catch(n){console.log(eventName+"集团页面-购物中心排行下载-埋点error:"+n)}}else Object(D["c"])({time1:this.time1,time2:this.time2,property_id:this.propertyId,type:this.shopIndicator,bzid:this.bzid&&this.bzid.toString(),industry_id:"all"===this.bussinessType?null:this.bussinessType}).then(function(t){try{window.TDAPP.onEvent("购物中心首页","商铺排行下载",{})}catch(n){console.log(eventName+"购物中心首页-商铺排行下载-埋点error:"+n)}e.exportEx=2,e.dowloadXlsx(t)})},getDict:function(){var t=this,e=this.$store.state.home.headerAction;e=0==e?"":e,Object(D["g"])({property_id:e}).then(function(e){t.bussinessDictList=e.data.data,t.$store.commit("isGetDict",!1),t.getTopData()}).catch(function(t){console.log(t)})}})},I=L,A=(a("1c2b"),a("2877")),R=Object(A["a"])(I,n,i,!1,null,"ab3df9f8",null);e["a"]=R.exports},c20c:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.canshow?a("div",[a("chart-tabs",{ref:"charts",staticClass:"bg-white box-card",attrs:{xAxis:t.xAxisObj,series:t.finnalSeries,extraOptions:t.extraOptWithYaxis,istotal:t.istotal,id:"trendLine",title:"购物中心趋势分析"},on:{tableChage:t.TableChageList}},[a("export-menu",{attrs:{slot:"export"},on:{onchange:t.enterExportBiztop},slot:"export"}),[a("div",{staticClass:"flex justify-between items-center mr-10"},[a("span",{staticClass:"whitespace-no-wrap mx-4 text-sm"},[t._v("数据指标:")]),a("vs-select",{attrs:{autocomplete:"",multiple:t.canSelectMulti,"max-selected":2,id:"chartSelect"},model:{value:t.curretIndicator,callback:function(e){t.curretIndicator=e},expression:"curretIndicator"}},t._l(t.filteredSelectList,function(t,e){return a("vs-select-item",{key:e,attrs:{text:t.name,value:t.value}})}),1)],1)]],2)],1):t._e()},i=[],r=(a("6c7b"),a("774e")),s=a.n(r),o=(a("c5f6"),a("795b")),c=a.n(o),l=(a("5df3"),a("db0c")),u=a.n(l),d=a("01c8"),h=a("cebc"),p=(a("4917"),a("6762"),a("2fdb"),a("28a5"),a("75fc")),f=(a("ac6a"),a("a4bb")),m=a.n(f),b=(a("7514"),a("7f7f"),a("5d73")),y=a.n(b),v=a("869a"),x=a("c66f"),g=a("2ef0"),D=a.n(g),_=a("3191"),w=a("ad00"),C=a("45d6"),O=a("5fe9"),T=a.n(O),S=a("9777"),L=a("c1df"),I=a.n(L),A={name:"Trend",props:{innerRange:{type:String,default:"1h"},propertyId:{type:null,default:null},bzids:{type:Array,default:function(){return[]}},time1:{type:String,default:""},time2:{type:String,default:""},indicatorData:{type:Object,default:function(){return C["a"]}},istotal:{type:Boolean,default:!1}},components:{chartTabs:v["a"],indicatorSelector:x["a"],exportMenu:S["a"]},data:function(){return{current:0,curretIndicator:["enter"],chartData:{},extraOpt:{yaxis:[]},canshow:!1,isNeedRender:!0,tableListData:[]}},watch:{time1:{immediate:!0,handler:function(t,e){this.getTrendData()}},time2:{immediate:!0,handler:function(t,e){this.getTrendData()}},propertyId:{immediate:!0,handler:function(t,e){t&&this.getTrendData()}},curretIndicator:function(t,e){0==this.curretIndicator.length&&(this.curretIndicator=["enter"]);try{var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=y()(t);!(n=(s=o.next()).done);n=!0){var c=s.value;a.push(D.a.find(this.filteredSelectList,["value",c]).name)}}catch(l){i=!0,r=l}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}window.TDAPP.onEvent("购物中心首页","趋势分析数据指标选择",{"指标":a})}catch(u){console.log("购物中心首页-趋势分析数据指标选择-埋点error:"+u)}this.refreshChart()}},activated:function(){var t=this;this.canshow=!1,setTimeout(function(){t.canshow=!0})},computed:{convertInnerRange:function(){return"1h"===this.innerRange?"Hour":"1day"===this.innerRange?"Date":"1month"===this.innerRange?"Month":void 0},filteredSelectList:function(){var t=this,e=m()(this.indicatorData).map(function(e){return{value:e,name:t.indicatorData[e].name}});return"1h"===this.innerRange?e:(this.curretIndicator=D.a.remove(this.curretIndicator,function(t){return"occupancy"!=t}),e.filter(function(t){return"occupancy"!==t.value}))},filterSeries:function(){var t=this,e=[];return m()(this.chartData).length&&(this.canSelectMulti?(this.time2="",this.curretIndicator.forEach(function(a){e.push.apply(e,Object(p["a"])(t.chartData[a].series))})):e.push.apply(e,Object(p["a"])(this.chartData[this.curretIndicator].series))),e},xAxisObj:function(){return 0===this.curretIndicator.length?{name:"时间",data:[],key:"time"}:this.chartData[this.curretIndicator[0]]?{name:"时间",data:this.isChangeCategories?this.time2?["第一天"]:[this.time1.split(",")[0]]:this.chartData[this.curretIndicator[0]].xAxis,key:"time"}:this.chartData[this.curretIndicator]?{name:"时间",data:this.isChangeCategories?this.time2?["第一天"]:[this.time1.split(",")[0]]:this.chartData[this.curretIndicator].xAxis,key:"time"}:void 0},isChangeCategories:function(){var t,e=this.filterSeries;return t=this.canSelectMulti?this.curretIndicator.filter(function(t){return["enter","occupancy"].includes(t)}):this.curretIndicator,e.length>=2&&"1h"===this.innerRange&&1===t.length},allSeriesKeys:function(){return this.filterSeries.map(function(t){return t.key.match(/[A-Za-z]+/)[0]})},extraOptWithYaxis:function(){return this.yaxisArr.length?Object(h["a"])({},this.extraOpt,{yaxis:this.yaxisArr[0]}):(delete this.extraOpt.yaxis,this.extraOpt)},yaxisArr:function(){var t=this,e=this.allSeriesKeys.map(function(e,a){var n=D.a.cloneDeep(t.indicatorData[e].yaxis);return n.seriesName=e,n.title.style={fontSize:"13px"},n.min=0,n.labels={formatter:function(t){return"number"===typeof t?t?D.a.round(t,0).toLocaleString():"":t}},n}),a=D.a.groupBy(e,"seriesName");return m()(a).forEach(function(t){var e=a[t],n=Object(d["a"])(e),i=n.slice(1);i.forEach(function(t){t.show=!1})}),m()(a).length>1&&(u()(a)[1][0].opposite=!0),e},finnalSeries:function(){var t=D.a.cloneDeep(this.filterSeries);return this.isChangeCategories&&t.forEach(function(t){["occupancy","enter"].some(function(e){return t.key.includes(e)})&&(t.data=[D.a.sum(t.data)])}),t},canSelectMulti:function(){return!this.time2}},methods:{getTrendData:D.a.debounce(function(t){var e=this,a=this.time1,n=this.time2,i=this.propertyId,r=this.indicatorData,o=this.bzids,l=m()(r).map(function(t){var r={time1:a,time2:n,type:t,property_id:i,range:e.convertInnerRange,bzid:o};return["enter","occupancy"].includes(t)?Object(w["d"])(r):("Hour"===e.convertInnerRange&&(r.range="Date"),Object(_["m"])(r))});c.a.all(l).then(function(t){var a={};m()(r).forEach(function(i,o){var c=t[o].data.data,l=m()(c).map(function(t){var e=c[t],a=u()(e);return a=a.map(function(t){return Number(t)<0?0:t}),["CloseRate","RepeatPurchaseRate"].includes(i)&&(a=a.map(function(t){return T.a.times(t,100)})),{name:n?"".concat(r[i].name," ").concat(t.split(",").join(" - ")):r[i].name,key:"".concat(i,"_").concat(t),data:a}}),d=[];if(n&&"1h"!==e.innerRange){var h=l[0].data.length,f=l[1].data.length,b=Math.max(h,f);d=s()({length:b},function(t,a){return"第".concat(a+1).concat("1day"===e.innerRange?"天":"月")}),l.forEach(function(t){if(t.data.length<b){var e=new Array(b-t.data.length);e.fill(null),t.data=[].concat(Object(p["a"])(t.data),e)}}),a[i]={series:l,xAxis:d}}else{var y=c[m()(c)[0]];if(y){var v=m()(y);v[0]&&(d=v[0].split(" ").length>1?v.map(function(t){var e=t.split(" ");return e[1].slice(0,5)}):v)}n&&"1h"===e.innerRange&&"enter"===i&&(l.map(function(t){t.data=[D.a.sum(t.data)]}),d=["第一天"]),a[i]={series:l,xAxis:d}}}),e.chartData=a,e.canshow=!0}).catch(function(t){console.log(t)})},100),refreshChart:function(){var t=this;if(this.$refs.charts&&this.$refs.charts.$children.length){var e=this.$refs.charts.$children[0].$children,a=e.filter(function(t){return"TabItem"===t.$options.name&&"biaoge-copy"!==t.$attrs.icon});a.forEach(function(e){return t.$nextTick(function(){e.$children[0].refresh()})})}},TableChageList:function(t){this.tableListData=t.data},enterExportBiztop:function(){try{window.TDAPP.onEvent("购物中心首页","趋势分析数据指标下载",{})}catch(a){console.log("购物中心首页-趋势分析数据指标下载-埋点error:"+a)}var t=this.time1.split(","),e=D.a.cloneDeep(this.tableListData);t[0]==t[1]&&e[1].map(function(e){e.time=t[0]+"  "+e.time}),Object(_["b"])(e).then(function(t){var e=new Date,a=new Blob([t.data]),n="购物中心趋势分析",i=n+I()(e).format("YYYYMMDDHHmmss")+".xls",r=document.createElement("a");r.download=i,r.style.display="none",r.href=URL.createObjectURL(a),document.body.appendChild(r),r.click(),URL.revokeObjectURL(r.href),document.body.removeChild(r)})}}},R=A,j=a("2877"),z=Object(j["a"])(R,n,i,!1,null,null,null);e["a"]=z.exports},c66f:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"flex justify-between items-center mr-10"},[a("span",{staticClass:"whitespace-no-wrap mx-4 text-sm"},[t._v("数据指标:")]),a("vs-select",{key:"chartSelector",staticClass:"chartSelector",attrs:{autocomplete:"",multiple:t.multiple,"max-selected":2},model:{value:t.typeArr,callback:function(e){t.typeArr=e},expression:"typeArr"}},t._l(t.selectList,function(t,e){return a("vs-select-item",{key:e,attrs:{text:t.name,value:t.value}})}),1)],1)},i=[],r=a("32d8"),s=a.n(r),o=a("a745"),c=a.n(o),l=(a("c5f6"),{name:"indicatorSelectort",props:{selectList:{type:Array,default:function(){return[{value:"enter",name:"入客流"},{value:"exit",name:"出客流"},{value:"areaEffect",name:"坪效"},{value:"buyRate",name:"成交率"},{value:"rebuyRate",name:"复购率"}]}},multiple:{type:Boolean,default:!0},defaultValue:{type:String,default:"enter"},maxSelected:{type:Number,default:2}},created:function(){this.defaultValue&&(this.typeArr=[this.defaultValue])},data:function(){return{typeArr:["enter"]}},watch:{typeArr:function(t,e){c()(t)||(t=s()(t)),this.$emit("input",t)},multiple:function(t){this.typeArr=t?[this.defaultValue]:this.defaultValue}}}),u=l,d=(a("470b"),a("2877")),h=Object(d["a"])(u,n,i,!1,null,null,null);e["a"]=h.exports},d162:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"bottomcard"},[t.operate?a("div",{staticClass:"flex justify-between items-center"},[a("div",[t._t("title")],2),a("div",{staticClass:"flex"},[t._t("dateSelector"),a("Dropdown",{attrs:{transfer:""},on:{"on-click":t.handleAddcards}},[a("icons",{attrs:{type:"htmal5icon18",size:24,color:t.addList.length?"#2BD9CF":"#ccc"}}),a("DropdownMenu",{directives:[{name:"show",rawName:"v-show",value:t.addList.length,expression:"addList.length"}],attrs:{slot:"list"},slot:"list"},t._l(t.addList,function(e,n){return a("DropdownItem",{key:n,attrs:{name:e.id}},[t._v(t._s(e.name))])}),1)],1),a("Dropdown",{attrs:{transfer:""},on:{"on-click":t.handleDelcards}},[a("icons",{staticClass:"mr-1",attrs:{type:"shanchu-tianchong",size:24,color:t.delList.length?"#FEB33D":"#ccc"}}),a("DropdownMenu",{directives:[{name:"show",rawName:"v-show",value:t.delList.length,expression:"delList.length"}],attrs:{slot:"list"},slot:"list"},t._l(t.delList,function(e,n){return a("DropdownItem",{key:n,attrs:{name:e.id}},[t._v(t._s(e.name))])}),1)],1)],2)]):t._e(),a("div",{ref:"infocard",staticClass:"infocard"},[a("span",{directives:[{name:"show",rawName:"v-show",value:t.indicatorList.length>t.defaultCountsOfCards,expression:"indicatorList.length > defaultCountsOfCards"}],on:{click:t.scrollRight}},[a("icons",{attrs:{type:"left"}})],1),a("div",{ref:"scrollBody",staticClass:"scrollBody",style:{transform:"translateX("+t.bodyScroll+"px)",gridTemplateColumns:"repeat("+t.cardsList.length+",minmax(calc((100% - 20 * "+(t.defaultCountsOfCards-1)+"px) / "+t.defaultCountsOfCards+"),1fr))"}},t._l(t.cardsList,function(e,n){return a("div",{key:n,class:{scaleCard:t.scaleCards}},[t._t("default",null,{item:e})],2)})),a("span",{directives:[{name:"show",rawName:"v-show",value:t.indicatorList.length>t.defaultCountsOfCards,expression:"indicatorList.length > defaultCountsOfCards"}],on:{click:t.scrollLeft}},[a("icons",{attrs:{type:"right"}})],1)])])},i=[],r=(a("28a5"),a("e814")),s=a.n(r),o=(a("7514"),a("7f7f"),a("ac6a"),a("c5f6"),a("2f62"),a("f26a"),a("3191")),c=a("2ef0"),l=a.n(c),u={name:"indicatorCards",props:{textName:{type:String,default:""},indicatorList:{type:Array,default:function(){return[]}},propertyId:{type:null},indicatorType:{type:String,default:"realTimeIndicator"},defaultCountsOfCards:{type:Number,default:3},operate:{type:Boolean,default:!0},scaleCards:{type:Boolean,default:!1}},data:function(){return{bodyScroll:0,throttle:0,addList:[],delList:[]}},computed:{cardsTypes:function(){return this.$store.state.home[this.indicatorType][this.propertyName]},propertyName:function(){return null===this.propertyId?"company":this.propertyId},cardOffsetWidth:function(){return this.$refs.scrollBody.firstChild.getBoundingClientRect().width+16},cardsList:function(){return this.isSaveLocale?this.delList:this.indicatorList},isSaveLocale:function(){return this.operate}},watch:{indicatorList:{handler:function(t,e){this.typeList()},deep:!0}},mounted:function(){this.typeList()},methods:{handleDelcards:function(t){var e=[];if(this.delList.forEach(function(a){a.id!=t&&e.push(a.name)}),0==e.length)return alert("最少保留一个"),!1;this.listdata(e),this.scrollRight();try{var a="";if(a="shop-center-histrry"==this.textName?"购物中心首页":"集团页面",a){var n=l.a.find(this.cardsList,["id",t]);n=n&&n.name?n.name:"",window.TDAPP.onEvent(a,"历史数据删除指标",{"指标":n})}}catch(i){console.log(eventName+"-历史数据删除指标-埋点error:"+i)}},handleAddcards:function(t){var e=[];this.delList.forEach(function(t){e.push(t.name)});var a=l.a.find(this.addList,function(e){return e.id==t}).name;e.push(a),this.listdata(e),this.delList.length>this.defaultCountsOfCards&&this.scrollLeft();try{var n="";if(n="shop-center-histrry"==this.textName?"购物中心首页":"集团页面",n){var i=0===this.$store.state.home.headerAction?"集团页面":"购物中心首页",r=l.a.find(this.addList,["id",t]);r=r&&r.name?r.name:"",window.TDAPP.onEvent(i,"历史数据增加指标",{"指标":r})}}catch(s){console.log(eventName+"-历史数据增加指标-埋点error:"+s)}},listdata:function(t){var e=this,a={property_current:"",property_history:"",company_current:"",company_history:""};switch(this.textName){case"shop-center-current":a.property_current=t;break;case"shop-center-histrry":a.property_history=t;break;case"group-current":a.company_current=t;break;case"group-histrry":a.company_history=t;break}Object(o["y"])(a).then(function(t){e.typeList()})},scrollLeft:function(){var t=this;this.$nextTick(function(){t.handleScroll(-t.cardOffsetWidth)})},scrollRight:function(){var t=this;this.$nextTick(function(){t.handleScroll(t.cardOffsetWidth)})},showArrow:function(){var t=this;this.$nextTick(function(){t.$refs.scrollBody.childNodes.length,t.$refs.scrollBody.firstChild.getBoundingClientRect().width,t.$refs.infocard.getBoundingClientRect().width;t.isShowRightArrow=!0})},handleScroll:function(t){var e=this.cardOffsetWidth,a=this.$refs.infocard.offsetWidth,n=this.$refs.scrollBody.childNodes.length*e,i=n-a-16*(this.defaultCountsOfCards-1);t>0?this.bodyScroll=Math.min(this.bodyScroll+t,0):Math.abs(s()(this.bodyScroll))<s()(i)&&(this.bodyScroll+=t)},typeList:function(){var t=this;Object(o["A"])().then(function(e){if(200==e.data.code){t.delList=[],t.addList=[];var a=e.data.data;switch(t.textName){case"shop-center-current":t.listClassify(a.property[0].current);break;case"shop-center-histrry":t.listClassify(a.property[0].history);break;case"group-current":t.listClassify(a.company[0].current);break;case"group-histrry":t.listClassify(a.company[0].history);break}}})},listClassify:function(t){var e=this,a=l.a.split(t,",");this.indicatorList.forEach(function(t){a.indexOf(t.name)>-1?e.delList.push(t):e.addList.push(t)})}}},d=u,h=a("2877"),p=Object(h["a"])(d,n,i,!1,null,null,null);e["a"]=p.exports},d7f5:function(t,e,a){},f26a:function(t,e,a){},fc23:function(t,e,a){"use strict";var n=a("08ac"),i=a.n(n);i.a}}]);