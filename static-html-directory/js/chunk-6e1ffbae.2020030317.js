(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6e1ffbae"],{"12c9":function(t,e,i){"use strict";var r=i("3b36"),a=i.n(r);a.a},"3b36":function(t,e,i){},"905b":function(t,e,i){"use strict";var r=i("d826"),a=i.n(r);a.a},a21f:function(t,e,i){var r=i("584a"),a=r.JSON||(r.JSON={stringify:JSON.stringify});t.exports=function(t){return a.stringify.apply(a,arguments)}},aed0:function(t,e,i){},bb6b:function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"account-center"},[i("div",{staticClass:"flex mb-4 account-text"},[i("div",{staticClass:"w-full bg-grid-color-secondary"},[i("div",{staticClass:"account-text-right"},[i("div",{staticClass:"account-seach"},[i("div",{staticClass:"data-picker"},[i("div",{staticClass:"account-seach-text"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],attrs:{type:"text",placeholder:"请输入用户名"},domProps:{value:t.searchText},on:{input:function(e){e.target.composing||(t.searchText=e.target.value)}}})]),i("div",{staticClass:"account-seach-text",staticStyle:{"margin-left":"10px"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.searchRole,expression:"searchRole"}],attrs:{type:"text",placeholder:"请输入角色"},domProps:{value:t.searchRole},on:{input:function(e){e.target.composing||(t.searchRole=e.target.value)}}})]),i("div",{staticClass:"account-add-remove"},[i("span",{staticClass:"account-add",attrs:{title:"添加"},on:{click:t.addData}},[i("Icon",{attrs:{type:"md-add"}})],1),i("span",{attrs:{title:"删除"},on:{click:t.allRemoveData}},[i("Icon",{attrs:{type:"md-remove"}})],1)])])]),i("div",{staticClass:"account-table"},[i("table-multiple-selected",{attrs:{tableName:t.tableName,tableList:t.filterUser,titleName:t.titleName,isMultiple:!0},on:{tableData:t.tableData,removeData:t.removeData,tableSelect:t.tableSelect}})],1)])])]),t.isEdit?i("account-edit",{attrs:{editData:t.dataList,roleList:t.roleList,organization:t.organization},on:{closeEdit:t.closeEdit,editData:t.editData}}):t._e(),t.isAlert?i("alert",{attrs:{alertText:t.alertText},on:{closeAlert:t.closeAlert,alertConfirm:t.alertConfirm}}):t._e()],1)},a=[],s=(i("7514"),i("c5f6"),i("28a5"),i("ac6a"),i("7f7f"),i("6762"),i("2fdb"),i("693f")),o=i("2dc0"),l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"account-edit"},[i("div",{staticClass:"account-edit-bg",on:{click:t.closeEdit}}),i("div",{staticClass:"account-edit-text"},[i("div",{staticClass:"edit-title"},[t._v("\n            "+t._s(t.editTitle)+"\n        ")]),i("div",{staticClass:"edit-close",on:{click:t.closeEdit}},[i("Icon",{attrs:{type:"md-close"}})],1),i("div",{staticClass:"edit-text"},[i("div",{staticClass:"edit-left"},[i("div",{staticClass:"imgDiv"},[i("img",{staticClass:"uploadImg",attrs:{src:t.uploadImg}})]),i("uploadImg",{on:{changeImg:t.changeImg}})],1),i("div",{staticClass:"model-right"},[i("div",{staticClass:"edit-right-title"},[t._v("详细信息")]),i("Form",{ref:"formInline",attrs:{model:t.userForm,rules:t.ruleInline,inline:""}},[i("div",{staticClass:"flex"},[i("div",{staticClass:"half"},[i("FormItem",{attrs:{prop:"username",label:"用户名"}},[i("Input",{attrs:{disabled:t.modify,maxlength:45,placeholder:"请输入用户名"},model:{value:t.userForm.username,callback:function(e){t.$set(t.userForm,"username",e)},expression:"userForm.username"}})],1)],1),i("div",{staticClass:"half"},[i("FormItem",{attrs:{prop:"realname",label:"姓名"}},[i("Input",{attrs:{maxlength:128,placeholder:"请输入用户姓名"},model:{value:t.userForm.realname,callback:function(e){t.$set(t.userForm,"realname",e)},expression:"userForm.realname"}})],1)],1),i("input",{staticStyle:{width:"20px",height:"20px",opacity:"0"},attrs:{type:"text"}}),i("input",{staticStyle:{width:"20px",height:"20px",opacity:"0"},attrs:{type:"password"}})]),i("div",{staticClass:"flex password"},[i("div",{staticClass:"half"},[i("FormItem",{attrs:{prop:"password",label:"密码"}},[i("Input",{attrs:{type:t.psType,placeholder:""},on:{"on-focus":t.passwordType},model:{value:t.userForm.password,callback:function(e){t.$set(t.userForm,"password",e)},expression:"userForm.password"}})],1)],1),i("div",{staticClass:"half"},[i("FormItem",{attrs:{prop:"password2",label:"确认密码"}},[i("Input",{attrs:{type:t.psType,placeholder:""},on:{"on-focus":t.passwordType},model:{value:t.userForm.password2,callback:function(e){t.$set(t.userForm,"password2",e)},expression:"userForm.password2"}})],1)],1)]),i("div",{staticClass:"flex"},[i("div",{staticClass:"flex left"},[t.showRolePermission?i("div",{staticClass:"more"},[i("FormItem",{attrs:{prop:"role",label:"角色"}},[i("Select",{attrs:{disabled:t.disabledRole},on:{"on-change":t.changeRole},model:{value:t.userForm.role,callback:function(e){t.$set(t.userForm,"role",e)},expression:"userForm.role"}},t._l(t.roleList,function(e){return i("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1)],1)],1):t._e(),i("div",{staticClass:"more"},[i("FormItem",{attrs:{prop:"sex",label:"性别"}},[i("Select",{model:{value:t.userForm.sex,callback:function(e){t.$set(t.userForm,"sex",e)},expression:"userForm.sex"}},t._l(t.sexList,function(e){return i("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1)],1)],1),i("div",{staticClass:"more"},[i("FormItem",{attrs:{prop:"mobile",label:"手机号"}},[i("Input",{attrs:{placeholder:""},model:{value:t.userForm.mobile,callback:function(e){t.$set(t.userForm,"mobile",e)},expression:"userForm.mobile"}})],1)],1),i("div",{staticClass:"more"},[i("FormItem",{attrs:{prop:"email",label:"邮箱"}},[i("Input",{attrs:{type:"email",placeholder:""},model:{value:t.userForm.email,callback:function(e){t.$set(t.userForm,"email",e)},expression:"userForm.email"}})],1)],1)]),i("div",{staticClass:"flex right"},[t.showEntityPermission?i("div",{staticClass:"more"},[t.superAdmin?i("FormItem",{attrs:{label:"实体权限",prop:"编辑用户"==t.editTitle?"superAdminList":""}},[i("Select",{attrs:{value:"全部实体",disabled:""}},[i("Option",{attrs:{value:"全部实体"}},[t._v("全部实体")])],1)],1):i("FormItem",{staticStyle:{position:"relative"},attrs:{prop:"bzidList",label:"实体权限"}},[i("el-cascader",{staticClass:"account-edit-select",attrs:{disabled:t.disabledRole,size:"mini",options:t.organization,props:{multiple:!0,checkStrictly:!0},clearable:""},on:{change:t.changeBzid},model:{value:t.userForm.bzidList,callback:function(e){t.$set(t.userForm,"bzidList",e)},expression:"userForm.bzidList"}})],1)],1):t._e()])]),i("div",{staticClass:"flex"},[i("div",{staticClass:"control"},[i("FormItem",[i("Button",{on:{click:function(e){t.handleSubmit("formInline")}}},[t._v("提交")]),i("Button",{staticClass:"buttonCel",nativeOn:{click:function(e){return t.closeEdit(e)}}},[t._v("取消")])],1)],1)])])],1)])]),t.isAlert?i("alert",{attrs:{alertText:t.alertText},on:{closeAlert:t.closeAlert,alertConfirm:t.alertConfirm}}):t._e()],1)},n=[],c=i("f499"),d=i.n(c),u=(i("6b54"),i("c276")),m=(i("ad00"),i("e285")),h=i("65f6"),f=(i("5c96"),i("6821f")),p=i.n(f),v=i("2ef0"),b=i.n(v),g={props:{editData:Object,roleList:{type:[Array,Object],default:[]},organization:{type:[Array,Object],default:[]}},components:{alert:o["a"],uploadImg:h["a"]},data:function(){var t=this,e=this,r=function(e,i,r){t.modify?r():void 0===i||""===i?r(new Error("密码不能为空")):i.length<6?r(new Error("密码长度不得小于6个字符")):i.length>255?r(new Error("密码长度不得大于255个字符")):r()},a=function(t,e,i){void 0===e||""===e?i(new Error("用户名不能为空")):e.length<2?i(new Error("用户名长度不得小于2个字符")):e.length>10?i(new Error("用户名不得大于10个字符")):i()},s=function(t,e,i){void 0===e||""===e||null===e?i():e.length<2?i(new Error("用户姓名长度不得小于2个字符")):e.length>10?i(new Error("用户姓名不得大于10个字符")):i()},o=function(t,i,r){e.modify?e.userForm.password2!==e.userForm.password?r(new Error("两次密码不一致!")):r():void 0===i||""===i?r(new Error("请输入密码")):i.length<6?r(new Error("密码长度不得小于6个字符")):i.length>255?r(new Error("密码长度不得大于50个字符")):e.userForm.password2!==e.userForm.password?r(new Error("两次密码不一致!")):r()},l=function(t,e,i){i()};return{superAdmin:!1,disabledRole:!1,showRolePermission:!0,showEntityPermission:!0,isAlert:!1,psType:"text",alertText:{title:"",text:"",bg:"",confirm:!1},checklists:[],editTitle:"",uploadImg:i("9279"),userForm:{avatar:i("9279"),username:"",realname:"",mobile:"",checklist:"",bzidList:"",age:"",sex:"",lvl:"",email:"",password:"",password2:"",userid:""},ruleInline:{username:[{required:!0,validator:a,trigger:"blur"}],realname:[{required:!1,validator:s,trigger:"blur"}],mobile:[{required:!1,validator:u["v"],trigger:"blur"}],checklist:[{required:!0,validator:u["u"],trigger:"change"}],bzidList:[{required:!0,validator:u["u"],trigger:"change"}],role:[{required:!0,validator:u["u"],trigger:"change"}],email:[{required:!0,message:"邮箱不能为空",trigger:"blur"},{type:"email",message:"邮箱格式不正确",trigger:"blur"}],password:[{required:!0,validator:r,trigger:"blur"}],password2:[{required:!0,validator:o,trigger:"blur"}],superAdminList:[{required:!0,validator:l}]},sexList:[{label:"男",value:1},{label:"女",value:0}],isAdminList:[{label:"超级管理员",value:22},{label:"管理员",value:28},{label:"普通用户",value:23}],modify:!1,copyBzid:[]}},watch:{editData:{handler:function(t,e){"edit"==t.type?(this.editTitle="编辑用户",this.modify="edit"==t.type,this.userForm=t.data,this.userForm.password="*******",this.userForm.password2="*******",this.userForm.username=this.userForm.account,this.userForm.role=t.data.roles_id,this.superAdmin=this.userForm.role<3," "==this.userForm.name?this.userForm.realname="":this.userForm.realname=this.userForm.name," "==this.userForm.gender?this.userForm.sex="":this.userForm.sex="男"===this.userForm.gender?1:0," "==this.userForm.mobile&&(this.userForm.mobile="")):this.editTitle="添加用户"},immediate:!0}},methods:{reselectBzid:function(t,e){var i=this,r=b.a.cloneDeep(this.userForm.bzidList);if(""==r||void 0==r)return!1;var a=b.a.cloneDeep(this.organization);if("add"==t){a.forEach(function(t){1==e.length?e.toString()==t.id.toString()&&(r.push([t.id]),t.children&&t.children.forEach(function(e){r.push([t.id,e.id]),e.children&&e.children.forEach(function(i){r.push([t.id,e.id,i.id])})})):2==e.length&&t.children.forEach(function(i){e[1].toString()==i.id.toString()&&(r.push([t.id,i.id]),i.children&&i.children.forEach(function(e){r.push([t.id,i.id,e.id])}))})});var s=this.uniqArray(r);a.forEach(function(t){t.children&&t.children.forEach(function(e){if(e.children){var i=0;s.forEach(function(t){3==t.length&&t[1].toString()==e.id.toString()&&i++}),e.children.length==i&&s.push([t.id,e.id])}})}),s=this.uniqArray(s),a.forEach(function(t){if(t.children){var e=0;s.forEach(function(i){2==i.length&&i[0].toString()==t.id.toString()&&e++}),t.children.length==e&&0!=e&&s.push([t.id])}}),s=this.uniqArray(s),this.userForm.bzidList=s,this.copyBzid=s}else{if(1==e.length){var o=[];r.forEach(function(t,i){t[0].toString()!=e.toString()&&o.push(t)})}else if(2==e.length){o=[];r.forEach(function(t,i){1==t.length&&t.toString()!=e[0].toString()?o.push(t):2==t.length?o.push(t):3==t.length&&t[1].toString()!=e[1].toString()&&o.push(t)})}else if(3==e.length){o=[];var l=e[0]+","+e[1];r.forEach(function(t,i){t.toString()!=l&&t.toString()!=e[0].toString()&&o.push(t)})}i.userForm.bzidList=o,i.copyBzid=o}},uniqArray:function(t){var e=[];return t.forEach(function(t,i){if(t.constructor==Array)if(0==i)e.push(t);else{var r=0;e.forEach(function(e){e.toString()==t.toString()&&r++}),0==r&&e.push(t)}}),e},changeBzid:function(t){var e=[];if(0==this.userForm.bzidList.length)this.copyBzid=this.userForm.bzidList;else{var i=this;t.length<this.copyBzid.length?(this.copyBzid.forEach(function(t){var r=0;i.userForm.bzidList.forEach(function(e){var i=t.toString(),a=e.toString();i==a&&r++}),0==r&&(e="number"===typeof t?[t]:t)}),this.reselectBzid("remove",e)):(this.userForm.bzidList.forEach(function(t){var r=0;i.copyBzid.forEach(function(e){var i=t.toString(),a=e.toString();i==a&&r++}),0==r&&(e="number"===typeof t?[t]:t)}),this.reselectBzid("add",e))}},changeRole:function(t){this.superAdmin=t<3},closeEdit:function(){this.$emit("closeEdit")},closeAlert:function(){this.isAlert=!1},passwordType:function(){this.psType="password"},alertConfirm:function(t){var e=this;1==t?e.$emit("editData"):e.isAlert=!1},changeImg:function(t){this.userForm.avatar=t,this.uploadImg=t},handleSubmit:function(t){var e=this;e.$refs[t].validate(function(t){t&&e.updataUser()})},updataUser:function(){var t=this,e={};e.level_id=this.userForm.lvl,e.username=this.userForm.username,e.password="*******"===this.userForm.password?"":p()(this.userForm.password),""==this.userForm.bzidList?e.checklist=[]:e.checklist=this.userForm.bzidList.map(function(t){return t[0]}),e.checklist=b.a.uniq(e.checklist),e.checklist=e.checklist.join(","),e.realname=this.userForm.realname,e.sex=this.userForm.sex,e.mobile=this.userForm.mobile,e.email=this.userForm.email,e.avatar=this.userForm.avatar,e.roles_id=this.userForm.role,e.business_zone_privilege=d()(this.userForm.bzidList),this.modify?(e.id=t.userForm.id,Object(m["w"])(e).then(function(e){200===e.data.code?(t.isAlert=!0,t.alertText.bg="#00A0E9",t.alertText.title="编辑用户",t.alertText.text="修改用户成功",t.alertText.confirm=!0):307===e.data.code&&(t.isAlert=!0,t.alertText.bg="#00A0E9",t.alertText.title="添加用户",t.alertText.text="邮箱已被占用",t.alertText.confirm=!1)})):(e.avatar!=i("9279")&&void 0!=e.avatar||(e.avatar=""),Object(m["d"])(e).then(function(e){switch(e.data.code){case 200:t.isAlert=!0,t.alertText.bg="#00A0E9",t.alertText.title="添加用户",t.alertText.text="添加用户成功",t.alertText.confirm=!0;break;case 302:t.isAlert=!0,t.alertText.bg="#00A0E9",t.alertText.title="添加用户",t.alertText.text="用户名已存在",t.alertText.confirm=!1;break;case 307:t.isAlert=!0,t.alertText.bg="#00A0E9",t.alertText.title="添加用户",t.alertText.text="邮箱已被占用",t.alertText.confirm=!1;break;default:t.isAlert=!0,t.alertText.bg="#00A0E9",t.alertText.title="添加用户",t.alertText.text="添加失败",t.alertText.confirm=!1;break}}))}}},x=g,F=(i("cd13"),i("12c9"),i("2877")),y=Object(F["a"])(x,l,n,!1,null,null,null),T=y.exports,E=i("31bd"),w=i.n(E),C=i("96c3"),A={components:{TableMultipleSelected:s["a"],accountEdit:T,alert:o["a"]},data:function(){return{removeType:0,accountText:"",isAlert:!1,tableIdList:[],alertText:{title:"",text:"",bg:"",confirm:!1},isEdit:!1,userLvl:"",searchText:"",searchRole:"",dataList:{},colorAlert:"#00a0e9",titleName:"用户信息列表",tableName:["头像","用户名","姓名","角色","性别","手机号","邮箱","操作"],tableList:[],userId:"",roleList:[],organization:[]}},computed:{user:function(){return this.$store.state.user},filterUser:function(){var t=this;return this.tableList.filter(function(e,i,r){return e.account.toLowerCase().includes(t.searchText.toLowerCase())&&e.rank.includes(t.searchRole)})}},created:function(){this.initRoleList(),this.initOrganization()},mounted:function(){this.initData()},methods:{initOrganization:function(){var t=this;Object(m["o"])(52).then(function(e){if(200==e.data.code){var i=t.$store.state.user.role_id,r=e.data.data,a=r.map(function(t,e){return t.value=t.id,t.label=t.name,t.children&&t.children.forEach(function(t){t.value=t.id,t.label=t.name,t.children&&t.children.forEach(function(t){t.value=t.id,t.label=t.name}),t.gate&&t.gate.forEach(function(e){var i={};i.id=e.id,i.value=e.id,i.label=e.name,i.name=e.name,t.children||(t.children=[]),t.children.push(i)}),t.area&&t.area.forEach(function(e){var i={};i.id=e.id,i.value=e.id,i.label=e.name,i.name=e.name,t.children||(t.children=[]),t.children.push(i)})}),t});if(i<3)t.organization=a;else{var s=[],o=t.$store.state.user.checklist;if(o.length){var l=o;o.indexOf(",")>-1&&(l=o.split(",")),l.map(function(t){return Number(t)}),l.forEach(function(t){s.push(b.a.find(a,["property_id",t]))}),t.organization=s}else t.organization=b.a.find(a,["property_id",o])}}})},initRoleList:function(){var t=this,e=this.$store.state.user.role_property,i=t.$store.state.user.role_id;e=i<3?"":e,Object(C["j"])(e).then(function(e){if(200==e.data.code){var i=e.data.data;t.roleList=i.map(function(t){var e={};return e=t,e.name=t.name,e.label=t.name,e.value=t.id,e.id=t.id,e});var r=t.$store.state.user.role_id;r<3&&t.roleList.unshift({name:"集团管理员",label:"集团管理员",value:2,id:2}),r<2&&t.roleList.unshift({name:"超级管理员",label:"超级管理员",value:1,id:1})}})},initData:function(){var t=this;Object(m["n"])().then(function(e){200===e.data.code&&(t.tableList=[],b.a.forEach(e.data.data,function(e){var i={};i.id=e.userid,i.photo=b.a.isNull(e.avatar)?w.a:e.avatar,i.account=e.username,b.a.isNull(e.realname)?i.name=" ":i.name=e.realname,i.rank=e.roles_name,i.roles_id=e.roles_id,null!=e.sex?1===e.sex?i.gender="男":i.gender="女":i.gender=" ",b.a.isNull(e.mobile)?i.mobile=" ":i.mobile=e.mobile,i.email=e.email,i.operation=!0,i.checklist=e.checklist,i.role=e.roles_id,i.bzidList=e.business_zone_privilege?JSON.parse(e.business_zone_privilege):"",i.password="",t.tableList.push(i)}))})},editData:function(){this.initData(),this.isEdit=!1},addData:function(){this.isEdit=!0,this.dataList={data:"",type:"add"}},tableData:function(t){this.isEdit=!0,this.dataList=b.a.cloneDeep(t)},closeEdit:function(){this.isEdit=!1},closeAlert:function(){this.isAlert=!1},alertConfirm:function(t){var e,i=this;!0===t?(i.isAlert=!1,e=0===this.removeType?this.accountText.data.id:this.tableIdList.join(","),Object(m["j"])(e).then(function(t){200===t.data.code&&(i.isAlert=!0,i.alertText.bg="#00A0E9",i.alertText.title="删除用户",i.alertText.text="删除成功",i.alertText.confirm=!1,i.initData())})):this.isAlert=!1},tableSelect:function(t){var e=this;e.tableIdList=[],t.forEach(function(t){e.tableIdList.push(t.id)})},allRemoveData:function(){this.removeType=1,this.alertText.title="删除用户",this.alertText.text="确认删除选中用户信息？",this.alertText.bg="#00A0E9",this.alertText.confirm=!0,this.isAlert=!0},removeData:function(t){this.removeType=0,this.alertText.title="删除用户",this.alertText.text="确认删除此用户信息？",this.alertText.bg="#00A0E9",this.alertText.confirm=!0,this.isAlert=!0,this.accountText=t}}},L=A,z=(i("905b"),Object(F["a"])(L,r,a,!1,null,null,null));e["default"]=z.exports},cd13:function(t,e,i){"use strict";var r=i("aed0"),a=i.n(r);a.a},d826:function(t,e,i){},f499:function(t,e,i){t.exports=i("a21f")}}]);