(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9814ff0a"],{"0692":function(e,t,a){"use strict";var i=a("4fcf"),n=a.n(i);n.a},"4fcf":function(e,t,a){},6622:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"roles"},[a("div",{staticClass:"left"},[a("Menu",{attrs:{accordion:e.accordion},on:{"on-open-change":e.changeOpenChange}},[e.showSuperAdmin?a("Submenu",{class:{"ivu-menu-opened":1==e.theRoleId},attrs:{name:"1"}},[a("template",{slot:"title"},[a("p",[e._v("超级管理员")])])],2):e._e(),e.showCompanyAdmin||e.showSuperAdmin?a("Submenu",{class:{"ivu-menu-opened":2==e.theRoleId},attrs:{name:"2"}},[a("template",{slot:"title"},[e._v("\n                  集团管理员\n              ")])],2):e._e(),e._l(e.roleList,function(t,i){return a("Submenu",{class:{"ivu-menu-opened":e.theRoleId==t.id},attrs:{name:t.id}},[a("template",{slot:"title"},[e._v("\n                  "+e._s(t.name)+"\n                  "),e.showSuperAdmin?a("icons",{attrs:{type:"weibiaoti520"},nativeOn:{click:function(a){e.upldateRole(t.id)}}}):e._e(),e.showSuperAdmin?a("icons",{attrs:{type:"weibiaoti544"},nativeOn:{click:function(a){e.delRole(t.id)}}}):e._e()],1)],2)})],2),e.showSuperAdmin?a("Button",{attrs:{type:"primary",ghost:""},on:{click:e.openAddRole}},[e._v("新建角色+")]):e._e()],1),a("div",{staticClass:"right"},[a("Tabs",{attrs:{value:e.tabValue,animated:!1}},[a("TabPane",{attrs:{label:"菜单权限",name:"menu"}},e._l(e.menuListDatas,function(t){return a("CheckboxGroups",{attrs:{disabled:e.disabled,checkData:t},on:{changeCheckData:e.changeCheckData}})}),1),a("TabPane",{attrs:{label:"管理权限",name:"manage"}},e._l(e.manageListDatas,function(t){return a("CheckboxGroups",{attrs:{disabled:e.disabled,checkData:t}})}),1)],1),e.theRoleId>=3?a("div",{staticClass:"controls"},[e.showSuperAdmin?a("Button",{attrs:{type:"primary"},on:{click:e.savePageConfig}},[e._v("保存")]):e._e(),e.showSuperAdmin?a("Button",{on:{click:e.defaltSelect}},[e._v("默认选择")]):e._e()],1):e._e()],1),a("addRole",{directives:[{name:"show",rawName:"v-show",value:e.showAddRole,expression:"showAddRole"}],ref:"addRole",attrs:{roleList:e.roleList,menuListData:e.menuListData},on:{closeEdit:e.closeEdit,alertMessage:e.alertMessage}}),e.isAlert?a("alert",{attrs:{alertText:e.alertText},on:{closeAlert:e.closeAlert,alertConfirm:e.alertConfirm}}):e._e()],1)},n=[],s=(a("20d6"),a("c5f6"),a("28a5"),a("55dd"),a("7514"),a("7f7f"),a("ac6a"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"CheckboxGroups"},[a("div",{staticClass:"checkAll"},[a("Checkbox",{attrs:{indeterminate:e.indeterminate,value:e.checkAll,disabled:e.disabled},nativeOn:{click:function(t){return t.preventDefault(),e.handleCheckAll(t)}}},[e._v(e._s(e.checkDatas.cname))])],1),a("CheckboxGroup",{staticClass:"checkList",on:{"on-change":e.onchange},model:{value:e.checkValues,callback:function(t){e.checkValues=t},expression:"checkValues"}},e._l(e.checkDatas.subpagesList,function(t){return a("Checkbox",{attrs:{label:t.cname,disabled:e.disabled}})}),1)],1)}),o=[],r={name:"CheckboxGroups",components:{},props:{checkData:{type:[Array,Object],default:{}},disabled:{type:Boolean,default:!1}},data:function(){return{indeterminate:!1,checkAll:"",checkValues:[]}},watch:{checkValues:function(){this.$emit("changeCheckData",this.checkData)}},computed:{checkDatas:function(){this.checkData.subpagesList||(this.checkData.subpagesList=[]);var e=[];return this.checkAll=!!this.checkData.enable,this.checkData.subpagesList.forEach(function(t){t.enable&&e.push(t.cname)}),this.checkValues=e,this.checkData}},mounted:function(){},methods:{handleCheckAll:function(){this.indeterminate?this.checkAll=!1:this.checkAll=!this.checkAll,this.indeterminate=!1,this.checkAll?(this.checkValues=this.checkData.subpagesList.map(function(e){return e.cname}),this.checkData.enable=1,this.checkData.subpagesList.forEach(function(e){e.enable=1})):(this.checkData.enable=0,this.checkData.subpagesList.forEach(function(e){e.enable=0}),this.checkValues=[])},onchange:function(e){var t=0,a=this;0==e.length?(this.indeterminate=!1,this.checkAll=!1):this.checkData.subpagesList&&(t=this.checkData.subpagesList.length,this.checkData.subpagesList.forEach(function(t){var i=_.indexOf(e,t.cname);i>-1?(t.enable=1,a.checkData.enable=1):t.enable=0}),e.length===t?(this.indeterminate=!1,this.checkAll=!0):e.length>0?(this.indeterminate=!0,this.checkAll=!1):(this.indeterminate=!1,this.checkAll=!1))}}},l=r,c=(a("a6d7"),a("2877")),d=Object(c["a"])(l,s,o,!1,null,null,null),u=d.exports,h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"addRole"},[a("div",{staticClass:"dialogs-edit"},[a("div",{staticClass:"dialogs-edit-bg"}),a("div",{staticClass:"dialogs-edit-text",style:{height:e.heights,marginTop:e.marginTops}},[a("div",{staticClass:"edit-title"},[e._v("\r\n              "+e._s(e.editRoleTitle)+"\r\n          ")]),a("div",{staticClass:"edit-close",on:{click:e.closeEdit}},[a("Icon",{attrs:{type:"md-close"}})],1),a("div",{staticClass:"edit-text"},[a("Form",{ref:"formData",attrs:{model:e.formData,"label-position":"right","label-width":85,rules:e.ruleInline}},[a("FormItem",{attrs:{label:"角色名称",prop:"name"}},[a("Input",{attrs:{type:"text",placeholder:"请输入角色名称"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),a("FormItem",{attrs:{label:"角色归属于",prop:"property"}},[a("i-select",{on:{"on-change":e.getItemValue},model:{value:e.formData.property,callback:function(t){e.$set(e.formData,"property",t)},expression:"formData.property"}},e._l(e.propertyLists,function(t){return a("i-option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),a("FormItem",{attrs:{label:"角色描述",prop:"description","label-width":85}},[a("Input",{attrs:{type:"textarea",rows:4},model:{value:e.formData.description,callback:function(t){e.$set(e.formData,"description",t)},expression:"formData.description"}})],1)],1),a("div",{staticClass:"control"},[a("Button",{on:{click:function(t){e.handleSubmit("formData")}}},[e._v("提交")]),a("Button",{staticClass:"buttonCel",nativeOn:{click:function(t){return e.closeEdit(t)}}},[e._v("取消")])],1)],1)])])])},m=[],f=a("2ef0"),p=a.n(f),b=(a("bc3a"),a("ad00")),v=a("96c3"),g={props:{roleList:{type:[Array,Object],default:[]},menuListData:{type:[Array,Object],default:[]}},data:function(){return{editRoleTitle:"添加角色",propertyList:[],height:"360px",marginTop:"-180px",gate:"gate",isModify:!1,id:"",formData:{name:"",property:0,description:""},ruleInline:{name:[{required:!0,message:"请输入长度为2-8的角色名称",trigger:"blur",max:8,min:2}],property:[{required:!0,message:"至少选择一项"}]}}},created:function(){var e=this;Object(b["e"])().then(function(t){if(200==t.data.code){var a=t.data.data.property,i=e.$store.state.user.checklist,n=e.$store.state.user.role_id,s=[];a.map(function(e){var t={};t.name=e.name,t.label=e.name,t.value=e.property_id,t.id=e.property_id,n<3?s.push(t):i.indexOf(e.property_id)>-1&&s.push(t)}),e.propertyList=s}})},computed:{propertyLists:function(){return this.propertyList},marginTops:function(){return"common_admin"==this.userLvl?"-154px":"-180px"},heights:function(){return"common_admin"==this.userLvl?"308px":"360px"}},methods:{handleSubmit:function(e){var t=this;t.$refs[e].validate(function(e){e&&t.addRole()})},closeEdit:function(){this.$emit("closeEdit")},getItemValue:function(e){this.formData.zone=e},addRole:function(){var e=this,t={};if(t.name=e.formData.name,t.property_id=e.formData.property,t.describ=e.formData.description,t.metric_privilege="",e.isModify){var a=p.a.find(this.roleList,["id",this.id]);a.name=e.formData.name,a.property_id=e.formData.property,a.describ=e.formData.description;var i=[];e.menuListData.forEach(function(e){1==e.enable&&i.push(e.id),e.subpagesList.forEach(function(e){1==e.enable&&i.push(e.id)})}),i.sort(),a.pages_privilege=i.join(","),a.id=e.id,Object(v["n"])(a).then(function(t){if(200==t.data.code){e.closeEdit();var a={bg:"#00A0E9"};a.title=e.editTitle,a.text="编辑角色成功",a.confirm=!1,e.$emit("alertMessage",a)}})}else t.pages_privilege="",0==this.$store.state.home.loadingState&&(this.$store.commit("loadingState",!0),this.$vs.loading()),Object(v["b"])(t).then(function(t){if(200==t.data.code){e.closeEdit();var a={bg:"#00A0E9"};a.title=e.editTitle,a.text="添加角色成功",a.confirm=!1,e.$emit("alertMessage",a)}})}}},k=g,D=(a("6902"),Object(c["a"])(k,h,m,!1,null,"82cfab9a",null)),A=D.exports,L=a("2dc0"),x={name:"Role",components:{CheckboxGroups:u,addRole:A,alert:L["a"]},data:function(){return{accordion:!0,showSuperAdmin:!1,showCompanyAdmin:!1,theRoleId:"",showAddRole:!1,isAlert:!1,roleList:[],menuListData:[],allMenuData:[],tabValue:"menu",alertText:{title:"",text:"",bg:"",confirm:!1},disabled:!1,count:0}},created:function(){var e=this;Object(v["i"])().then(function(t){200==t.data.code&&(e.menuListData=t.data.data.main,e.menuListData.forEach(function(e){e.enable=0,e.subpagesList.forEach(function(e){e.enable=0});var t=p.a.remove(e.subpagesList,function(e){return"VIPRecode"!=e.name});e.subpagesList=p.a.remove(t,function(e){return"VipCustom"!=e.name})}),e.allMenuData=p.a.cloneDeep(e.menuListData))}),this.initRoleList()},watch:{},computed:{menuListDatas:function(){return p.a.filter(this.menuListData,function(e){return"Admin"!=e.name&&"AddEditUser"!=e.name})},manageListDatas:function(){return p.a.filter(this.menuListData,function(e){return"Admin"==e.name||"AddEditUser"==e.name})}},mounted:function(){},methods:{savePageConfig:function(){var e=this,t=p.a.find(this.roleList,["id",this.theRoleId]),a=[];this.menuListData.forEach(function(e){1==e.enable&&a.push(e.id),e.subpagesList.forEach(function(e){1==e.enable&&a.push(e.id)})}),a.sort(),t.pages_privilege=a.join(","),Object(v["n"])(t).then(function(a){if(200==a.data.code){var i=e.$store.state.user.role_id;i==t.id&&e.$store.commit("setAccess",t.pages_privilege),e.isAlert=!0;var n={bg:"#00A0E9"};n.title=e.editTitle,n.text="编辑角色成功",n.confirm=!1,e.alertText=n}})},defaltSelect:function(){var e=p.a.find(this.roleList,["id",this.theRoleId]),t=e.default_pages_privilege?e.default_pages_privilege.split(","):[],a=p.a.cloneDeep(this.menuListData);a=this.dealWithSelect(t,a),this.menuListData=a},changeOpenChange:function(e){if(!e.length)return!1;this.theRoleId=e[0];var t=p.a.cloneDeep(this.menuListData);if("1"==e[0]||"2"==e[0])this.disabled=!0,t.forEach(function(e){e.enable=1,e.subpagesList.forEach(function(e){e.enable=1})}),this.menuListData=t;else{this.$store.state.user.role_id<3?this.disabled=!1:this.disabled=!0;var a=p.a.find(this.roleList,["id",Number(e[0])]),i=a.pages_privilege?a.pages_privilege.split(","):[];t=this.dealWithSelect(i,t),this.menuListData=t}},dealWithSelect:function(e,t){return t.forEach(function(t){var a=p.a.indexOf(e,t.id+"");t.enable=a>-1?1:0,t.subpagesList.forEach(function(t){var a=p.a.indexOf(e,t.id+"");t.enable=a>-1?1:0})}),t},changeCheckData:function(e){var t=p.a.findIndex(this.menuListData,["name",e.name]);this.menuListData[t]=e},initRoleList:function(){var e=this,t=this,a=this.$store.state.user.role_property,i=t.$store.state.user.role_id;a=i<3?"":a,Object(v["j"])(a).then(function(a){if(200==a.data.code){var n=a.data.data;t.roleList=n.map(function(e){var t={};return t=e,t.name=e.name,t.label=e.name,t.value=e.id,t.id=e.id,t}),1==i?(e.showSuperAdmin=!0,e.showCompanyAdmin=!0):2==i?(e.showSuperAdmin=!1,e.showCompanyAdmin=!0):(e.showSuperAdmin=!1,e.showCompanyAdmin=!1),0==t.count&&t.$nextTick(function(){setTimeout(function(){t.count++,t.changeOpenChange([i])},500)})}})},closeEdit:function(){this.showAddRole=!1},openAddRole:function(){var e=this;this.showAddRole=!0,this.$nextTick(function(){e.$refs.addRole.editRoleTitle="添加角色",e.$refs.addRole.isModify=!1,e.$refs.addRole.formData={name:"",property:0,description:""}})},upldateRole:function(e){var t=this,a=p.a.find(this.roleList,["id",e]);this.showAddRole=!0,this.$nextTick(function(){t.$refs.addRole.editRoleTitle="编辑角色",t.$refs.addRole.id=e,t.$refs.addRole.isModify=!0,t.$refs.addRole.formData.name=a.name,t.$refs.addRole.formData.property=a.property_id,t.$refs.addRole.formData.description=a.describ})},delRole:function(e){this.theRoleId=e,this.isAlert=!0,this.alertText.bg="#00A0E9",this.alertText.title="删除角色",this.alertText.text="确认删除选中的角色？",this.alertText.confirm=!0},closeAlert:function(){this.isAlert=!1},alertMessage:function(e){this.isAlert=!0,this.alertText=e,this.initRoleList()},alertConfirm:function(e){var t=this;if(!0===e){var a=t.theRoleId;Object(v["e"])(a).then(function(e){200==e.data.code?(t.isAlert=!0,t.alertText.bg="#00A0E9",t.alertText.title="删除该角色",t.alertText.text="删除角色成功",t.alertText.confirm=!1,t.initRoleList()):(t.isAlert=!0,t.alertText.bg="#00A0E9",t.alertText.title="删除该角色失败",t.alertText.text=e.data.message,t.alertText.confirm=!1)})}else this.isAlert=!1}}},y=x,R=(a("0692"),Object(c["a"])(y,i,n,!1,null,null,null));t["default"]=R.exports},6902:function(e,t,a){"use strict";var i=a("b332"),n=a.n(i);n.a},a6d7:function(e,t,a){"use strict";var i=a("b458"),n=a.n(i);n.a},b332:function(e,t,a){},b458:function(e,t,a){}}]);