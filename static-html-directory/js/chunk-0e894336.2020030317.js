(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e894336"],{"1d95":function(t,a,e){"use strict";var i=e("b830"),s=e.n(i);s.a},"5c42":function(t,a,e){"use strict";var i=e("f319"),s=e.n(i);s.a},"7a99":function(t,a){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAACCCAYAAABGtuhTAAAA+0lEQVRoge3a7Q3CMAyEYdsJsCJi/x9M0PQDWpZ4I12IO8CjuyQtFq2/n6/LwCtILMEEE/wfsJrDoDv69LJKl+YTeuiDJwsGnrDAYNCVZ0xY9I8NnZBeQzyh0QlNPyF9p3RYQ9RLEAHpySETKoL6lekZ+6ITfgu7iPUIdXCPyoIbD97EwUaDa9xZsDkMrnTlJR4siFdu9KYsTlfmj438puAHWz7h5vTTxtQT7kaDDv9IHQaDH3ieqycN0n/DjgDCE2c1eCbuUXm+hHxl+YQDgKiXlYGrw2s49cp4wlxDQTA3ZQZwiF3GQfVjA3+VMALIryE9cA5QWR6kb70fbhhcttV/bnsAAAAASUVORK5CYII="},b219:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"pathTrend"},[e("div",{staticClass:"path-picker"},[e("DatePicker",{staticStyle:{width:"230px",float:"left"},attrs:{type:"daterange",placement:"bottom-end",placeholder:"选择日期",options:t.disabledDate,format:"yyyy-MM-dd"},model:{value:t.drainageDate,callback:function(a){t.drainageDate=a},expression:"drainageDate"}}),e("Select",{staticClass:"selectExample selectFloor",model:{value:t.floor,callback:function(a){t.floor=a},expression:"floor"}},t._l(t.allMoveData,function(a){return e("Option",{key:a.floor_index,attrs:{value:a.floor_index}},[t._v(t._s(a.name))])}),1),e("div",{staticClass:"drainage-submit",on:{click:t.searchData}},[t._v("查询")]),e("div",{staticClass:"drainage-submit drainage-reset",on:{click:t.reset}},[t._v("重置")])],1),e("div",{staticClass:"flexs"},[e("div",{staticClass:"paths"},[e("div",{staticClass:"header"},[e("p",{staticClass:"title"},[t._v("路径动向图")]),e("p",{staticClass:"icons"},[e("icons",{staticStyle:{cursor:"pointer"},attrs:{type:t.leftIcon,color:t.mainColor,size:24,title:t.titlePath},nativeOn:{click:function(a){return t.changePath(a)}}})],1)]),t._l(t.svgLists,function(a){return t.showPath?e("div",{staticClass:"svgs",attrs:{width:t.canvasWidth,height:t.canvasHeight}},[e("svg",{attrs:{width:t.canvasWidth,height:t.canvasHeight,version:"1.1"}},[e("path",{staticClass:"path",attrs:{fill:"transparent",stroke:a.color,"stroke-width":a.width,d:a.d}})]),e("svg",{staticClass:"ball",style:{transform:a.transform,offsetPath:a.path,animation:a.animation},attrs:{width:t.canvasWidth,height:t.canvasHeight,width:"16",height:"16",viewBox:"0 0 1024 1024",version:"1.1"}},[e("path",{attrs:{d:"M 521.813 874.862 s 85.7783 -0.571021 85.77 -45.2698 L 607.456 199.988 c 0 -46.4123 -100.506 -53.0938 -100.506 -53.0938 s 136.923 -5.54963 151.473 45.633 c 14.7673 51.9001 67.1772 107.457 112.135 155.205 c 97.1147 103.133 228.052 159.266 228.052 159.266 s -116.378 70.1674 -215.041 159.309 a 618.749 618.749 0 0 0 -129.944 170.21 c -23.8016 47.6745 -131.81 38.3431 -131.81 38.3431 Z",fill:"#2bd9cf","p-id":"3058"}}),e("path",{attrs:{d:"M 611.191 377.294 l 110.296 134.806 l -107.844 122.55 l -590.693 -120.099 Z",fill:"#2bd9cf","p-id":"3059"}})])]):t._e()}),e("div",{staticClass:"canvas"},[e("canvas",{attrs:{id:"canvasCircle",height:t.canvasHeight,width:t.canvasWidth}}),t.map?e("img",{staticClass:"imgs",attrs:{src:t.map}}):e("div",{staticClass:"noData"},[t._v("暂无数据")]),e("div",{staticClass:"colorBar"},[e("p",{staticClass:"maxNumber"},[t._v(t._s(t.maxNumber))]),e("p",{staticClass:"minNumber"},[t._v(t._s(t.minNumber))]),e("img",{attrs:{src:t.colorBar,width:"20"}})]),t._l(t.titleLists,function(t){return e("div",{staticClass:"titleList",style:{left:t.x-10+"px",top:t.y-10+"px"},attrs:{title:t.name}})})],2)],2),e("div",{staticClass:"maps",staticStyle:{width:"calc(20% - 20px)"}},[e("pathTab",{attrs:{title:t.title1,numbers:t.number1}}),e("pathTab",{attrs:{parking:t.isParking,title:t.title2,numbers:t.number2,right:t.right}})],1)]),e("div",[t._e()],1)])},s=[],n=(e("ac6a"),e("7514"),e("28a5"),e("7f7f"),e("c4a4")),r=e("5241"),o=e("4474"),c=(e("ad00"),e("94b0")),h=e("c276"),l=e("c1df"),d=e.n(l),u=e("2ef0"),f=e.n(u),v={name:"goShop",components:{Ranking:o["a"],pathTab:n["a"]},data:function(){return{maxNumber:"",minNumber:"0",pleft:"0px",ptop:"0px",mainPath:!1,floor:"",colorBar:e("7a99"),map:"",enterIndicator:{enter:{name:"入客流"}},currentPropertyId:null,outRange:"",bizSalesType:"enter",shopSalesType:"enter",showList:!1,drainageDate:[],selectTitle:"业态选择",leftIcon:"xianlu",rightIcon:"zhuanchu",mainColor:"#A6A7A7",title1:"游逛深度（个）",title2:"平均停留时间",number1:"  ",number2:"  ",isParking:!0,right:"18%",screenWidth:document.body.clientWidth,colors:["#E8585A","#FEB33D","#2BD9CF","#33B3ED","#7367F0"],allMoveData:[],canvasWidth:"",canvasHeight:"",titlePath:"切换主路径",titleList:[],positions:[],topRange:"",moveList:[],oneMoveList:[],svgList:[],showPath:!1,count:0,disabledDate:""}},watch:{screenWidth:{handler:function(t,a){this.screenWidth=t;var e=document.getElementsByClassName("canvas")[0].offsetWidth,i=614*e/1171;this.canvasWidth=e,this.canvasHeight=i,this.searchData()}},drainageDate:function(t){this.outRange=d()(t[0]).format("YYYY-MM-DD")+","+d()(t[1]).format("YYYY-MM-DD")},"$store.state.home.headerAction":function(){var t=this;this.currentPropertyId=this.$store.state.home.headerAction,this.floor="";var a=this.$router.currentRoute.name;"OldPath"===a&&(this.searchData(),setTimeout(function(){t.reset()},2e3))}},computed:{titleLists:function(){return this.titleList},svgLists:function(){return this.svgList}},created:function(){this.disabledDate=h["b"];var t=d()(d()(new Date)).format("YYYY-MM-DD"),a=f.a.cloneDeep(t);a=a.split("-"),a.splice(2,1,"01"),a=a.join("-"),this.drainageDate=[],this.drainageDate.push(t),this.drainageDate.push(t),this.outRange=t+","+t,this.searchData()},mounted:function(){var t=this;this.currentPropertyId=this.$store.state.home.headerAction,setTimeout(function(){var a=document.getElementsByClassName("canvas")[0].offsetWidth,e=614*a/1171;t.canvasWidth=a,t.canvasHeight=e},1e3);var a=this;window.onresize=function(){return function(){window.screenWidth=document.body.clientWidth,a.screenWidth=window.screenWidth}()}},methods:{changePath:function(){var t=this;clearInterval(this.timer),this.mainPath=!this.mainPath,this.mainColor=this.mainPath?"#E8585A":"#A6A7A7",this.titlePath=this.mainPath?"切换全路径":"切换主路径",this.svgList=[];var a=document.getElementById("canvasCircle"),e=a.getContext("2d");e.clearRect(0,0,a.width,a.height),this.showPath=!1,t.drawLine()},drawLine:function(){var t=this,a=f.a.find(this.allMoveData,["floor_index",this.floor]),e=this.mainPath?3:1e3,i=[];this.positions=[];var s,n=[];a.paths.forEach(function(t){t.enter&&n.push(t)}),s=n.length?f.a.maxBy(n,"enter").enter:0,this.maxNumber=Boolean(s)>0?s:0,e=this.mainPath?3:1e3,n.forEach(function(a,s){if(s<e){var n=[],o=1;if(a.path.forEach(function(e){var s={};s.x=Math.floor(e.x*t.canvasWidth),s.y=Math.floor(e.y*t.canvasHeight),s.enter=a.enter,s.name=e.name,n.push(s),i.push(s),e.x||e.y||(o=0)}),o>0){var c=Object(r["b"])(n[0].x,n[0].y,n[1].x,n[1].y,100);if(n.splice(1,0,c),c.x<0||c.y<0)return!1;t.positions.push(n)}}}),i=f.a.uniqBy(i,"name"),this.titleList=i,this.oneMoveList=r["c"][0];var o=t.positions,c=[];o.forEach(function(a,e){var i={};i.width=0==s?0:Math.ceil(a[0].enter/s*10/2),i.color=t.colors[5-i.width],i.d="M"+a[0].x+" "+a[0].y+"Q "+a[1].x+" "+a[1].y+","+a[2].x+" "+a[2].y,i.path="path('M"+a[0].x+" "+a[0].y+"Q "+a[1].x+" "+a[1].y+","+a[2].x+" "+a[2].y+"')",i.animation="red-ball "+2*(e+3)+"s linear  infinite",a[0].x>a[2].x&&a[0].y>a[2].y||a[0].x>a[2].x&&a[0].y<a[2].y?i.transform="rotateX(180deg)":i.transform="rotateX(0deg)",i.width>1&&c.push(i)}),c=f.a.uniq(c),t.svgList=c,t.showPath=!0;var h=f.a.sumBy(a.paths,"enter");if(h>0){var l=2,d=document.getElementById("canvasCircle").getContext("2d");this.timer=setInterval(function(){o.forEach(function(t){var a=[];if(s>0){var e=Math.ceil(t[0].enter/s*10/2),i=Math.ceil(t[0].enter/s*10/2);e>1&&i>1&&a.push(t)}a=f.a.uniq(a),a.forEach(function(t){Object(r["a"])(d,t[0].x,t[0].y,l),Object(r["a"])(d,t[2].x,t[2].y,l)})}),l++,l=5==l?2:l},500)}else{clearInterval(this.timer);var u=document.getElementById("canvasCircle"),v=u.getContext("2d");v.clearRect(0,0,u.width,u.height)}},searchData:f.a.throttle(function(){this.timer&&clearInterval(this.timer);var t=document.getElementById("canvasCircle");if(t){var a=t.getContext("2d");a.clearRect(0,0,t.width,t.height)}var e=this;this.mainPath=!1,0==this.count&&(this.topRange=this.outRange,this.count++);var i=this.$store.state.user.role_id,s=this.$store.state.user.bzid,n=this.$store.state.home.headerAction;Object(c["i"])({time:this.outRange,property_id:n}).then(function(t){if(200==t.data.code){if(e.allMoveData=f.a.cloneDeep(t.data.data),i>3){var a=[];e.allMoveData.map(function(t){s.map(function(e){t.bzid==e&&a.push(t)})}),e.allMoveData=a}e.floor||(e.floor=e.allMoveData[0]?e.allMoveData[0].floor_index:"");var n=f.a.find(e.allMoveData,["floor_index",e.floor]);if(!n)return!1;e.map=n?n.map_url:"",e.number1=n?n.depthOfWandering:0,e.number2=n?e.initTimes(n.avgDwelltime):"",e.svgList=[];var r=document.getElementById("canvasCircle"),o=r.getContext("2d");o.clearRect(0,0,r.width,r.height),setTimeout(function(){e.drawLine()})}});try{var r=f.a.find(this.allMoveData,["floor_index",this.floor]);window.TDAPP.onEvent("路径动向分析页面","数据查询",{"时间段":this.outRange,"实体选择":r.name})}catch(o){console.log("路径动向分析页面-数据查询埋点error:"+o)}},1e3),initTimes:function(t){var a="",e="",i=t;return t>3600?(a=Math.floor(t/3600),a=a>=10?a:"0"+a,i=t%3600):a="00",i>60?(e=Math.floor(i/60),e=e>=10?e:"0"+e,i=Math.floor(i%60)):e="00",i=i>0?i>10?i:"0"+i:"00",a+":"+e+":"+i},reset:function(){var t=d()(d()(new Date)).format("YYYY-MM-DD"),a=[t,t];this.drainageDate=a,this.floor=this.allMoveData.length>0?this.allMoveData[0].floor_index:"";try{window.TDAPP.onEvent("路径动向分析页面","重置",{})}catch(e){console.log("路径动向分析页面-重置-埋点error:"+e)}}},beforeDestroy:function(){this.timer&&clearInterval(this.timer)}},m=v,p=(e("1d95"),e("5c42"),e("2877")),g=Object(p["a"])(m,i,s,!1,null,null,null);a["default"]=g.exports},b830:function(t,a,e){},f319:function(t,a,e){}}]);